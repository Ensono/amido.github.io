(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{114:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return l})),r.d(t,"rightToc",(function(){return u})),r.d(t,"default",(function(){return p}));var n=r(2),a=r(6),o=(r(0),r(200)),c=r(203),i={id:"infrastructure_ssr",title:"SSR Application - Azure Infrastructure",sidebar_label:"Infrastructure",hide_title:!1,hide_table_of_contents:!1,description:"SSR Application - Azure Infrastructure",keywords:["rest","api","ssr","application","azure","infrastructure","deploy","pipeline","side","rendering","server","server side rendering"]},l={unversionedId:"workloads/azure/frontend/SSR/infrastructure_ssr",id:"workloads/azure/frontend/SSR/infrastructure_ssr",isDocsHomePage:!1,title:"SSR Application - Azure Infrastructure",description:"SSR Application - Azure Infrastructure",source:"@site/docs/workloads/azure/frontend/SSR/infrastructure_ssr.md",slug:"/workloads/azure/frontend/SSR/infrastructure_ssr",permalink:"/docs/workloads/azure/frontend/SSR/infrastructure_ssr",version:"current",sidebar_label:"Infrastructure",sidebar:"docs",previous:{title:"Server Side Cache",permalink:"/docs/workloads/azure/frontend/SSR/server_side_cache"},next:{title:"SSR Application - Azure DevOps Pipeline",permalink:"/docs/workloads/azure/frontend/SSR/pipeline_ssr"}},u=[{value:"Overview",id:"overview",children:[{value:"Diagram",id:"diagram",children:[]},{value:"Resource List",id:"resource-list",children:[]}]},{value:"Deploying",id:"deploying",children:[{value:"Pipelines",id:"pipelines",children:[]},{value:"Running Locally",id:"running-locally",children:[]}]}],s={rightToc:u};function p(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},s,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"overview"},"Overview"),Object(o.b)("p",null,"This page present the high level design of the reference implementation of the Stacks server-side rendering application."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"This page assumes that the core infrastructure has already been provisioned. Instructions and additional information on the core infrastructure can be found ",Object(o.b)("a",Object(n.a)({parentName:"strong"},{href:"/docs/infrastructure/azure/core_infrastructure"}),"here"))),Object(o.b)("p",null,"Both the diagram and resource list below are for a single environment."),Object(o.b)("h3",{id:"diagram"},"Diagram"),Object(o.b)("img",{alt:"Azure SSR App Infrastructure",src:Object(c.a)("img/azure_ssr_app_infrastructure.png")}),Object(o.b)("h3",{id:"resource-list"},"Resource List"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Resource"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Resource Group - Core",Object(o.b)("strong",{parentName:"td"},"*")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Used to logically group core infrastructure")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"AKS",Object(o.b)("strong",{parentName:"td"},"*")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Azure Kubernetes Service")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Public DNS Record"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"DNS record pointing Ingress (via application gateway",Object(o.b)("strong",{parentName:"td"},"*")," and internal load balancer",Object(o.b)("strong",{parentName:"td"},"*"),")")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ACR",Object(o.b)("strong",{parentName:"td"},"*")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Azure Container Registry")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Namespace: {env}-app"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Kubernetes namespace for the environment")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Ingress"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Kubernetes Ingress to handle routing to Service")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Service"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Kubernetes Service to handle routing to Deployment Pods")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Deployment"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Kubernetes Deployment for managing Pods")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Resource Group - APP"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Used to logically group APP specific infrastructure")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Redis Cache"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Azure managed Redis cache")))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"*")," ",Object(o.b)("em",{parentName:"p"},"Resource is created by the core infrastructure deployment.")),Object(o.b)("h2",{id:"deploying"},"Deploying"),Object(o.b)("h3",{id:"pipelines"},"Pipelines"),Object(o.b)("p",null,"The following pipelines are currently supported for automating the deployment:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/workloads/azure/frontend/SSR/pipeline_ssr"}),"Azure DevOps"))),Object(o.b)("h3",{id:"running-locally"},"Running Locally"),Object(o.b)("p",null,"Currently, vars.tf and provider configuration is not\nautomatically updated. Future iterations will include this."),Object(o.b)("p",null,"The safest way to run and maintain this locally is to rely on Docker and environment\nvariables as that is the way the pipeline will trigger the\nexecutions of Terraform."),Object(o.b)("p",null,"Sample commands with example environment vars:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'# Navigate to the infra directory\ncd ${YOUR_DIRECTORY_PATH}/deploy/azure/app\n\n# Run Amido Terraform Docker container\ndocker run -v $(pwd):/usr/data --rm -it amidostacks/ci-tf:0.0.4 /bin/bash\n\n###########################################################################\n# All commands from this point should be executed in the Docker container #\n###########################################################################\n\n# Navigate to /usr/data directory\ncd /usr/data\n\n# Export Azure Credentials. Replace the example values.\nexport ARM_CLIENT_ID=1111-2222-3333-444 \\\nARM_CLIENT_SECRET=1111-2222-3333-4444 \\\nARM_SUBSCRIPTION_ID=1111-2222-3333-444 \\\nARM_TENANT_ID=1111-2222-3333-444\n\n# Export Terraform variables. Replace the example values.\nexport TF_VAR_name_company=amido \\\nTF_VAR_name_project=example \\\nTF_VAR_name_domain=frontend \\\nTF_VAR_name_component=webapp \\\nTF_VAR_name_environment=dev \\\nTF_VAR_core_resource_group=amido-example-nonprod-uks-core \\\nTF_VAR_resource_group_location=uksouth \\\nTF_VAR_create_dns_record=true \\\nTF_VAR_dns_record=dev \\\nTF_VAR_dns_zone_name=nonprod.amidostacks.com \\\nTF_VAR_internal_dns_zone_name=nonprod.amidostacks.internal \\\nTF_VAR_app_gateway_frontend_ip_name=amido-example-nonprod-uks-core \\\nTF_VAR_app_insights_name=amido-example-nonprod-uks-core \\\nTF_VAR_create_cosmosdb=false \\\nTF_VAR_create_cache=true\n\n# Initial Terraform. Replace the example values.\nterraform init \\\n-backend-config="resource_group_name=amido-stacks-terraform" \\\n-backend-config="storage_account_name=amidostacksterraform" \\\n-backend-config="container_name=tfstate" \\\n-backend-config="key=example-frontend"\n\n# Select or create the "dev" workspace.\nterraform workspace select dev || terraform workspace new dev\n\n# Check the plan matches your expected changes.\nterraform plan\n')))}p.isMDXComponent=!0},200:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return m}));var n=r(0),a=r.n(n);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var u=a.a.createContext({}),s=function(e){var t=a.a.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=s(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(r),d=n,m=p["".concat(c,".").concat(d)]||p[d]||b[d]||o;return r?a.a.createElement(m,i(i({ref:t},u),{},{components:r})):a.a.createElement(m,i({ref:t},u))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,c=new Array(o);c[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var u=2;u<o;u++)c[u]=r[u];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},201:function(e,t,r){"use strict";var n=r(0),a=r(19);t.a=function(){var e=Object(n.useContext)(a.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},203:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return c}));var n=r(201),a=r(208);function o(){var e=Object(n.a)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,r=void 0===t?"/":t,o=e.url;return{withBaseUrl:function(e,t){return function(e,t,r,n){var o=void 0===n?{}:n,c=o.forcePrependBaseUrl,i=void 0!==c&&c,l=o.absolute,u=void 0!==l&&l;if(!r)return r;if(r.startsWith("#"))return r;if(Object(a.b)(r))return r;if(i)return t+r;var s=r.startsWith(t)?r:t+r.replace(/^\//,"");return u?e+s:s}(o,r,e,t)}}}function c(e,t){return void 0===t&&(t={}),(0,o().withBaseUrl)(e,t)}},208:function(e,t,r){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!n(e)}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}))}}]);