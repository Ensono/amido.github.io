<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-workloads/azure/data/getting_started/processing_pipeline_deployment_azure" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Data Processing Pipeline Deployment | Ensono Stacks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://stacks.ensono.com/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Processing Pipeline Deployment | Ensono Stacks"><meta data-rh="true" name="description" content="Data processing pipelines development &amp; deployment"><meta data-rh="true" property="og:description" content="Data processing pipelines development &amp; deployment"><meta data-rh="true" name="keywords" content="datastacks,data,python,etl,cli,azure,template"><link data-rh="true" rel="icon" href="/img/icons/favicon.ico"><link data-rh="true" rel="canonical" href="https://stacks.ensono.com/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure"><link data-rh="true" rel="alternate" href="https://stacks.ensono.com/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure" hreflang="en"><link data-rh="true" rel="alternate" href="https://stacks.ensono.com/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-EKCQBC5CSJ","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EKCQBC5CSJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EKCQBC5CSJ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.fc19d0f0.css">
<script src="/assets/js/runtime~main.b0f3f41b.js" defer="defer"></script>
<script src="/assets/js/main.6d0c70aa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icons/ensono-logo.svg" alt="Ensono Stacks Logo" class="custom-navbar-logo-class themedComponent_mlkZ themedComponent--light_NVdE" height="36" width="150"><img src="/img/icons/ensono-logo.svg" alt="Ensono Stacks Logo" class="custom-navbar-logo-class themedComponent_mlkZ themedComponent--dark_xIcU" height="36" width="150"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a href="https://github.com/Ensono/amido.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://www.ensono.com/company/lets-connect/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Connect<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs">What is Ensono Stacks?</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/nx/nx_stacks">User Interface</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/workloads">Backend Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/workloads/azure/data/intro_data_azure">Data Platform</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/intro_data_azure">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/workloads/azure/data/architecture/architecture_data_azure">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/workloads/azure/data/data_engineering/data_engineering_intro_azure">Data Engineering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/workloads/azure/data/getting_started/requirements_data_azure">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/requirements_data_azure">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/generate_project">1. Generate a data project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure">2. Infrastructure Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure">3. Local Development Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure">4. Shared Resources Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/example_data_source">5. Example Data Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure">6. Data Ingest Pipeline Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure">7. Data Processing Pipeline Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/fabric_deployment_guide">8. Fabric Lakehouse Deployment</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/infrastructure/introduction">Infrastructure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/testing/testing_in_nx/frontend_testing_in_nx">QA</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Data Platform</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">7. Data Processing Pipeline Deployment</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Processing Pipeline Deployment</h1></header><p>This section provides an overview of generating a new <a href="/docs/workloads/azure/data/data_engineering/data_processing">data processing pipeline</a> workload and deploying it into a Ensono Stacks Data Platform, using the <a href="/docs/workloads/azure/data/data_engineering/datastacks">Datastacks CLI</a>.</p>
<p>This guide assumes the following are in place:</p>
<ul>
<li>A <a href="/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure">deployed Ensono Stacks Data Platform</a></li>
<li><a href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure">Development environment set up</a></li>
<li><a href="/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure">Deployed shared resources</a></li>
<li><a href="/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure">Data ingested into the bronze layer of the data lake</a></li>
</ul>
<p>This process will deploy the following resources into the project:</p>
<ul>
<li>Azure Data Factory Pipeline resource (defined in Terraform / ARM)</li>
<li>Boilerplated script for performing data processing activities using PySpark (Python).</li>
<li>Azure DevOps CI/CD pipeline (YAML)</li>
<li>(optional) Spark job and config file for data quality tests (Python)</li>
<li>Template unit tests (Python)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>Once you have landed data in the bronze layer of your data lake (e.g. through a <a href="/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure">data ingest pipeline</a>), you will typically need to perform additional processing activities upon the data in order make it usable for your needs - for example loading it into the silver and gold layers of your data lake. For more information, see <a href="/docs/workloads/azure/data/data_engineering/data_processing">data processing workloads</a>.</p>
<p>In the steps below, we will generate a data processing pipeline that uses data ingested in the <a href="/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure">previous task</a> as its source, and loads it into the silver layer. The same approach can be used to load data from silver to gold.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-create-feature-branch">Step 1: Create feature branch<a href="#step-1-create-feature-branch" class="hash-link" aria-label="Direct link to Step 1: Create feature branch" title="Direct link to Step 1: Create feature branch">​</a></h2>
<p>Before creating a new workload using Datastacks, open the project locally and create a new branch for the workload being created, e.g.:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout </span><span class="token parameter variable" style="color:#36acaa">-b</span><span class="token plain"> feat/my-new-processing-pipeline</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-prepare-the-datastacks-config-file">Step 2: Prepare the Datastacks config file<a href="#step-2-prepare-the-datastacks-config-file" class="hash-link" aria-label="Direct link to Step 2: Prepare the Datastacks config file" title="Direct link to Step 2: Prepare the Datastacks config file">​</a></h2>
<p>Datastacks requires a YAML config file for generating a new ingest workload - see <a href="/docs/workloads/azure/data/data_engineering/datastacks#configuration">Datastacks configuration</a> for further details.</p>
<p>Create a new YAML file and populate the values relevant to your new processing pipeline. The example below will generate resources for a processing workload named <strong>my_processing_pipeline</strong>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#######################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Required parameters #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#######################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Pipeline configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pipeline_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my_processing_pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Description of pipeline shown in Azure Data Factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pipeline_description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;My example processing pipeline.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Azure DevOps configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ado_variable_groups_nonprod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> amido</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stacks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">de</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nonprod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nonprod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ado_variable_groups_prod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> amido</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stacks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">de</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-generate-project-artifacts-using-datastacks">Step 3: Generate project artifacts using Datastacks<a href="#step-3-generate-project-artifacts-using-datastacks" class="hash-link" aria-label="Direct link to Step 3: Generate project artifacts using Datastacks" title="Direct link to Step 3: Generate project artifacts using Datastacks">​</a></h2>
<p>Use the <a href="/docs/workloads/azure/data/data_engineering/datastacks#using-the-datastacks-cli">Datastacks CLI</a> to generate the artifacts for the new workload, using the prepared config file (replacing <code>path_to_config_file/my_config.yaml</code> with the appropriate path).:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Activate virtual environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">poetry shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate resources for an ingest pipeline (without data quality steps)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datastacks generate processing </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;path_to_config_file/my_config.yaml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate resources for an ingest pipeline (with added data quality steps)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datastacks generate processing </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;path_to_config_file/my_config.yaml&quot;</span><span class="token plain"> --data-quality</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will add new project artifacts for the workload under <code>de_workloads/processing/my_processing_pipeline</code>, based on the ingest workload templates. Review the resources that have been generated.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-update-pyspark-job">Step 4: Update PySpark job<a href="#step-4-update-pyspark-job" class="hash-link" aria-label="Direct link to Step 4: Update PySpark job" title="Direct link to Step 4: Update PySpark job">​</a></h2>
<p>Within the generated workload, the following Python file will be used as the entrypoint for the processing job: <code>spark_jobs/process.py</code>. The file is structured ready to start adding any logic specific to your particular workload using Python / Spark. It will reference <a href="/docs/workloads/azure/data/data_engineering/stacks_data_utilities">Stacks Data utilities</a> to simplify interactions with the data platform and standard transformation activities.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logger </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> setup_logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyspark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">etl </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EtlSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKLOAD_NAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;processing_demo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger_library </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stacks.data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger_library</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">etl_main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Execute data processing and transformation jobs.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Running </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">WORKLOAD_NAME</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> processing...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    etl_session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EtlSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">WORKLOAD_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark_session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> etl_session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spark_session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    adls_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> etl_session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">adls_client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#######################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Add processing here #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#######################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Finished: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">WORKLOAD_NAME</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> processing.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup_logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">logger_library</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    etl_main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For the getting started guide, we have provided a simple example - you may extend this based on whatever your workload requires. Copy the following additional imports and constants into the top of your <code>process.py</code> file:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyspark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">etl </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TableTransformation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_latest_rundate_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transform_and_save_as_delta</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> stacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyspark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyspark_utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rename_columns_to_snake_case</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BRONZE_CONTAINER </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;raw&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SILVER_CONTAINER </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;staging&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SOURCE_DATA_TYPE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;parquet&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INPUT_PATH_PATTERN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ingest_azure_sql_example/movies.{table_name}/v1/full/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_PATH_PATTERN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;movies/{table_name}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, copy the following within the <code>etl_main</code> function in <code>process.py</code>, replacing the <code> # Add processing here #</code> comment:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    tables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TableTransformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;links&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rename_columns_to_snake_case</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TableTransformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ratings_small&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rename_columns_to_snake_case</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> table </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_latest_rundate_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spark_session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            adls_client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BRONZE_CONTAINER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            INPUT_PATH_PATTERN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            datasource_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SOURCE_DATA_TYPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OUTPUT_PATH_PATTERN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transform_and_save_as_delta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spark_session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> adls_client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transformation_function</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SILVER_CONTAINER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> output_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The processing script is now prepared to perform the following steps:</p>
<ol>
<li>Initiate a Spark session and connectivity to the data lake.</li>
<li>Define <code>TableTransformation</code> objects - these consist of an input table name, and a transformation function. Here we are specifying two tables - <em>links</em> and <em>ratings_small</em> - and assigning the <code>rename_columns_to_snake_case</code> function as their transformation function.</li>
<li>For each of the tables:<!-- -->
<ol>
<li>Read the latest data from the bronze layer into a Spark DataFrame.</li>
<li>Define an output path for the data in the silver layer.</li>
<li>Execute the transformation function against the DataFrame.</li>
<li>Save the transformed DataFrame into the silver layer in Delta format.</li>
</ol>
</li>
</ol>
<p>In order to run / debug the code during development, you may wish to use <a href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure#optional-pyspark-development-in-databricks">Databricks for development</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-update-tests">Step 5: Update tests<a href="#step-5-update-tests" class="hash-link" aria-label="Direct link to Step 5: Update tests" title="Direct link to Step 5: Update tests">​</a></h2>
<p>The workload is created with placeholders for adding unit and end-to-end tests - see <a href="/docs/workloads/azure/data/data_engineering/testing_data_azure">testing</a> for further details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unit-tests">Unit tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit tests" title="Direct link to Unit tests">​</a></h3>
<p>A placeholder for adding unit tests is located within the workload under <code>tests/unit/test_processing.py</code>. The unit tests are intended as a first step to ensure the code is performing as intended and ensure no breaking changes have been introduced. The unit tests will run as part of the deployment pipeline, and can be run locally by developers.</p>
<p>Within the same directory a <code>conftest.py</code> is provided. This contains a PyTest fixture to enable a local Spark session to be used for running the unit tests in isolation - for examples of this you can refer to the <a href="https://github.com/Ensono/stacks-azure-data/blob/main/de_workloads/processing/silver_movies_example/tests/unit/" target="_blank" rel="noopener noreferrer">example silver workload</a>.</p>
<p>Add any unit tests you require to <code>test_processing.py</code> (although they are not strictly required for the getting started guide). You may also add these tests to the project&#x27;s <code>Makefile</code> under the <code>test</code> command, to easily run them alongside other unit tests in the project.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-tests">End-to-end tests<a href="#end-to-end-tests" class="hash-link" aria-label="Direct link to End-to-end tests" title="Direct link to End-to-end tests">​</a></h3>
<p>A placeholder directory for end-to-end tests for the workload is provided under <code>tests/unit/test_processing.py</code>. These will run as part of the deployment pipeline.</p>
<p>End-to-end tests not required to be added for the getting started demo, but would be recommended when developing any production workload.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-deploy-new-workload-in-non-production-environment">Step 6: Deploy new workload in non-production environment<a href="#step-6-deploy-new-workload-in-non-production-environment" class="hash-link" aria-label="Direct link to Step 6: Deploy new workload in non-production environment" title="Direct link to Step 6: Deploy new workload in non-production environment">​</a></h2>
<p>As for ingest workloads, processing workloads contains a YAML file containing a template Azure DevOps CI/CD pipeline, named <code>de-process-ado-pipeline.yaml</code>. This should be added as the definition for a new pipeline in Azure DevOps.</p>
<ol>
<li>Sign-in to your Azure DevOps organization and go to your project.</li>
<li>Go to Pipelines, and then select New.</li>
<li>Name the new pipeline to match the name of your new workload, e.g. <code>de-process-my-processing-pipeline</code>.</li>
<li>For the pipeline definition, specify the YAML file in the project repository feature branch (e.g. <code>de-process-ado-pipeline.yaml</code>) and save.</li>
<li>The new pipeline will require access to any Azure DevOps pipeline variable groups specified in the <a href="#step-2-prepare-the-datastacks-config-file">datastacks config file</a>. Under each variable group, go to &#x27;Pipeline permissions&#x27; and add the new pipeline.</li>
<li>Run the new pipeline.</li>
</ol>
<p>Running this pipeline in Azure DevOps will deploy the artifacts into the non-production (nonprod) environment and run tests. If successful, the generated resources will now be available in the nonprod Ensono Stacks environment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-7-review-deployed-resources">Step 7: Review deployed resources<a href="#step-7-review-deployed-resources" class="hash-link" aria-label="Direct link to Step 7: Review deployed resources" title="Direct link to Step 7: Review deployed resources">​</a></h2>
<p>If successful, the workload&#x27;s resources will now be deployed into the non-production resource group in Azure - these can be viewed through the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Azure Portal</a> or CLI.</p>
<p>The Azure Data Factory resources can be viewed through the <a href="https://adf.azure.com/" target="_blank" rel="noopener noreferrer">Data Factory UI</a>. You may also wish to run/debug the newly generated pipeline from here (see <a href="https://learn.microsoft.com/en-us/azure/data-factory/iterative-development-debugging" target="_blank" rel="noopener noreferrer">Microsoft documentation</a>).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Updating Data Factory resources</div><div class="admonitionContent_BuS1"><p>The structure of the data platform and Data Factory resources are defined in the project&#x27;s code repository, and deployed through the Azure DevOps pipelines. Changes to Data Factory resources directly through the UI will lead to them being overwritten when deployment pipelines are next run. See <a href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure#azure-data-factory-development">Data Factory development quickstart</a> for further information on updating Data Factory resources.</p></div></div>
<p>Continue to make any further amendments required to the new workload, re-running the DevOps pipeline as required. If including data quality checks, update the (<code>data_quality_config.json</code>) file in the repository with details of checks required on the data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-8-deploy-new-workload-in-further-environments">Step 8: Deploy new workload in further environments<a href="#step-8-deploy-new-workload-in-further-environments" class="hash-link" aria-label="Direct link to Step 8: Deploy new workload in further environments" title="Direct link to Step 8: Deploy new workload in further environments">​</a></h2>
<p>In the example pipeline templates:</p>
<ul>
<li>Deployment to the non-production (nonprod) environment is triggered on a feature branch when a pull request is open</li>
<li>Deployment to the production (prod) environment is triggered on merging to the <code>main</code> branch, followed by manual approval of the release step.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is recommended in any data platform that processes for deploying and releasing across environments should be agreed and documented, ensuring sufficient review and quality assurance of any new workloads. The template CI/CD pipelines provided are based upon two platform environments (nonprod and prod) - but these may be amended depending upon the specific requirements of your project and organisation.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">6. Data Ingest Pipeline Deployment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/workloads/azure/data/getting_started/fabric_deployment_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">8. Fabric Lakehouse Deployment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#step-1-create-feature-branch" class="table-of-contents__link toc-highlight">Step 1: Create feature branch</a></li><li><a href="#step-2-prepare-the-datastacks-config-file" class="table-of-contents__link toc-highlight">Step 2: Prepare the Datastacks config file</a></li><li><a href="#step-3-generate-project-artifacts-using-datastacks" class="table-of-contents__link toc-highlight">Step 3: Generate project artifacts using Datastacks</a></li><li><a href="#step-4-update-pyspark-job" class="table-of-contents__link toc-highlight">Step 4: Update PySpark job</a></li><li><a href="#step-5-update-tests" class="table-of-contents__link toc-highlight">Step 5: Update tests</a><ul><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit tests</a></li><li><a href="#end-to-end-tests" class="table-of-contents__link toc-highlight">End-to-end tests</a></li></ul></li><li><a href="#step-6-deploy-new-workload-in-non-production-environment" class="table-of-contents__link toc-highlight">Step 6: Deploy new workload in non-production environment</a></li><li><a href="#step-7-review-deployed-resources" class="table-of-contents__link toc-highlight">Step 7: Review deployed resources</a></li><li><a href="#step-8-deploy-new-workload-in-further-environments" class="table-of-contents__link toc-highlight">Step 8: Deploy new workload in further environments</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ensono.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ensono<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ensono.com/company/lets-connect/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Get in touch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ensono.com/company/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers at Ensono<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Ensono/amido.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div></div></footer><div class="footer__legal_UQWj"><div><img src="/img/icons/ensono-logo.svg" alt="Ensono logo"></div><div><span>Privacy Policy © <!-- -->2024<!-- --> Ensono, LLC. All rights reserved</span></div><div><a href="https://www.linkedin.com/company/ensono" target="_blank"><svg width="24" height="24" viewBox="0 0 24 24"><title>LinkedIn</title><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path></svg></a></div></div></div>
</body>
</html>