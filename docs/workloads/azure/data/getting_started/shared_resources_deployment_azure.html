<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-EKCQBC5CSJ","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EKCQBC5CSJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EKCQBC5CSJ",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Amido Stacks " href="/opensearch.xml"><title data-react-helmet="true">Shared Resources Deployment | Amido Stacks </title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://stacks.amido.com/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Shared Resources Deployment | Amido Stacks "><meta data-react-helmet="true" name="description" content="Deployment of common Azure Data Factory resources shared by data pipelines"><meta data-react-helmet="true" property="og:description" content="Deployment of common Azure Data Factory resources shared by data pipelines"><meta data-react-helmet="true" name="keywords" content="DE,data,infrastructure,adf,cicd"><link data-react-helmet="true" rel="shortcut icon" href="/img/thumbnail_stacks.png"><link data-react-helmet="true" rel="canonical" href="https://stacks.amido.com/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure"><link data-react-helmet="true" rel="alternate" href="https://stacks.amido.com/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://stacks.amido.com/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.8807cd65.css">
<link rel="preload" href="/assets/js/runtime~main.ab648cc9.js" as="script">
<link rel="preload" href="/assets/js/main.fd494aa4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_wide.svg" alt="Amido Stacks Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo_wide.svg" alt="Amido Stacks Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><a href="https://github.com/amido/amido.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Learn about Stacks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Workloads</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/workloads">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Common</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Azure</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Frontend Web Applications</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Backend Services</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Data Platform</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/intro_data_azure">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/requirements_data_azure">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/infrastructure_data_azure">Infrastructure</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">ETL Pipelines</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/getting_started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure">1. Infrastructure Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure">2. Local Development Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/workloads/azure/data/getting_started/shared_resources_deployment_azure">3. Shared Resources Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/example_data_source">4. Example Data Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/etl_pipelines_deployment_azure">5. Data Ingest Pipeline Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/getting_started/testing_data_azure">Testing</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/azure/data/security_data_azure">Security</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Google Cloud Platform</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Amazon Web Services</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Infrastructure</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quality Assurance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Stacks CLI</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Shared Resources Deployment</h1></header><p>This section provides an overview of deploying the shared resources for Stacks Data Platform.
This aligns to the workflow shown in the <a href="/docs/workloads/azure/data/architecture/architecture_data_azure#data-engineering-workloads">deployment architecture</a> section.
The shared resources include Azure Data Factory resources which are shared across pipelines. These are as follows:</p><ul><li>Linked services<ul><li><em>ls_ADLS_DataLake</em> - Connection to the Data Lake</li><li><em>ls_Blob_ConfigStore</em> - Connection to the config storage location</li><li><em>ls_Databricks_Small</em> - Connection to Databricks job cluster (default 2 fixed workers)</li><li><em>ls_KeyVault</em> - Connection to Azure Key Vault</li></ul></li><li>Datasets<ul><li><em>ds_dp_ConfigStore_Json</em> - For reading JSON data from ls_Blob_ConfigStore</li><li><em>ds_dp_DataLake_Parquet</em> - For writing Parquet data to ls_ADLS_DataLake</li></ul></li><li>Pipelines<ul><li><em>pipeline_Get_Ingest_Config</em> - To retrieve config data for use in a pipeline</li><li><em>pipeline_Generate_Ingest_Query</em> - To generate a query for ingesting data</li></ul></li></ul><p>For details of how these resources are used in ingest pipelines, see <a href="/docs/workloads/azure/data/etl_pipelines/ingest_data_azure">data ingestion</a>.</p><p>This guide assumes the following are in place:</p><ul><li>A <a href="/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure">deployed Stacks data platform</a></li><li><a href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure">Development environment set up</a></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="step-1-create-feature-branch">Step 1: Create feature branch<a aria-hidden="true" class="hash-link" href="#step-1-create-feature-branch" title="Direct link to heading">​</a></h2><p>Open the project locally and create a new feature branch, e.g.:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout -b feat/de-shared-pipeline</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>de_build</code> folder includes YAML file called <code>job-pipeline-vars</code> that contains the variables used in the DE shared resource pipeline. These variables must be updated as per the project requirements.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="step-2-add-a-shared-resources-pipeline-in-azure-devops">Step 2: Add a shared resources pipeline in Azure DevOps<a aria-hidden="true" class="hash-link" href="#step-2-add-a-shared-resources-pipeline-in-azure-devops" title="Direct link to heading">​</a></h2><p>The default shared resources for the Stacks Data Platform are found under <a href="https://github.com/ensono/stacks-azure-data/tree/main/de_workloads/shared_resources" target="_blank" rel="noopener noreferrer">de_workloads/shared_resources</a>. This directory contains a YAML file <code>de-shared-resources.yml</code> containing a template Azure DevOps CI/CD pipeline for building and deploying the shared resources.
This YAML file should be added as the definition for a new pipeline in Azure DevOps.</p><ol><li>Sign-in to your Azure DevOps organization and go to your project</li><li>Go to Pipelines, and then select <strong>New pipeline</strong></li><li>Name the new pipeline, e.g. <code>de-shared-resources</code></li><li>For the pipeline definition, specify the YAML file in the project repository feature branch (<code>de-shared-resources.yml</code>) and save</li><li>The new pipeline will require access to any Azure DevOps pipeline variable groups specified in the pipeline YAML. Under each variable group, go to &#x27;Pipeline permissions&#x27; and add the pipeline.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="step-3-deploy-shared-resources-in-non-production-environment">Step 3: Deploy shared resources in non-production environment<a aria-hidden="true" class="hash-link" href="#step-3-deploy-shared-resources-in-non-production-environment" title="Direct link to heading">​</a></h2><p>Run the pipeline configured in Step 2 to commence the build and deployment process.</p><p>Running this pipeline in Azure DevOps will initiate the deployment of artifacts into the non-production (nonprod) environment. It&#x27;s important to monitor the progress of this deployment to ensure its success. You can track the progress and status of the deployment within the Pipelines section of Azure DevOps.</p><p>If successful, the core DE shared resources will now be available in the nonprod Stacks environment. To view the deployed resources, navigate to the relevant resource group in the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure portal</a>. The deployed Data Factory resources can be viewed through the <a href="https://adf.azure.com/" target="_blank" rel="noopener noreferrer">Data Factory UI</a>.</p><p>ℹ️ Note: The structure of the data platform and Data Factory resources are defined in the project&#x27;s code repository, and deployed through the Azure DevOps pipelines. Changes to Data Factory resources directly through the UI will lead to them be overwritten when pipelines are next run. If you wish to update shared Data Factory resources, update the appropriate files under the path <code>de_workloads/shared_resources/data_factory</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="step-4-deploy-shared-resources-in-further-environments">Step 4: Deploy shared resources in further environments<a aria-hidden="true" class="hash-link" href="#step-4-deploy-shared-resources-in-further-environments" title="Direct link to heading">​</a></h2><p>By default Stacks provides a framework for managing the platform across two environments - nonprod and prod.
The template CI/CD pipelines provided are based upon these two platform environments, but these may be amended depending upon the specific requirements of your project and organisation.</p><ul><li>Deployment to the non-production (nonprod) environment is triggered on a feature branch when a pull request is open</li><li>Deployment to the production (prod) environment is triggered on merging to the <code>main</code> branch, followed by manual approval of the release step.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="next-steps">Next steps<a aria-hidden="true" class="hash-link" href="#next-steps" title="Direct link to heading">​</a></h2><p>Once the shared resources are deployed you may now <a href="/docs/workloads/azure/data/getting_started/etl_pipelines_deployment_azure">generate a new Data Ingest Pipeline</a> (optionally implementing the <a href="/docs/workloads/azure/data/getting_started/example_data_source">Example Data Source</a> beforehand).</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->2. Local Development Quickstart</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/workloads/azure/data/getting_started/example_data_source"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4. Example Data Source<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1-create-feature-branch" class="table-of-contents__link toc-highlight">Step 1: Create feature branch</a></li><li><a href="#step-2-add-a-shared-resources-pipeline-in-azure-devops" class="table-of-contents__link toc-highlight">Step 2: Add a shared resources pipeline in Azure DevOps</a></li><li><a href="#step-3-deploy-shared-resources-in-non-production-environment" class="table-of-contents__link toc-highlight">Step 3: Deploy shared resources in non-production environment</a></li><li><a href="#step-4-deploy-shared-resources-in-further-environments" class="table-of-contents__link toc-highlight">Step 4: Deploy shared resources in further environments</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items"><li class="footer__item"><a href="https://amido.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Amido<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/amido/amido.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Amido Ltd</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ab648cc9.js"></script>
<script src="/assets/js/main.fd494aa4.js"></script>
</body>
</html>