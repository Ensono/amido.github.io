---
id: configure_project_netcore
title: Configure the project
hide_title: true
sidebar_label: Configure the project
hide_table_of_contents: true
description:  Configure, Build and run .NET Core REST API application with CQRS on local and docker container
keywords:
  - .net core
  - rest api
  - cqrs
  - azure
  - application insights
  - cosmos db
  - build
  - run
  - application
  - configure
  - docker
---

## Configure the project

It uses an Azure **CosmosDB** database to store the example application data.
There is a corresponding environment variable that needs to be set to interact with CosmosDB.

<br />

<details open>
<summary>Using the Cosmos DB Emulator to run the database locally</summary>

<div>

For running on local environments, [Cosmos DB emulator](https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator?tabs=ssl-netstd21) can be used in a Windows environment.

1. Install Cosmos DB Emulator

2. Identify the **Primary key**

![CosmosDB](/img/cosmosdb_emulator_3.png)

</div>
</details>

<br />

<details>
<summary>Not using the Cosmos DB Emulator</summary>

<div>
When choosing not to run the CosmosDB locally, further configuration needs to be changed.

Set the CosmosDB URI parameter **DatabaseAccountUri**

```json {2} title="<PROJECT-NAME>/src/api/xxAMIDOxx.xxSTACKSxx.API/appsettings.json"
"CosmosDb": {
    "DatabaseAccountUri": "<Add CosmosDB Account URI here>",
    ...
}
```

</div>
</details>

<br />

<details open>
<summary>Create the Cosmos DB structure</summary>

<div>

Based on the solution template the Cosmos DB has to contain a fixed structure.

Create a collection **Stacks** with a container id **menu** (name of domain object) and the partition key **/id**.

![CosmosDB](/img/cosmosdb_emulator_1.png)

</div>
</details>

<br />

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

For the project just created to connect to the Cosmos Db database, the primary key has to be provided as a environment variable. To add this variable perform one of the next two steps.


<details open>
<summary>Setting the key as a system property</summary>
<div>
<Tabs
defaultValue="windows"
values={[
{label: 'Windows', value: 'windows'},
{label: 'Unix', value: 'unix'}
]}>
<TabItem value="windows">

1. Replace the Cosmos DB Primary key in the command.

2. Run the command in powershell with administrator privileges.

```powershell title="Run command to add the COSMOSDB_KEY system variable"
[Environment]::SetEnvironmentVariable("COSMOSDB_KEY", "Cosmos DB Primary key", [EnvironmentVariableTarget]::Machine)
```

</TabItem>
<TabItem value="unix">
    Set as additional variable within e.g. <code>~/.profile</code> or <code>/etc/profile</code>.
</TabItem>
</Tabs>
</div>
</details>

<br />

<details>
<summary>Set the variable specific to Visual Studio</summary>

<div>

1. Open the project in Visual Studio. The solution file is located at `src/api/xxAMIDOxx.xxSTACKSxx.API.sln`.

2. Add **COSMOSDB_KEY** environment variable to the **launchSettings.json** file generated by Visual Studio and add the Cosmos DB Primary key value.

```json {4} title="src/api/xxAMIDOxx.xxSTACKSxx.API/properties/launchSettings.json"
{
  ...
  "profiles": {
    "xxAMIDOxx.xxSTACKSxx.API": {
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development",
        "COSMOSDB_KEY": "<Add Cosmos DB Primary Key here>"
        ...
      }
    }
  }
}
```

:::info
The variable is referenced in **appsettings.json**.

```json {4} title="src/api/xxAMIDOxx.xxSTACKSxx.API/appsettings.json"
"CosmosDb": {
    ...
    "SecurityKeySecret": {
        "Identifier": "COSMOSDB_KEY",
        ...
    }
}
```

:::

</div>
</details>

<br />
