<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-workloads/aws/backend/java/setting_up_xray_daemon_locally_java">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Running the AWS XRay Daemon | Ensono Stacks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://stacks.ensono.com/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Running the AWS XRay Daemon | Ensono Stacks"><meta data-rh="true" name="description" content="How to run the AWS XRay Daemon"><meta data-rh="true" property="og:description" content="How to run the AWS XRay Daemon"><meta data-rh="true" name="keywords" content="aws,xray,daemon,settings"><link data-rh="true" rel="icon" href="/img/icons/favicon.ico"><link data-rh="true" rel="canonical" href="https://stacks.ensono.com/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java"><link data-rh="true" rel="alternate" href="https://stacks.ensono.com/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java" hreflang="en"><link data-rh="true" rel="alternate" href="https://stacks.ensono.com/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-EKCQBC5CSJ","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EKCQBC5CSJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EKCQBC5CSJ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.8b6695dc.css">
<link rel="preload" href="/assets/js/runtime~main.59b12631.js" as="script">
<link rel="preload" href="/assets/js/main.a556f20d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icons/ensono-logo.svg" alt="Ensono Stacks Logo" class="themedImage_ToTc themedImage--light_HNdA custom-navbar-logo-class" height="36" width="150"><img src="/img/icons/ensono-logo.svg" alt="Ensono Stacks Logo" class="themedImage_ToTc themedImage--dark_i4oU custom-navbar-logo-class" height="36" width="150"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a href="https://github.com/Ensono/amido.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://www.ensono.com/company/lets-connect/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Connect<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs">What is Ensono Stacks?</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/nx/nx_stacks">User Interface</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/workloads">Backend Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">Cloud Platforms</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">All</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">Azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/workloads/gcp/workloads_gcp_readme">Google Cloud Platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">Amazon Web Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">Java Spring Boot REST API</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/common/backend/java/intro_java">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/aws/backend/java/setting_up_dynamodb_locally_java">DynamoDB Emulator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java">Running the AWS XRay Daemon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/aws/backend/java/define_aws_secrets_java">AWS Secrets as Spring Properties</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/common/backend/java/scaffolding_java">Using the Maven Scaffolding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/common/backend/java/ide_java">IDE guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/workloads/common/backend/java/maven_spring_profiles">Maven &amp; Spring Profiles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/workloads/common/backend/java/architecture/maven_modules_java">Architecture</a></div></li></ul></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/workloads/azure/data/intro_data_azure">Data Platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/infrastructure/introduction">Infrastructure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/testing/cli_testing_frameworks">QA</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Backend Services</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cloud Platforms</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Amazon Web Services</span><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java Spring Boot REST API</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Running the AWS XRay Daemon</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Running the AWS XRay Daemon</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-aws-x-ray">Introduction to AWS X-Ray<a href="#introduction-to-aws-x-ray" class="hash-link" aria-label="Direct link to Introduction to AWS X-Ray" title="Direct link to Introduction to AWS X-Ray">​</a></h2><p>AWS X-Ray helps developers analyze and debug production, distributed applications, such as those built using a microservices
architecture. With X-Ray, you can understand how your application and its underlying services are performing to identify
and troubleshoot the root cause of performance issues and errors. </p><p>X-Ray provides an end-to-end view of requests as they travel through your application, and shows a map of your application’s underlying components.
You can use X-Ray to analyze both applications in development and in production, from simple three-tier applications to complex microservices
applications consisting of thousands of services.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-x-ray-daemon">AWS X-Ray Daemon<a href="#aws-x-ray-daemon" class="hash-link" aria-label="Direct link to AWS X-Ray Daemon" title="Direct link to AWS X-Ray Daemon">​</a></h2><p>The AWS X-Ray daemon is a software application that listens for traffic on UDP port 2000, gathers raw segment data, and relays
it to the AWS X-Ray API. The daemon works in conjunction with the AWS X-Ray SDKs and must be running so that data sent by
the SDKs can reach the X-Ray service.</p><p>To run the X-Ray daemon locally, on-premises, or on other AWS services, you need to download it from the  <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-daemon.html" target="_blank" rel="noopener noreferrer">AWS X-Ray Daemon</a> support page,
run it, and then give it permission to upload segment documents to X-Ray.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="giving-the-daemon-permission-to-send-data-to-x-ray">Giving the daemon permission to send data to X-Ray<a href="#giving-the-daemon-permission-to-send-data-to-x-ray" class="hash-link" aria-label="Direct link to Giving the daemon permission to send data to X-Ray" title="Direct link to Giving the daemon permission to send data to X-Ray">​</a></h3><p>The X-Ray daemon uses the AWS SDK to upload trace data to X-Ray, and it needs AWS credentials with permission to do that.</p><p>On Amazon EC2, the daemon uses the instance&#x27;s instance profile role automatically. Locally, save your access keys to a file
named <code>credentials</code> in your user directory under a folder named <code>.aws</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-awscredentials">Example ~/.aws/credentials<a href="#example-awscredentials" class="hash-link" aria-label="Direct link to Example ~/.aws/credentials" title="Direct link to Example ~/.aws/credentials">​</a></h4><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[default]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws_access_key_id = AKIAIOSFODNN7EXAMPLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-daemon">Running the daemon<a href="#running-the-daemon" class="hash-link" aria-label="Direct link to Running the daemon" title="Direct link to Running the daemon">​</a></h3><p>Run the daemon locally from the command line. Use the -o option to run in local mode, and -n to set the region. The download
page linked in the text above gives specific instructions on how to run the daemon on supported operating systems.</p><p>For the MacOS distribution, the command is as follows (assuming the AWS London region is being used): - </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/Downloads$ ./xray_mac </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> eu-west-2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-ray-daemon-logs">X-Ray daemon logs<a href="#x-ray-daemon-logs" class="hash-link" aria-label="Direct link to X-Ray daemon logs" title="Direct link to X-Ray daemon logs">​</a></h3><p>The daemon outputs information about its current configuration and segments that it sends to AWS X-Ray.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2016-11-24T06:07:06Z [Info] Initializing AWS X-Ray daemon 2.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-11-24T06:07:06Z [Info] Using memory limit of 49 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-11-24T06:07:06Z [Info] 313 segment buffers allocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-11-24T06:07:08Z [Info] Successfully sent batch of 1 segments (0.123 seconds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-11-24T06:07:09Z [Info] Successfully sent batch of 1 segments (0.006 seconds)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-awx-x-ray-support-to-the-codebase">Adding AWX X-Ray Support to the codebase<a href="#adding-awx-x-ray-support-to-the-codebase" class="hash-link" aria-label="Direct link to Adding AWX X-Ray Support to the codebase" title="Direct link to Adding AWX X-Ray Support to the codebase">​</a></h2><p>AWS X-Ray support is enabled through the inclusion of the <code>stacks-module-parent</code> dependency that imports the Spring Cloud
support for AWS; at some point the use of AWS- and Azure-specific libraries are to be tidied up, so it is likely that at
that point a specific AWS module will need to be included.</p><p>The code currently uses Spring AOP to add a pointcut to all Controller methods under the <code>com.amido.stacks</code> package so no
manual intervention is necessary.</p><p>It is possible to enable (or disable) AWS X-Ray support using the following environment variable prior to starting the application: -</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">AWS_XRAY_ENABLED</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The AWS X-Ray SDK will fail quiescently if no authentication is provided, or if the Daemon is not running. Please check the output
of the X-Ray daemon logs initially (see above) if traces do not seem to be arriving in CloudWatch.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="viewing-x-ray-traces-in-the-aws-management-console">Viewing X-Ray Traces in the AWS Management Console<a href="#viewing-x-ray-traces-in-the-aws-management-console" class="hash-link" aria-label="Direct link to Viewing X-Ray Traces in the AWS Management Console" title="Direct link to Viewing X-Ray Traces in the AWS Management Console">​</a></h2><p>Once the daemon has been setup and started any REST API controller methods should start to push trace information to the
AWS Management console for the account whose credentials are being used.</p><p>Open the AWS Management Console and navigate to the CloudWatch section. On the toolbar on the left you should see a section
entitled <strong>X-Ray traces</strong>.</p><p>Expand this section and choose the <strong>Service map</strong> option. You should start to see information about REST API calls that have
been made - you can click on the <strong>Traces</strong> entry to see more detailed information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-service-map">Example Service Map<a href="#example-service-map" class="hash-link" aria-label="Direct link to Example Service Map" title="Direct link to Example Service Map">​</a></h3><img loading="lazy" alt="Example X-Ray Service map" src="/img/aws_java_xray_service_map.png" class="img_ev3q"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-trace">Example Trace<a href="#example-trace" class="hash-link" aria-label="Direct link to Example Trace" title="Direct link to Example Trace">​</a></h3><img loading="lazy" alt="Example X-Ray Trace" src="/img/aws_java_xray_trace.png" class="img_ev3q"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-x-ray-segment-errors">Handling X-Ray Segment Errors<a href="#handling-x-ray-segment-errors" class="hash-link" aria-label="Direct link to Handling X-Ray Segment Errors" title="Direct link to Handling X-Ray Segment Errors">​</a></h2><p>If the STS call is made before a request actually comes into the X-Ray enabled service (or out of band of the request),
this will cause a missing context exception. </p><p>AWS advise to either omit any calls that aren&#x27;t part of the request path
(using an un-traced AWS client) or set the <code>AWS_XRAY_CONTEXT_MISSING</code> env variable to <code>LOG_ERROR</code> - see <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-java-configuration.html#xray-sdk-java-configuration-envvars" target="_blank" rel="noopener noreferrer">X-Ray Env Vars</a>.</p><p>Normal calls to X-Ray as part of a request operations are not affected by this setting. </p><p>An example of this type of error is as follows: -</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">08-08-2022 09:46:16.279 [main] |  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WARN  i.a.c.s.AwsSecretsManagerPropertySources.logTo - Unable to load AWS secret from /stacks-secret/example-1/. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Failed to begin subsegment named &#x27;AWSSecretsManager&#x27;: segment cannot be found.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The recommended course of action is to set the <code>AWS_XRAY_CONTEXT_MISSING</code> environment variable - if using Intellij IDE
this can be done by easily by setting the environment variable in the Maven Runner environment variables section. If using
Docker or Kubernetes it is recommended that the relevant functionality be defined to set this variable (such as config maps).</p><img loading="lazy" alt="Specifying X-Ray Environment Variables" src="/img/aws_java_xray_environment_variables_secure.png" class="img_ev3q"></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/workloads/aws/backend/java/setting_up_dynamodb_locally_java"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DynamoDB Emulator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/workloads/aws/backend/java/define_aws_secrets_java"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS Secrets as Spring Properties</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction-to-aws-x-ray" class="table-of-contents__link toc-highlight">Introduction to AWS X-Ray</a></li><li><a href="#aws-x-ray-daemon" class="table-of-contents__link toc-highlight">AWS X-Ray Daemon</a><ul><li><a href="#giving-the-daemon-permission-to-send-data-to-x-ray" class="table-of-contents__link toc-highlight">Giving the daemon permission to send data to X-Ray</a></li><li><a href="#running-the-daemon" class="table-of-contents__link toc-highlight">Running the daemon</a></li><li><a href="#x-ray-daemon-logs" class="table-of-contents__link toc-highlight">X-Ray daemon logs</a></li></ul></li><li><a href="#adding-awx-x-ray-support-to-the-codebase" class="table-of-contents__link toc-highlight">Adding AWX X-Ray Support to the codebase</a></li><li><a href="#viewing-x-ray-traces-in-the-aws-management-console" class="table-of-contents__link toc-highlight">Viewing X-Ray Traces in the AWS Management Console</a><ul><li><a href="#example-service-map" class="table-of-contents__link toc-highlight">Example Service Map</a></li><li><a href="#example-trace" class="table-of-contents__link toc-highlight">Example Trace</a></li></ul></li><li><a href="#handling-x-ray-segment-errors" class="table-of-contents__link toc-highlight">Handling X-Ray Segment Errors</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ensono.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ensono<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ensono.com/company/lets-connect/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Get in touch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ensono.com/company/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers at Ensono<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Ensono/amido.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div></div></footer><div class="footer__legal_UQWj"><div><img src="/img/icons/ensono-logo.svg" alt="Ensono logo"></div><div><span>Privacy Policy © <!-- -->2024<!-- --> Ensono, LLC. All rights reserved</span></div><div><a href="https://www.linkedin.com/company/ensono" target="_blank"><svg width="24" height="24" viewBox="0 0 24 24"><title>LinkedIn</title><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path></svg></a></div></div></div>
<script src="/assets/js/runtime~main.59b12631.js"></script>
<script src="/assets/js/main.a556f20d.js"></script>
</body>
</html>