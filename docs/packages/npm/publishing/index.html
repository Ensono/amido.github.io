<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Publishing Packages | Amido Stacks</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Publishing Packages | Amido Stacks"><meta data-react-helmet="true" name="description" content="‚ö†Ô∏è IMPORTANT: all packages are versioned and published using"><meta data-react-helmet="true" property="og:description" content="‚ö†Ô∏è IMPORTANT: all packages are versioned and published using"><meta data-react-helmet="true" property="og:url" content="https://amido.github.io/stacks/docs/packages/npm/publishing"><link data-react-helmet="true" rel="shortcut icon" href="/stacks/img/thumbnail_stacks.png"><link data-react-helmet="true" rel="canonical" href="https://amido.github.io/stacks/docs/packages/npm/publishing"><link rel="stylesheet" href="/stacks/styles.a087bf75.css">
<link rel="preload" href="/stacks/styles.0673dcca.js" as="script">
<link rel="preload" href="/stacks/runtime~main.a0bc6fc3.js" as="script">
<link rel="preload" href="/stacks/main.7a238d84.js" as="script">
<link rel="preload" href="/stacks/1.328d9d07.js" as="script">
<link rel="preload" href="/stacks/2.12addba4.js" as="script">
<link rel="preload" href="/stacks/3.4373d897.js" as="script">
<link rel="preload" href="/stacks/1be78505.16c4e985.js" as="script">
<link rel="preload" href="/stacks/62.df314b90.js" as="script">
<link rel="preload" href="/stacks/935f2afb.bd1b0fdf.js" as="script">
<link rel="preload" href="/stacks/17896441.605a96b7.js" as="script">
<link rel="preload" href="/stacks/17f16862.f007d757.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/stacks/docs/">Docs</a><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/stacks/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/">About Amido Stacks</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Build the application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_demo">Using the scaffolding-cli to build an application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev">Dev [Node.js]- Using the repo to build the Node.js application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev_java">Dev [Java] - Using the repo to build the Java application locally</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev_dotnet">Dev [Dotnet] - Using the repo to build the Dotnet application locally</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/workloads">Workloads</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Frontend Web Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/intro_node_js">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/ide_node_js">IDE Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/environment_variables_nodejs">Enviroment Variables</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/cli_webapp_frameworks">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/monorepo">Stacks Monorepo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/browser_support">Browser Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/server_side_cache">Server Side Cache</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Java Spring Boot REST API Application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/intro_java">Introduction to the Java REST API application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/quickstart_java">Getting started with the Java Rest API application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/scaffolding_java">Using the Scaffolding CLI to create the Java Rest API project template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/ide_java">IDE guidelines for the Java Rest API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/structure_java">Java Rest API Structure and Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/testing_java">Testing the Java Rest API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/end_to_end_testing_java">End to end automation testing</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Infrastructure</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Azure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/infrastructure/azure/infrastructure_code">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/infrastructure/azure/pipeline_templates">Pipeline Templates</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing">Testing and quality</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/cli_testing_frameworks">Project Types - Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_serenity_bdd">E2E Serenity BDD Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_static">Static Code Analysis</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Packages</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/stacks/docs/packages/packages">Packages</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">npm</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/stacks/docs/packages/npm/publishing">Publishing Packages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/stacks/docs/packages/npm/scaffolding-cli/cli_process">CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/stacks/docs/packages/npm/scaffolding-cli/scaffolding_cli">scaffolding-cli</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">nuget</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/nuget/publishing_nuget">Publishing NuGet Packages</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">maven</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/maven/dependency_management">Dependencies and Version Management</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/support/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Publishing Packages</h1></header><div class="markdown"><p>‚ö†Ô∏è IMPORTANT: all packages are versioned and published using
<a href="https://lernajs.io" target="_blank" rel="noopener noreferrer">Lerna</a>, as defined by scripts at the root of the
repository. Please do not version packages manually in their package
directories.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-to-bump-the-version-on-a-package-and-publish"></a>How to bump the version on a package and publish<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-bump-the-version-on-a-package-and-publish" title="Direct link to heading">#</a></h2><ol><li>Make changes and commit them to origin/branch</li><li>Ensure your <code>git status</code> is porcelian</li><li>On your <em>local</em> machine at the root of the repo (executing the
<a href="/stacks/docs/packages/package.json">version script</a>): <code>npm run version</code></li><li>Commit the automatically generated changes</li><li>Raise a PR to origin/master</li><li>The CI pipeline will then publish the changes for you</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-registry-being-used"></a>The registry being used<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-registry-being-used" title="Direct link to heading">#</a></h2><p>All of our packages are open-source and can be found under the @amidostacks
organisation on <a href="https://www.npmjs.com/settings/amidostacks/packages" target="_blank" rel="noopener noreferrer">npm</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="accessing-the-registry-in-order-to-publish"></a>Accessing the registry in order to publish<a aria-hidden="true" tabindex="-1" class="hash-link" href="#accessing-the-registry-in-order-to-publish" title="Direct link to heading">#</a></h2><p>The CI pipeline will publish for you. If you have maintainer access to the
Github repo then you can commit your changes with the version bump, and let the
pipeline do the rest (if it passes all the tests that is).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="our-packages"></a>Our packages<a aria-hidden="true" tabindex="-1" class="hash-link" href="#our-packages" title="Direct link to heading">#</a></h2><p><code>stacks-webapp-template</code> is a <a href="/stacks/docs/workloads/frontend/monorepo">monorepo</a>, meaning it is divided
into independent sub-packages.</p><p>These packages can be found in the packages/ directory:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">packages/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elint-config/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  template-cli/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  pact-config</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="package-registry"></a>Package registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#package-registry" title="Direct link to heading">#</a></h2><p>All our packages are publicly available from <code>npm</code>:
<a href="https://www.npmjs.com/org/amidostacks" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/org/amidostacks</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="package-management"></a>Package management<a aria-hidden="true" tabindex="-1" class="hash-link" href="#package-management" title="Direct link to heading">#</a></h2><p>We are following in the footsteps of
<a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a> and using
<a href="https://lernajs.io" target="_blank" rel="noopener noreferrer">Lerna</a> which can be installed using
<a href="https://www.npmjs.com/package/lerna" target="_blank" rel="noopener noreferrer">npm</a>.</p><p>Lerna is configured to publish all changes in <a href="/stacks/docs/packages/packages">packages</a> once any
changes have passed the pipeline gates as defined in
<code>[build/azDevOps/azure](build/azDevOps/azure/)</code>. Note that it&#x27;s then up the
consumers of the packages to update their versions as needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="automated-package-publishing"></a>Automated package publishing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#automated-package-publishing" title="Direct link to heading">#</a></h2><p>Lerna is embedded as a step in the <a href="/stacks/docs/workloads/frontend/monorepo">monorepo</a> pipeline. Check out
the pipeline step
<code>[publish-packages-lerna.yml](./build/azDevOps/azure/templates/steps/publish-packages-lerna.yml)</code>
for more information on how this is done.</p><p>This automates the following process:</p><ol><li>the version is bumped from the conventional commits <code>npm run version</code></li><li><code>package.json</code> version is changed</li><li>the changes are to be merged to master (CHANGELOG.md, version in packages)</li><li>in the pipeline, this triggers lerna to look for difference in package
version and the registry</li><li>if changes are found the packages are published to the configured registry</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="version-bumps-require-manual-commit"></a>Version bumps require manual commit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#version-bumps-require-manual-commit" title="Direct link to heading">#</a></h3><p>This is because we think it&#x27;s up the the developers to ensure that they want to bump the
version, based on their commit history.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-reasoning-behind-automated-publishing"></a>The reasoning behind automated publishing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-reasoning-behind-automated-publishing" title="Direct link to heading">#</a></h3><p>We think it&#x27;s good practice to test changes before publishing it to our
<a href="https://www.npmjs.com/settings/amidostacks/packages" target="_blank" rel="noopener noreferrer">public npm registry</a>. so
you know it&#x27;s free of errors. We only publish from master in the pipeline.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="versioning"></a>Versioning<a aria-hidden="true" tabindex="-1" class="hash-link" href="#versioning" title="Direct link to heading">#</a></h2><p>We are versioning as a separate script in order to support publishing from a CI
pipeline, and to automate the creation of changelogs based on the commit
history.</p><p>From root, run: <code>npm run version</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-version-does"></a>What <code>version</code> does<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-version-does" title="Direct link to heading">#</a></h3><ol><li>Identifies packages that have been updated since the previous tagged release.</li><li>Bumps the version based on the Conventional Commits Specification</li><li>Updates CHANGELOG.md and updates the package.json if needed</li></ol><p>The changes are then ready to be committed to the remote.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-we-use-lerna-version---conventional-commits"></a>Why we use <code>lerna version --conventional-commits</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-we-use-lerna-version---conventional-commits" title="Direct link to heading">#</a></h3><blockquote><p>When run with this flag, lerna version will use the Conventional Commits
Specification to determine the version bump and generate CHANGELOG.md files.
[2][2]:
<a href="https://github.com/lerna/lerna/tree/master/commands/version#--conventional-commits" target="_blank" rel="noopener noreferrer">https://github.com/lerna/lerna/tree/master/commands/version#--conventional-commits</a></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-we-use---no-git-tag-version"></a>Why we use <code>--no-git-tag-version</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-we-use---no-git-tag-version" title="Direct link to heading">#</a></h3><p>By default, lerna version will commit changes to package.json files and tag the
release. Since we are publishing <code>from-package</code> and doing so in the pipeline, we
would rather suggest creating a separate Github release task that would run on
successful Lerna publishing to the registry.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-we-use---no-push"></a>Why we use <code>--no-push</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-we-use---no-push" title="Direct link to heading">#</a></h3><p>By default, lerna version will push the committed and tagged changes to the
configured git remote. We disable this to ensure that the changelog and version
bumps are obvious on local, and it&#x27;s up to the develop to commit them to their
working branch.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="conventional-commits"></a>Conventional commits<a aria-hidden="true" tabindex="-1" class="hash-link" href="#conventional-commits" title="Direct link to heading">#</a></h2><p>We generate our CHANGELOG.md automagically based on the <code>git commit</code>. The
commit itself communicates the <strong>WHAT</strong>, whereas commit message communicates the
<strong>WHY</strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="definition-of-a-commit"></a>Definition of a commit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#definition-of-a-commit" title="Direct link to heading">#</a></h3><p><a href="https://git-scm.com/docs/git-commit" target="_blank" rel="noopener noreferrer"><code>git commit</code></a> is a git command that is
used to record your changes to the local repository.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-we-are-using-conventional-commits"></a>Why we are using Conventional Commits<a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-we-are-using-conventional-commits" title="Direct link to heading">#</a></h3><ul><li>Automatically generating CHANGELOGs.</li><li>Automatically determining a semantic version bump (based on the types of
commits landed).</li><li>Communicating the nature of changes to teammates, the public, and other
stakeholders.</li><li>Triggering publish processes.</li><li>Making it easier for people to contribute to your projects, by allowing them
to explore a more structured commit history.</li></ul><p><em>Source:
<a href="https://www.conventionalcommits.org/en/v1.0.0/#why-use-conventional-commits" target="_blank" rel="noopener noreferrer">https://www.conventionalcommits.org/en/v1.0.0/#why-use-conventional-commits</a></em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-we-enforce-conventional-commits"></a>How we enforce Conventional Commits<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-we-enforce-conventional-commits" title="Direct link to heading">#</a></h3><p>We use pre-commit hooks with <a href="https://github.com/typicode/husky" target="_blank" rel="noopener noreferrer">Husky</a> and
<a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener noreferrer">commitlint</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-commit-conventions-format"></a>The commit conventions format<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-commit-conventions-format" title="Direct link to heading">#</a></h3><p><code>type(scope?): subject</code></p><p>Where:</p><ul><li><p><a href="https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional#type-enum" target="_blank" rel="noopener noreferrer"><code>&#x27;type&#x27;=</code></a></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;build&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ci&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;chore&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;docs&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;feat&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fix&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;perf&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;refactor&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;revert&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;style&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div></li><li><p><code>scope?=</code> optional, addresses the specific area of change, or feature</p></li><li><p><code>subject=</code> why you are making the commit in the first place</p></li></ul><p>Examples: <code>chore: to run tests on travis ci</code></p><p><code>fix(server): to send cors headers</code></p><p><code>feat(blog): to add comment section</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="publishing"></a>Publishing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#publishing" title="Direct link to heading">#</a></h2><p>From root, run: <code>npm run publish</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-publish-does"></a>What <code>publish</code> does<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-publish-does" title="Direct link to heading">#</a></h3><ol><li>explicitly publish packages where the latest version is not present in the
registry (from-package).</li></ol><p><em>Lerna will never publish packages which are marked as private (&quot;private&quot;: true
in the package.json).</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-happens-in-ci"></a>What happens in CI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-happens-in-ci" title="Direct link to heading">#</a></h3><p>We check if the package version is up to date with the registry. If it&#x27;s a head,
then we publish the changes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-we-use-lerna-publish-from-package"></a>Why we use <code>lerna publish from-package</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-we-use-lerna-publish-from-package" title="Direct link to heading">#</a></h3><blockquote><p>keyword except the list of packages to publish is determined by inspecting
each <code>package.json</code> and determining if any package version is not present in
the registry. Any versions not present in the registry will be published. This
is useful when a previous lerna publish failed to publish all packages to the
registry. <a href="https://github.com/lerna/lerna/tree/master/commands/publish#bump-from-package" target="_blank" rel="noopener noreferrer">1</a></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="lessons-learnt-with-lerna"></a>Lessons learnt with Lerna<a aria-hidden="true" tabindex="-1" class="hash-link" href="#lessons-learnt-with-lerna" title="Direct link to heading">#</a></h2><p>We have encountered a lot of issues while using Lerna for versioning and
publishing in a pipeline. Namely the following:</p><ol><li>Lerna expects master to be unprotected protected and able to push to it -
<a href="https://github.com/lerna/lerna/issues/1957" target="_blank" rel="noopener noreferrer">https://github.com/lerna/lerna/issues/1957</a></li><li>When using <code>from-package</code> the GitHead SHA needs to be committed POST
publishing to a registry. This requires the publish task in the pipeline to
commit this to master.</li><li>When using <code>from-package</code> the Git Tag needs to be committed POST publishing to
registry. This requires custom tasks for tagging releases.</li><li>Lerna cannot version or publish in a detached HEAD state, making pipeline
versioning and publishing really hard.</li><li>It should probably just be done locally...</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="faq"></a>FAQ<a aria-hidden="true" tabindex="-1" class="hash-link" href="#faq" title="Direct link to heading">#</a></h2><p>Q: What happens if the pipeline fails with error about working tree with uncommitted changes?
A: If you see the following error in the logs on the <code>Publish: Publish packages using lerna</code> task:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-log codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lerna ERR! EUNCOMMIT Working tree has uncommitted changes, please commit or remove the following changes before continuing:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lerna ERR! EUNCOMMIT  M package-lock.json</span></div></div></div></div></div><p>This could mean that that the monorepo root <code>package.json</code> and <code>package-lock.json</code> are out of sync on <code>master</code> branch. Try deleting the <code>package-lock.json</code> and re-installing dependencies, and test then the new lock file.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">stacks-webapp-template $ </span><span class="token function" style="color:rgb(130, 170, 255)">rm</span><span class="token plain"> package-lock.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">stacks-webapp-template $ </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/amido/stacks/docs/packages/npm/publishing.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/stacks/docs/packages/packages"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Packages</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/stacks/docs/packages/npm/scaffolding-cli/cli_process"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLI (Command Line Interface) ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-bump-the-version-on-a-package-and-publish" class="table-of-contents__link">How to bump the version on a package and publish</a></li><li><a href="#the-registry-being-used" class="table-of-contents__link">The registry being used</a></li><li><a href="#accessing-the-registry-in-order-to-publish" class="table-of-contents__link">Accessing the registry in order to publish</a></li><li><a href="#our-packages" class="table-of-contents__link">Our packages</a></li><li><a href="#package-registry" class="table-of-contents__link">Package registry</a></li><li><a href="#package-management" class="table-of-contents__link">Package management</a></li><li><a href="#automated-package-publishing" class="table-of-contents__link">Automated package publishing</a><ul><li><a href="#version-bumps-require-manual-commit" class="table-of-contents__link">Version bumps require manual commit</a></li><li><a href="#the-reasoning-behind-automated-publishing" class="table-of-contents__link">The reasoning behind automated publishing</a></li></ul></li><li><a href="#versioning" class="table-of-contents__link">Versioning</a><ul><li><a href="#what-version-does" class="table-of-contents__link">What <code>version</code> does</a></li><li><a href="#why-we-use-lerna-version---conventional-commits" class="table-of-contents__link">Why we use <code>lerna version --conventional-commits</code></a></li><li><a href="#why-we-use---no-git-tag-version" class="table-of-contents__link">Why we use <code>--no-git-tag-version</code></a></li><li><a href="#why-we-use---no-push" class="table-of-contents__link">Why we use <code>--no-push</code></a></li></ul></li><li><a href="#conventional-commits" class="table-of-contents__link">Conventional commits</a><ul><li><a href="#definition-of-a-commit" class="table-of-contents__link">Definition of a commit</a></li><li><a href="#why-we-are-using-conventional-commits" class="table-of-contents__link">Why we are using Conventional Commits</a></li><li><a href="#how-we-enforce-conventional-commits" class="table-of-contents__link">How we enforce Conventional Commits</a></li><li><a href="#the-commit-conventions-format" class="table-of-contents__link">The commit conventions format</a></li></ul></li><li><a href="#publishing" class="table-of-contents__link">Publishing</a><ul><li><a href="#what-publish-does" class="table-of-contents__link">What <code>publish</code> does</a></li><li><a href="#what-happens-in-ci" class="table-of-contents__link">What happens in CI</a></li><li><a href="#why-we-use-lerna-publish-from-package" class="table-of-contents__link">Why we use <code>lerna publish from-package</code></a></li></ul></li><li><a href="#lessons-learnt-with-lerna" class="table-of-contents__link">Lessons learnt with Lerna</a></li><li><a href="#faq" class="table-of-contents__link">FAQ</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/stacks/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About Us</h4><ul class="footer__items"><li class="footer__item"><a href="https://amido.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amido</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2020 Amido Ltd</div></div></div></footer></div>
<script src="/stacks/styles.0673dcca.js"></script>
<script src="/stacks/runtime~main.a0bc6fc3.js"></script>
<script src="/stacks/main.7a238d84.js"></script>
<script src="/stacks/1.328d9d07.js"></script>
<script src="/stacks/2.12addba4.js"></script>
<script src="/stacks/3.4373d897.js"></script>
<script src="/stacks/1be78505.16c4e985.js"></script>
<script src="/stacks/62.df314b90.js"></script>
<script src="/stacks/935f2afb.bd1b0fdf.js"></script>
<script src="/stacks/17896441.605a96b7.js"></script>
<script src="/stacks/17f16862.f007d757.js"></script>
</body>
</html>