<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Using the repo to build the Dotnet application locally | Amido Stacks</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Using the repo to build the Dotnet application locally | Amido Stacks"><meta data-react-helmet="true" name="description" content="GETTING STARTED WITH THE DOTNET APPLICATION"><meta data-react-helmet="true" property="og:description" content="GETTING STARTED WITH THE DOTNET APPLICATION"><meta data-react-helmet="true" property="og:url" content="https://amido.github.io/stacks/docs/getting_started_dev_dotnet"><link data-react-helmet="true" rel="shortcut icon" href="/stacks/img/thumbnail_stacks.png"><link data-react-helmet="true" rel="canonical" href="https://amido.github.io/stacks/docs/getting_started_dev_dotnet"><link rel="stylesheet" href="/stacks/styles.addbe53e.css">
<link rel="preload" href="/stacks/styles.a6852552.js" as="script">
<link rel="preload" href="/stacks/runtime~main.9a8fc084.js" as="script">
<link rel="preload" href="/stacks/main.cadd894d.js" as="script">
<link rel="preload" href="/stacks/1.36f270ee.js" as="script">
<link rel="preload" href="/stacks/2.f8126f4c.js" as="script">
<link rel="preload" href="/stacks/3.ca7332ad.js" as="script">
<link rel="preload" href="/stacks/1be78505.44e463b6.js" as="script">
<link rel="preload" href="/stacks/91.84bf3977.js" as="script">
<link rel="preload" href="/stacks/935f2afb.0c55464b.js" as="script">
<link rel="preload" href="/stacks/17896441.fdf225da.js" as="script">
<link rel="preload" href="/stacks/5ab29772.e11a6097.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/stacks/docs/">Docs</a><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/stacks/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Using the repo to build the Dotnet application locally</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="getting-started-with-the-dotnet-application"></a>GETTING STARTED WITH THE DOTNET APPLICATION<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started-with-the-dotnet-application" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-the-application-locally"></a>RUNNING THE APPLICATION LOCALLY<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-the-application-locally" title="Direct link to heading">#</a></h3><ol><li><p>Clone the Dotnet project to your local machine from here: <a href="https://github.com/amido/stacks-dotnet" target="_blank" rel="noopener noreferrer">stacks-dotnet repository</a></p></li><li><p>Configure required environment variables</p><p> The application is currently configured to work with the Azure environment.</p><p> It uses an Azure <strong>CosmosDB</strong> database to store the example application data.
There is a corresponding environment variable that needs to be set to interact with CosmosDB:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">COSMOSDB_KEY</span></div></div></div></div></div><p> For Unix systems, set as additional variable within e.g. <code>~/.profile</code> or <code>/etc/profile</code>.</p><p> For Windows, open System Properties then select the Advanced tab, then click on the Environment Variables button and add the new parameter.</p><p> Note: For running on local environments, you can use the <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator?tabs=ssl-netstd21" target="_blank" rel="noopener noreferrer">Cosmos DB emulator</a> (CosmosDB Emulator has a known fixed key).</p><p> If not running locally, you additionally need to set the CosmosDB URI parameter <code>DatabaseAccountUri</code> within the
file <code>&lt;PROJECT-NAME&gt;/src/api/xxAMIDOxx.xxSTACKSxx.API/appsettings.json</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;DatabaseAccountUri&quot;: &quot;https://REPLACE-ME-WITH-COSMOSDB.documents.azure.com:443/&quot;</span></div></div></div></div></div></li><li><p>Build and run the application</p><p>Move to the <code>&lt;PROJECT-NAME&gt;/src/api</code> folder, then</p><p>Unix:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">export COSMOSDB_KEY=${COSMOSDB_KEY}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet restore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet clean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet run --project xxAMIDOxx.xxSTACKSxx.API/xxAMIDOxx.xxSTACKSxx.API.csproj</span></div></div></div></div></div><p>Windows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TODO</span></div></div></div></div></div></li><li><p>Verify that the application has started</p><p>Browse to <a href="http://localhost:5000/v1/menu" target="_blank" rel="noopener noreferrer">http://localhost:5000/v1/menu</a>. This should return a valid JSON response.</p><p>The application configuration uses Swagger/OAS3 to represent the API endpoints. The Swagger UI can be viewed by directing your
browser to <a href="http://localhost:5000/swagger/index.html" target="_blank" rel="noopener noreferrer">http://localhost:5000/swagger/index.html</a>.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-a-docker-image"></a>USING A DOCKER IMAGE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-a-docker-image" title="Direct link to heading">#</a></h3><p>From the <code>&lt;PROJECT-NAME&gt;/src/api</code> folder, build a Docker image using e.g. the command below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker build -t dotnet-api .</span></div></div></div></div></div><p>This uses the <code>Dockerfile</code> in this folder to generate the Docker image.</p><p>Once the Docker image is created, you can then run a Docker container based on this image using e.g.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -p 5000:80 --mount type=bind,source=/path/to/PROJECT-NAME/src/api/xxAMIDOxx.xxSTACKSxx.API/appsettings.json,target=/app/config/appsettings.json -e COSMOSDB_KEY=your-key dotnet-api:latest</span></div></div></div></div></div><p>where the <code>COSMOSDB_KEY</code> is the value as described above. Note that the <code>appsettings.json</code> value is mounted here for running locally,
but not if the full project is deployed to Azure, where the build process will perform the substitution.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="swaggeroas"></a>SWAGGER/OAS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#swaggeroas" title="Direct link to heading">#</a></h4><ul><li>Automatically generated for the project. Go to <a href="http://localhost:5000/swagger/index.html" target="_blank" rel="noopener noreferrer">Swagger Index</a> to view.</li><li>Swagger Json is here: <a href="http://localhost:5000/swagger/oas.json" target="_blank" rel="noopener noreferrer">Swagger Json</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-stacks-dotnet-template"></a>USING THE STACKS DOTNET TEMPLATE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-stacks-dotnet-template" title="Direct link to heading">#</a></h2><p>The Stacks template is a template for the <code>dotnet new</code> command, and used to create a new application repository based on the Stacks structure.</p><p>The Amido Stacks structure uses a naming convention for many folders in order to make the process simple and intuitive.
For that reason, you are advised to create the whole application structure and then remove the parts that are not needed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-the-template"></a>INSTALLING THE TEMPLATE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-the-template" title="Direct link to heading">#</a></h3><p>If you have installed the Stacks template before, it is recommended that you remove older versions before installing the new one.
To remove it, run the following command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet new -u stacks-app-template</span></div></div></div></div></div><p>Note: if you don&#x27;t have a previous installed, the command will fail, you can skip to the next step.</p><p>Download the <a href="https://github.com/amido/stacks-dotnet/releases/tag/1.0.0" target="_blank" rel="noopener noreferrer">stacks-app-template.1.0.0.nupkg template package</a>
(.Net Core 3.1, current LTS release) to a temporary folder.</p><p>Install this package:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet new -i /path/to/stacks-app-template.1.0.0.nupkg</span></div></div></div></div></div><p>Once this has completed, a list of available templates will be displayed on the screen.
Check to ensure that the template <strong>Amido Stacks Application Repository</strong> is present in the list.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-new-application-using-the-template"></a>CREATE A NEW APPLICATION USING THE TEMPLATE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-new-application-using-the-template" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet new stacks-app -n Company.Project -d DomainName</span></div></div></div></div></div><p>The above command will create a folder and a repository called <code>Company.Project</code>.</p><p>If you omit the parameter <code>-n</code>, the CLI will create the project using the name of the folder the command is being run from
(e.g. <code>c:\demo\amido-sample&gt; dotnet new stacks-app</code> will generate a project called <code>amido-sample</code>).
To prevent the creation of a new folder you can pass the parameter <code>-o</code> with a path name
e.g. <code>dotnet new stacks-app -o ./foldername</code>).</p><p>The parameter <code>-d</code> is a short name for <code>--Domain</code>. Domain is the name used by the aggregate root object,
and referenced in multiple place in the project. It is used as the name of the collection within the CosmosDB instance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-the-application"></a>RUNNING THE APPLICATION<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-the-application" title="Direct link to heading">#</a></h3><p>The template does not set up the application configuration required to run. Before you attempt to start the
application make sure it is configured properly.</p><p>Assuming you have already installed all dependencies required (i.e. CosmosDB emulator, or you have access to a CosmosDB instance)
you will need to configure the application to connect to the database. Ensure that the <code>DatabaseAccountUri</code> value is set
(as per the instructions above for running the application locally).</p><p>By default, on a developer machine, the template is configured to connect to a local CosmosDB emulator - make sure you
create a database (default is <code>Stacks</code>) and a collection within it (the default collection expected
is the <code>DomainName</code> value supplied when creating the application).</p><p>The collection partition key by default uses the ID (<code>/id</code>).</p><p>You should also ensure that the <code>Company.Project.API/Properties/launchSettings.json</code> file has the correct <code>COSMOSDB_KEY</code> value set.</p><p>Once these are configured correctly, load the project into Visual Studio and press <code>F5</code> to start a debug process.
The browser will open, and you should be presented with a Swagger UI page showing the default api endpoints with their
CRUD operations.</p><p>Alternatively, you can run these steps from the command line:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet restore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet clean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dotnet run --project Company.Project.API/Company.Project.API.csproj</span></div></div></div></div></div><p>The deployment pipeline should be configured with the DevOps team in order to set up the right dependencies.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="caveats"></a>CAVEATS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#caveats" title="Direct link to heading">#</a></h4><ul><li>The ContractTests project has a limitation due to a Windows path length size. When the project is running on Windows
from a long path length, the build will fail. If this is the case, you may need to move the project into a
folder where the path is shorter.</li><li>All secrets are loaded from environment variables. Due to a bug in Visual Studio, the environment variables for a test
project are not set when running the tests. For integration tests, ensure you set these environment variables
before you open Visual Studio.</li><li>The current template requires dotnet core SDK 3.1. Ensure that it is installed before running the application.
To check the installed version run the command <code>dotnet --version</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-scaffolding-cli-to-create-a-dotnet-project"></a>USING THE SCAFFOLDING CLI TO CREATE A DOTNET PROJECT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-scaffolding-cli-to-create-a-dotnet-project" title="Direct link to heading">#</a></h2><p>The Amido Stacks Scaffolding CLI can be used to create a fully-functional and deployable project from a template, in a variety of flavours.
It includes tests (unit, integration), together with infrastructure and deployment definitions. All by running from your CLI.</p><p>We use <code>npx</code> to execute and create the
<a href="https://www.npmjs.com/package/@amidostacks/scaffolding-cli" target="_blank" rel="noopener noreferrer">template-cli</a>
<a href="https://www.npmjs.com/package/npx" target="_blank" rel="noopener noreferrer">npx</a>.</p><p>We are supporting and running <a href="https://nodejs.org/en/about/releases/" target="_blank" rel="noopener noreferrer">node@12</a>.
Please ensure that your local environment has the correct version <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">installed</a>.</p><p>To run the Scaffolding CLI, use the following commands</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npx @amidostacks/scaffolding-cli@latest run -i</span></div></div></div></div></div><p>You will be asked a number of questions. Based on the answers, your ready-to-build project template will be produced.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started-with-the-dotnet-application" class="table-of-contents__link">GETTING STARTED WITH THE DOTNET APPLICATION</a><ul><li><a href="#running-the-application-locally" class="table-of-contents__link">RUNNING THE APPLICATION LOCALLY</a></li><li><a href="#using-a-docker-image" class="table-of-contents__link">USING A DOCKER IMAGE</a></li></ul></li><li><a href="#using-the-stacks-dotnet-template" class="table-of-contents__link">USING THE STACKS DOTNET TEMPLATE</a><ul><li><a href="#installing-the-template" class="table-of-contents__link">INSTALLING THE TEMPLATE</a></li><li><a href="#create-a-new-application-using-the-template" class="table-of-contents__link">CREATE A NEW APPLICATION USING THE TEMPLATE</a></li><li><a href="#running-the-application" class="table-of-contents__link">RUNNING THE APPLICATION</a></li></ul></li><li><a href="#using-the-scaffolding-cli-to-create-a-dotnet-project" class="table-of-contents__link">USING THE SCAFFOLDING CLI TO CREATE A DOTNET PROJECT</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/stacks/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About Us</h4><ul class="footer__items"><li class="footer__item"><a href="https://amido.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amido</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 Amido Ltd</div></div></div></footer></div>
<script src="/stacks/styles.a6852552.js"></script>
<script src="/stacks/runtime~main.9a8fc084.js"></script>
<script src="/stacks/main.cadd894d.js"></script>
<script src="/stacks/1.36f270ee.js"></script>
<script src="/stacks/2.f8126f4c.js"></script>
<script src="/stacks/3.ca7332ad.js"></script>
<script src="/stacks/1be78505.44e463b6.js"></script>
<script src="/stacks/91.84bf3977.js"></script>
<script src="/stacks/935f2afb.0c55464b.js"></script>
<script src="/stacks/17896441.fdf225da.js"></script>
<script src="/stacks/5ab29772.e11a6097.js"></script>
</body>
</html>