<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="search" type="application/opensearchdescription+xml" title="Amido Stacks " href="/stacks/opensearch.xml"><title data-react-helmet="true">Azure Core Infrastructure | Amido Stacks </title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Azure Core Infrastructure | Amido Stacks "><meta data-react-helmet="true" name="description" content="The core infrastructure is the foundation for all other Stacks Workloads. As, in most cases, this will be the first part of Stacks that you deploy we will also cover bootstrapping your Azure tenant."><meta data-react-helmet="true" property="og:description" content="The core infrastructure is the foundation for all other Stacks Workloads. As, in most cases, this will be the first part of Stacks that you deploy we will also cover bootstrapping your Azure tenant."><meta data-react-helmet="true" property="og:url" content="https://amido.github.io/stacks/docs/infrastructure/azure/core_infrastructure"><link data-react-helmet="true" rel="shortcut icon" href="/stacks/img/thumbnail_stacks.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://amido.github.io/stacks/docs/infrastructure/azure/core_infrastructure"><link rel="stylesheet" href="/stacks/styles.356b3251.css">
<link rel="preload" href="/stacks/styles.f64d6e6d.js" as="script">
<link rel="preload" href="/stacks/runtime~main.62355d27.js" as="script">
<link rel="preload" href="/stacks/main.793bf121.js" as="script">
<link rel="preload" href="/stacks/1.fb567102.js" as="script">
<link rel="preload" href="/stacks/2.55fe16f1.js" as="script">
<link rel="preload" href="/stacks/3.3daf453a.js" as="script">
<link rel="preload" href="/stacks/1be78505.58a6d2b9.js" as="script">
<link rel="preload" href="/stacks/118.379b2dd0.js" as="script">
<link rel="preload" href="/stacks/935f2afb.0cc35838.js" as="script">
<link rel="preload" href="/stacks/17896441.a68934af.js" as="script">
<link rel="preload" href="/stacks/dafaefe7.21a5ca36.js" as="script">
<link rel="preload" href="/stacks/3ccbe900.be26859e.js" as="script">
<link rel="preload" href="/stacks/3dbbb6bc.b955e55c.js" as="script">
<link rel="preload" href="/stacks/3deea674.082d8904.js" as="script">
<link rel="preload" href="/stacks/40932100.1e1bf8eb.js" as="script">
<link rel="preload" href="/stacks/414e16ac.c3f77b18.js" as="script">
<link rel="preload" href="/stacks/52351b48.ee71fb7e.js" as="script">
<link rel="preload" href="/stacks/560e98d8.446a903d.js" as="script">
<link rel="preload" href="/stacks/570a173c.da9c1ac2.js" as="script">
<link rel="preload" href="/stacks/6b834008.4c1e20e1.js" as="script">
<link rel="preload" href="/stacks/6e17e9f9.a6fd5438.js" as="script">
<link rel="preload" href="/stacks/764eb613.a87fcc8d.js" as="script">
<link rel="preload" href="/stacks/7a17dc8a.790158d3.js" as="script">
<link rel="preload" href="/stacks/83b4c89e.ffdd5018.js" as="script">
<link rel="preload" href="/stacks/9528a569.3c709741.js" as="script">
<link rel="preload" href="/stacks/a3c86d12.e894a404.js" as="script">
<link rel="preload" href="/stacks/a95d0d0e.06943e31.js" as="script">
<link rel="preload" href="/stacks/b5831b65.8c6d08dc.js" as="script">
<link rel="preload" href="/stacks/b5d03cf8.4c47aad0.js" as="script">
<link rel="preload" href="/stacks/d21d2c84.96159d2e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/stacks/docs/">Docs</a><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/stacks/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Learn about Stacks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/">About Stacks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/contributions">New Contributions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/code_of_conduct">Code of conduct</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/workloads">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Azure</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Frontend Web Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/ide_node_js">IDE Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/monorepo">Stacks Monorepo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/state-management">State Management Patterns</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Client Side Rendering</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/cli_webapp_frameworks_csr">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/api_definition_crs">Api Definition</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/logging_node_js_crs">Logging and Instrumentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/infrastructure_csr">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/pipeline_csr">Pipeline</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Server  Side Rendering</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/cli_webapp_frameworks_ssr">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/cms">CMS - Contentful Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/identity">Identity using Auth0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/api_definition">Api Definition</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/logging_node_js">Logging and Instrumentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/server_side_cache">Server Side Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/infrastructure_ssr">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/pipeline_ssr">Pipeline</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/frontend/browser_support">Browser Support</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Backend Services</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Java Spring Boot REST API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/intro_java">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/requirements_java">Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java">Cosmos DB Emulator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/quickstart_java">Getting started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/scaffolding_java">Using the Scaffolding CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/ide_java">IDE guidelines</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/architecture_java">Architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/structure_java">Project structure</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/infrastructure_java">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/pipeline_java">Pipeline</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Testing The API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/testing_java">Pre-deployment tests and reports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/execute_serenity_api_tests">REST API testing with Serenity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java/execute_karate_api_tests">REST API testing with Karate</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Java Spring Boot REST API with CQRS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/intro_java_cqrs">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/requirements_java_cqrs">Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/setting_up_cosmos_db_locally_java_cqrs">Cosmos DB Emulator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/quickstart_java_cqrs">Getting started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/scaffolding_java_cqrs">Using the Scaffolding CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/ide_java_cqrs">IDE guidelines</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/architecture_java_cqrs">Architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/structure_java_cqrs">Project structure</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/infrastructure_java_cqrs">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/pipeline_java_cqrs">Pipeline</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Testing The API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/testing_java_cqrs">Pre-deployment tests and Reports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/execute_serenity_api_tests">REST API testing with Serenity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/java_cqrs/execute_karate_api_tests">REST API testing with Karate</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">.NET Core REST API with CQRS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/introduction_netcore">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/quickstart/requirements_netcore">Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/quickstart/create_project_netcore">Create the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/quickstart/configure_project_netcore">Configure the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/quickstart/build_and_run_project_netcore">Build &amp; Run the Project</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/testing/functional_testing_netcore">Testing the API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/infrastructure_netcore">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/pipeline_netcore">Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/logging_netcore">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/security_netcore">Security</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/architecture_overview_netcore">Architecture Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/repository_overview_netcore">Repository Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/project_structure_netcore">Solution Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/data_storage_cosmosdb_netcore">Data Storage - CosmosDB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/operations_events_exceptions_correlation_netcore">Operations, Events, Exceptions and Correlation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Swagger Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/swagger_configuration/configure_swagger_netcore">Swagger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/azure/backend/netcore/architecture/swagger_configuration/configure_swagger_ui_netcore">Swagger UI</a></li></ul></li></ul></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Google Cloud Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/gcp/workloads_gcp_readme">Workloads on GCP</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Amazon Web Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/aws/workloads_aws_readme">Workloads on AWS</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Infrastructure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/stacks/docs/infrastructure/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Azure</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/stacks/docs/infrastructure/azure/core_infrastructure">Core Infrastructure</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Pipelines</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/infrastructure/azure/pipelines/azure_devops">Azure DevOps</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quality Assurance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/cli_testing_frameworks">Stacks Testing Frameworks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_java_serenity_bdd">Java - Serenity BDD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_dotnet_selenium">C# - Selenium .NET</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/cypress_functional_testing">Cypress - Functional Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testcafe_functional_testing">TestCafe - Functional Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_static_analysis">Static Code Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/visual_analysis">Automated UI Visual Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/contract_testing_pact">API Contract Testing With Pact</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/accessibility_testing">Automated Accessibility Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/performance_testing_gatling">Gatling Performance Testing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Azure Core Infrastructure</h1></header><div class="markdown"><p>The core infrastructure is the foundation for all other Stacks Workloads. As, in most cases, this will be the first part of Stacks that you deploy we will also cover bootstrapping your Azure tenant.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resources-provisioned"></a>Resources Provisioned<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resources-provisioned" title="Direct link to heading">#</a></h2><p>Both the diagram and resource list below are for a single environment. By default, the pipeline template will create two environments (nonprod and prod).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="diagram"></a>Diagram<a aria-hidden="true" tabindex="-1" class="hash-link" href="#diagram" title="Direct link to heading">#</a></h3><img alt="Azure Core Infrastructure" src="/stacks/img/azure_core_infrastructure.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resource-list"></a>Resource List<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resource-list" title="Direct link to heading">#</a></h3><table><thead><tr><th>Resource</th><th>Description</th></tr></thead><tbody><tr><td>Resource Group</td><td>Used to logically group infrastructure</td></tr><tr><td>Virtual Network</td><td>Fundamental building block for the private network</td></tr><tr><td>Subnet - AGW</td><td>Dedicated subnet required for Application Gateway</td></tr><tr><td>Application Gateway</td><td>Web traffic load balancer</td></tr><tr><td>Public IP</td><td>IP address associated with the Application Gateway</td></tr><tr><td>Subnet - k8s</td><td>Subnet used by the AKS cluster</td></tr><tr><td>AKS</td><td>Azure Kubernetes Service</td></tr><tr><td>Resource Group: Node Pool</td><td>AKS created resource group for nodes, load balancers, etc.</td></tr><tr><td>Internal Load Balancer</td><td>Load balancer used with NGINX ingress</td></tr><tr><td>VM Scale Set: Nodes</td><td>Virtual Machine scaling for AKS</td></tr><tr><td>NGINX Ingress</td><td>Nginx ingress Kubernetes namespace, deployment and service</td></tr><tr><td>Internal DNS Zone</td><td>Custom DNS domain</td></tr><tr><td>Public DNS Zone</td><td>Hosted service for DNS domain</td></tr><tr><td>Application Insights</td><td>Application performance management, monitoring and analytics service</td></tr><tr><td>Log Analytics Workspace</td><td>Log analytics with container insights</td></tr><tr><td>Managed Identity</td><td>Managed Identity with aadpodidentity binding</td></tr><tr><td>ACR</td><td>Azure Container Registry</td></tr><tr><td>Key Vault</td><td>Cryptographic keys and secrets management service</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploying"></a>Deploying<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploying" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bootstrap-the-azure-tenant"></a>Bootstrap the Azure tenant<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bootstrap-the-azure-tenant" title="Direct link to heading">#</a></h3><p>The first step is to create the Azure tenant and subscription. This process only needs to be run once on an administrators workstation.</p><p>The administrator will need the following permissions:</p><ul><li>Azure AD &quot;Global Administrator&quot; role for the Azure AD Tenant</li><li>IAM subscription owner</li></ul><p>With owner privileges:</p><ol><li>Create an <a href="https://www.terraform.io/docs/providers/azurerm/guides/service_principal_client_secret.html" target="_blank" rel="noopener noreferrer">Azure Service Principal</a> for use with Terraform.<ul><li>Make note of the TenantID, SubscriptionID, ClientID and ClientSecret</li></ul></li><li>Create a <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-create" target="_blank" rel="noopener noreferrer">Blob Storage instance</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/storage/container?view=azure-cli-latest#az_storage_container_create" target="_blank" rel="noopener noreferrer">container</a> for storing Terraform state.<ul><li>Take note of the storage account and container name.</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-scaffolding-cli"></a>Using the Scaffolding CLI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-scaffolding-cli" title="Direct link to heading">#</a></h3><p>The <a href="https://www.npmjs.com/package/@amidostacks/scaffolding-cli" target="_blank" rel="noopener noreferrer">Amido Stacks Scaffolding CLI</a> can be used to create a project consisting of the core infrastructure as code scripts and the deployment pipeline.</p><p>We are supporting and running <a href="https://nodejs.org/en/about/releases/" target="_blank" rel="noopener noreferrer">node@12</a>.
Please ensure that your local environment has the correct version <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">installed</a>.</p><p>To run the Scaffolding CLI, use the following command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">npx @amidostacks/scaffolding-cli@latest run -i</span></div></div></div></div></div><p>You will be asked a number of questions. Make sure to select <code>Azure</code> and <code>Cloud platform shared services</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pipelines"></a>Pipelines<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pipelines" title="Direct link to heading">#</a></h3><p>The following pipelines are currently supported for automating the deployment:</p><ul><li><a href="/stacks/docs/infrastructure/azure/pipelines/azure_devops">Azure DevOps</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-locally"></a>Running Locally<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-locally" title="Direct link to heading">#</a></h3><p>Currently, vars.tf and provider configuration is not
automatically updated. Future iterations will include this.</p><p>The safest way to run and maintain this locally is to rely on Docker and environment
variables as that is the way the pipeline will trigger the
executions of Terraform.</p><p>Sample commands with example environment vars:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Navigate to the infra directory</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${YOUR_DIRECTORY_PATH}</span><span class="token plain">/deploy/azure/infra</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run Amido Terraform Docker container</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">docker run -v </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">:/usr/data --rm -it amidostacks/ci-tf:0.0.4 /bin/bash</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">###########################################################################</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># All commands from this point should be executed in the Docker container #</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">###########################################################################</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Navigate to /usr/data directory</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/data</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Export Azure Credentials. Replace the example values.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARM_CLIENT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1111</span><span class="token plain">-2222-3333-444 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ARM_CLIENT_SECRET</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1111</span><span class="token plain">-2222-3333-4444 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ARM_SUBSCRIPTION_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1111</span><span class="token plain">-2222-3333-444 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ARM_TENANT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1111</span><span class="token plain">-2222-3333-444</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Export Terraform variables. Replace the example values.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_resource_group_location</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">uksouth </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_name_company</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">amido </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_name_project</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">example </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_name_component</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">core </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_name_environment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nonprod </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_create_acr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_acme_email</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">example@amidostacks.com </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_is_cluster_private</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_cluster_version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1.17</span><span class="token plain">.11 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_stage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nonprod </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_key_vault_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">example-core-nonprod </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_dns_zone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nonprod.amidostacks.com </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_internal_dns_zone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nonprod.amidostacks.internal</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Initial Terraform. Replace the example values.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">terraform init </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">-backend-config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;resource_group_name=amido-stacks-terraform&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">-backend-config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;storage_account_name=amidostacksterraform&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">-backend-config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;container_name=tfstate&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">-backend-config</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;key=example-core&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Select or create the &quot;nonprod&quot; workspace.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">terraform workspace </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> nonprod </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> terraform workspace new nonprod</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check the plan matches your expected changes. </span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span></div></div></div></div></div><div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/stacks/docs/infrastructure/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Infrastructure Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/stacks/docs/infrastructure/azure/pipelines/azure_devops"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Azure DevOps Pipeline Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resources-provisioned" class="table-of-contents__link">Resources Provisioned</a><ul><li><a href="#diagram" class="table-of-contents__link">Diagram</a></li><li><a href="#resource-list" class="table-of-contents__link">Resource List</a></li></ul></li><li><a href="#deploying" class="table-of-contents__link">Deploying</a><ul><li><a href="#bootstrap-the-azure-tenant" class="table-of-contents__link">Bootstrap the Azure tenant</a></li><li><a href="#using-the-scaffolding-cli" class="table-of-contents__link">Using the Scaffolding CLI</a></li><li><a href="#pipelines" class="table-of-contents__link">Pipelines</a></li><li><a href="#running-locally" class="table-of-contents__link">Running Locally</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/stacks/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About Us</h4><ul class="footer__items"><li class="footer__item"><a href="https://amido.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amido</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 Amido Ltd</div></div></div></footer></div>
<script src="/stacks/styles.f64d6e6d.js"></script>
<script src="/stacks/runtime~main.62355d27.js"></script>
<script src="/stacks/main.793bf121.js"></script>
<script src="/stacks/1.fb567102.js"></script>
<script src="/stacks/2.55fe16f1.js"></script>
<script src="/stacks/3.3daf453a.js"></script>
<script src="/stacks/1be78505.58a6d2b9.js"></script>
<script src="/stacks/118.379b2dd0.js"></script>
<script src="/stacks/935f2afb.0cc35838.js"></script>
<script src="/stacks/17896441.a68934af.js"></script>
<script src="/stacks/dafaefe7.21a5ca36.js"></script>
<script src="/stacks/3ccbe900.be26859e.js"></script>
<script src="/stacks/3dbbb6bc.b955e55c.js"></script>
<script src="/stacks/3deea674.082d8904.js"></script>
<script src="/stacks/40932100.1e1bf8eb.js"></script>
<script src="/stacks/414e16ac.c3f77b18.js"></script>
<script src="/stacks/52351b48.ee71fb7e.js"></script>
<script src="/stacks/560e98d8.446a903d.js"></script>
<script src="/stacks/570a173c.da9c1ac2.js"></script>
<script src="/stacks/6b834008.4c1e20e1.js"></script>
<script src="/stacks/6e17e9f9.a6fd5438.js"></script>
<script src="/stacks/764eb613.a87fcc8d.js"></script>
<script src="/stacks/7a17dc8a.790158d3.js"></script>
<script src="/stacks/83b4c89e.ffdd5018.js"></script>
<script src="/stacks/9528a569.3c709741.js"></script>
<script src="/stacks/a3c86d12.e894a404.js"></script>
<script src="/stacks/a95d0d0e.06943e31.js"></script>
<script src="/stacks/b5831b65.8c6d08dc.js"></script>
<script src="/stacks/b5d03cf8.4c47aad0.js"></script>
<script src="/stacks/d21d2c84.96159d2e.js"></script>
</body>
</html>