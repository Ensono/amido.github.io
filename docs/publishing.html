<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Publishing Packages · Amido Stacks</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="⚠️ IMPORTANT: all packages are versioned and published using"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Publishing Packages · Amido Stacks"/><meta property="og:type" content="website"/><meta property="og:url" content="https://amido.github.io/stacks/"/><meta property="og:description" content="⚠️ IMPORTANT: all packages are versioned and published using"/><meta property="og:image" content="https://amido.github.io/stacks/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="robots" content="noindex"/><link rel="shortcut icon" href="/stacks/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script src="/stacks/js/scrollSpy.js"></script><link rel="stylesheet" href="/stacks/css/main.css"/><script src="/stacks/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/stacks/"><img class="logo" src="/stacks/img/thumbnail_stacks.png" alt="Amido Stacks"/><h2 class="headerTitleWithLogo">Amido Stacks</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/stacks/docs/" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/stacks/docs/monorepo" target="_self">About Stacks</a></li><li class=""><a href="https://github.com/amido/stacks" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/stacks/docs/">About Amido Stacks</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/getting_started_demo">Demo - Using the scaffolding-cli to build an application</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/getting_started_dev">Dev - Using the repo to build an application</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/monorepo">Stacks Monorepo</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/stacks/docs/deployment">Deployment</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/stacks/docs/publishing">Publishing Packages</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/publishing_nuget">Publishing NuGet Packages</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/pipeline_templates">Pipeline Templates</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/infrastructure_code">Infrastructure</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Testing<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/stacks/docs/testing">Testing and Quality</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/testing_static">Static Code Analysis</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Packages<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/stacks/docs/packages">Packages</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/cli_process">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Supporting Docs<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/stacks/docs/browser_support">Browser Support</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/server_side_cache">Server Side Cache</a></li><li class="navListItem"><a class="navItem" href="/stacks/docs/faq">FAQ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="/edit/master/docs/publishing.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Publishing Packages</h1></header><article><div><span><p>⚠️ IMPORTANT: all packages are versioned and published using
<a href="https://lernajs.io">Lerna</a>, as defined by scripts at the root of the
repository. Please do not version packages manually in their package
directories.</p>
<h2><a class="anchor" aria-hidden="true" id="how-do-i-bump-the-version-on-a-package-and-publish"></a><a href="#how-do-i-bump-the-version-on-a-package-and-publish" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do I bump the version on a package and publish?</h2>
<ol>
<li>Make changes and commit them to origin/branch</li>
<li>Ensure your <code>git status</code> is porcelian</li>
<li>On your <em>local</em> machine at the root of the repo (executing the
<a href="../package.json">version script</a>): <code>npm run version</code></li>
<li>Commit the automatically generated changes</li>
<li>Raise a PR to origin/master</li>
<li>The CI pipeline will then publish the changes for you</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="what-registry-are-we-using"></a><a href="#what-registry-are-we-using" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What registry are we using?</h2>
<p>All of our packages are opensource and can be found under the @amidostacks
organisation on <a href="https://www.npmjs.com/settings/amidostacks/packages">npm</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="do-i-need-access-to-the-registry-to-be-able-to-publish"></a><a href="#do-i-need-access-to-the-registry-to-be-able-to-publish" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Do I need access to the registry to be able to publish?</h2>
<p>No, the CI pipeline will publish for you. If you have maintainer access to the
Github repo then you can commit your changes with the version bump, and let the
pipeline do the rest (if it passes all the tests that is).</p>
<h2><a class="anchor" aria-hidden="true" id="our-packages"></a><a href="#our-packages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Our Packages</h2>
<p><code>stacks-webapp-template</code> is a <a href="/stacks/docs/monorepo">monorepo</a>, meaning it is divided
into independent sub-packages.</p>
<p>These packages can be found in the packages/ directory:</p>
<pre><code class="hljs">packages/
  elint-<span class="hljs-built_in">config</span>/
  <span class="hljs-keyword">template</span>-cli/
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="package-registry"></a><a href="#package-registry" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Package Registry</h2>
<p>All our packages are publically available from <code>npm</code>:
<a href="https://www.npmjs.com/org/amidostacks">https://www.npmjs.com/org/amidostacks</a></p>
<h2><a class="anchor" aria-hidden="true" id="package-management"></a><a href="#package-management" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Package Management</h2>
<p>We are following in the footsteps of
<a href="https://github.com/facebook/create-react-app">create-react-app</a> and using
<a href="https://lernajs.io">Lerna</a> which can be installed using
<a href="https://www.npmjs.com/package/lerna">npm</a>.</p>
<p>Lerna is configured to publish all changes in <a href="../packages">packages</a> once any
changes have passed the pipeline gates as defined in
<a href="build/azDevOps/azure/">build/azDevOps/azure</a>. Note that it's then up the
consumers of the packages to update their versions as needed.</p>
<h2><a class="anchor" aria-hidden="true" id="automated-package-publishing"></a><a href="#automated-package-publishing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Automated Package Publishing</h2>
<p>Lerna is embedded as a step in the <a href="/stacks/docs/monorepo">monorepo</a> pipeline. Check out
the pipeline step
<a href="./build/azDevOps/azure/templates/steps/publish-packages-lerna.yml">publish-packages-lerna.yml</a>
for more informatiion on how this is done.</p>
<p>This automates the following process:</p>
<ol>
<li>the version is bumped from the conventional commits <code>npm run version</code></li>
<li><code>package.json</code> version is changed</li>
<li>the changes are to be merged to master (CHANGELOG.md, version in packages)</li>
<li>in the pipeline, this triggers lerna to look for difference in package
version and the registrry</li>
<li>if changes are found the packages are published to the configured registry</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="why-do-version-bumps-require-manual-commit"></a><a href="#why-do-version-bumps-require-manual-commit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do version bumps require manual commit?</h3>
<p>Because we think it's up the the deveopers to ensure that they want to bump the
version, based on their commit history.</p>
<h3><a class="anchor" aria-hidden="true" id="why-have-we-automated-publishing"></a><a href="#why-have-we-automated-publishing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why have we automated publishing?</h3>
<p>We think it's good practice to test changes before publishing it to our
<a href="https://www.npmjs.com/settings/amidostacks/packages">public npm registry</a>. so
you know it's free of errors. We only publish from master in the pipeline.</p>
<h2><a class="anchor" aria-hidden="true" id="versioning"></a><a href="#versioning" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Versioning</h2>
<p>We are versioning as a seperate script in order to support publishing from a CI
pipeline, and to automate the creation of changelogs based on the commit
history.</p>
<p>From root, run: <code>npm run version</code></p>
<h3><a class="anchor" aria-hidden="true" id="what-does-version-do"></a><a href="#what-does-version-do" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What does <code>version</code> do?</h3>
<ol>
<li>Identifies packages that have been updated since the previous tagged release.</li>
<li>Bumps the version based on the Conventional Commits Specification</li>
<li>Updates CHANGELOG.md and updates the package.json if needed</li>
</ol>
<p>The changes are then ready to be commited to the remote.</p>
<h3><a class="anchor" aria-hidden="true" id="why-do-we-use-lerna-version---conventional-commits"></a><a href="#why-do-we-use-lerna-version---conventional-commits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do we use <code>lerna version --conventional-commits</code>?</h3>
<blockquote>
<p>When run with this flag, lerna version will use the Conventional Commits
Specification to determine the version bump and generate CHANGELOG.md files.
[2][2]:
<a href="https://github.com/lerna/lerna/tree/master/commands/version#--conventional-commits">https://github.com/lerna/lerna/tree/master/commands/version#--conventional-commits</a></p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="why-do-we-use-lerna-publish-from-package"></a><a href="#why-do-we-use-lerna-publish-from-package" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do we use <code>lerna publish from-package</code>?</h3>
<ol>
<li>We reduce risk of Git conflicts;</li>
<li>The versioning can occur idependently;</li>
<li>Lerna will need to commiting the <code>gitHead</code> SHA to the package.json of the
package;</li>
<li>If a publish fails, then it will try again.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="why-do-we-use---no-git-tag-version"></a><a href="#why-do-we-use---no-git-tag-version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do we use <code>--no-git-tag-version</code>?</h3>
<p>By default, lerna version will commit changes to package.json files and tag the
release. Since we are publishing <code>from-package</code> and doing so in the pipeline, we
would rather suggest creating a seperate Github release task that would run on
successful Lerna publishing to the registry.</p>
<h3><a class="anchor" aria-hidden="true" id="why-do-we-use---no-push"></a><a href="#why-do-we-use---no-push" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do we use <code>--no-push</code>?</h3>
<p>By default, lerna version will push the committed and tagged changes to the
configured git remote. We disable this to ensure that the changelog and vrsion
bumps are obvious on local, and it's up to the develop to commit them to their
working branch.</p>
<h2><a class="anchor" aria-hidden="true" id="conventional-commits"></a><a href="#conventional-commits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conventional Commits</h2>
<p>We generate our CHANGELOGS.md automagically based on the <code>git commit</code>. The
commit itself communicates the <strong>WHAT</strong>, whereas commit message communicates the
<strong>WHY</strong>.</p>
<h3><a class="anchor" aria-hidden="true" id="what-is-a-commit"></a><a href="#what-is-a-commit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is a commit?</h3>
<p><a href="https://git-scm.com/docs/git-commit"><code>git commit</code></a> is a git command that is
used to record your changes to the local repository.</p>
<h3><a class="anchor" aria-hidden="true" id="why-are-we-using-conventional-commits"></a><a href="#why-are-we-using-conventional-commits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why are we using Conventional Commits?</h3>
<ul>
<li>Automatically generating CHANGELOGs.</li>
<li>Automatically determining a semantic version bump (based on the types of
commits landed).</li>
<li>Communicating the nature of changes to teammates, the public, and other
stakeholders.</li>
<li>Triggering publish processes.</li>
<li>Making it easier for people to contribute to your projects, by allowing them
to explore a more structured commit history.</li>
</ul>
<p><em>Source:
<a href="https://www.conventionalcommits.org/en/v1.0.0/#why-use-conventional-commits">https://www.conventionalcommits.org/en/v1.0.0/#why-use-conventional-commits</a></em></p>
<h3><a class="anchor" aria-hidden="true" id="how-do-we-enforce-conventional-commits"></a><a href="#how-do-we-enforce-conventional-commits" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do we enforce Conventional Commits?</h3>
<p>We use precommit hooks with <a href="https://github.com/typicode/husky">Husky</a> and
<a href="https://github.com/conventional-changelog/commitlint">commitlint</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="what-are-the-commit-conventions-format"></a><a href="#what-are-the-commit-conventions-format" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What are the commit conventions format?</h3>
<p><code>type(scope?): subject</code></p>
<p>Where:</p>
<ul>
<li><a href="https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional#type-enum"><code>'type'=</code></a>
<pre><code class="hljs css language-js">;[
  <span class="hljs-string">'build'</span>,
  <span class="hljs-string">'ci'</span>,
  <span class="hljs-string">'chore'</span>,
  <span class="hljs-string">'docs'</span>,
  <span class="hljs-string">'feat'</span>,
  <span class="hljs-string">'fix'</span>,
  <span class="hljs-string">'perf'</span>,
  <span class="hljs-string">'refactor'</span>,
  <span class="hljs-string">'revert'</span>,
  <span class="hljs-string">'style'</span>,
  <span class="hljs-string">'test'</span>,
]
</code></pre></li>
<li><code>scope?=</code> optional, addresses the specific area of change, or feature</li>
<li><code>subject=</code> why you are making the commit in the first place</li>
</ul>
<p>Examples: <code>chore: to run tests on travis ci</code></p>
<p><code>fix(server): to send cors headers</code></p>
<p><code>feat(blog): to add comment section</code></p>
<h2><a class="anchor" aria-hidden="true" id="publishing"></a><a href="#publishing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing</h2>
<p>From root, run: <code>npm run publish</code></p>
<h3><a class="anchor" aria-hidden="true" id="what-does-publish-do"></a><a href="#what-does-publish-do" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What does <code>publish</code> do?</h3>
<ol>
<li>explicitly publish packages where the latest version is not present in the
registry (from-package).</li>
</ol>
<p><em>Lerna will never publish packages which are marked as private (&quot;private&quot;: true
in the package.json).</em></p>
<h3><a class="anchor" aria-hidden="true" id="what-happens-in-ci"></a><a href="#what-happens-in-ci" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What happens in CI?</h3>
<p>We check if the package version is up to date with the registry. If it's a head,
then we publish the changes.</p>
<h3><a class="anchor" aria-hidden="true" id="why-do-we-use-lerna-publish-from-package-1"></a><a href="#why-do-we-use-lerna-publish-from-package-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why do we use <code>lerna publish from-package</code>?</h3>
<blockquote>
<p>keyword except the list of packages to publish is determined by inspecting
each <code>package.json</code> and determining if any package version is not present in
the registry. Any versions not present in the registry will be published. This
is useful when a previous lerna publish failed to publish all packages to the
registry. <a href="https://github.com/lerna/lerna/tree/master/commands/publish#bump-from-package">1</a></p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="lessons-learnt-with-lerna"></a><a href="#lessons-learnt-with-lerna" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lessons learnt with Lerna</h2>
<p>We have encountered a lot of issues while using Lerna for versioning and
publishing in a pipeline. Namely the following:</p>
<ol>
<li>Lerna expects master to be un protected and able to push to it -
<a href="https://github.com/lerna/lerna/issues/1957">https://github.com/lerna/lerna/issues/1957</a></li>
<li>When using <code>from-package</code> the GitHead SHA needs to be commited POST
publishing to a registry. This requires the publish task in the pipeline to
commit this to master.</li>
<li>When using <code>from-package</code> the Git Tag needs to be commited POST publishing to
registry. This requires custom tasks for tagging releases.</li>
<li>Lerna cannot version or publish in a detached HEAD state, making pipeline
versioning and publishing really hard.</li>
<li>It should probably just be done locally...</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="faq"></a><a href="#faq" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FAQ</h2>
<p>Q: What happens if the pipeline fails with error about working tree with uncommitted changes?
A: If you see the following error in the logs on the <code>Publish: Publish packages using lerna</code> task:</p>
<pre><code class="hljs css language-log">lerna ERR! EUNCOMMIT Working tree <span class="hljs-built_in">has</span> uncommitted <span class="hljs-keyword">changes</span>, please commit <span class="hljs-built_in">or</span> <span class="hljs-built_in">remove</span> the following <span class="hljs-keyword">changes</span> before continuin<span class="hljs-variable">g:</span>
lerna ERR! EUNCOMMIT  M package-lock.json
</code></pre>
<p>This could mean that that the monorepo root <code>package.json</code> and <code>package-lock.json</code> are out of sync on <code>master</code> branch. Try deleting the <code>package-lock.json</code> and re-installing depedencies, and test then the new lock file.</p>
<pre><code class="hljs css language-bash">stacks-webapp-template $ rm package-lock.json
stacks-webapp-template $ npm install
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 4/27/2020 by estherthetesteramido</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/stacks/docs/deployment"><span class="arrow-prev">← </span><span>Deployment</span></a><a class="docs-next button" href="/stacks/docs/publishing_nuget"><span class="function-name-prevnext">Publishing NuGet Packages</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#how-do-i-bump-the-version-on-a-package-and-publish">How do I bump the version on a package and publish?</a></li><li><a href="#what-registry-are-we-using">What registry are we using?</a></li><li><a href="#do-i-need-access-to-the-registry-to-be-able-to-publish">Do I need access to the registry to be able to publish?</a></li><li><a href="#our-packages">Our Packages</a></li><li><a href="#package-registry">Package Registry</a></li><li><a href="#package-management">Package Management</a></li><li><a href="#automated-package-publishing">Automated Package Publishing</a><ul class="toc-headings"><li><a href="#why-do-version-bumps-require-manual-commit">Why do version bumps require manual commit?</a></li><li><a href="#why-have-we-automated-publishing">Why have we automated publishing?</a></li></ul></li><li><a href="#versioning">Versioning</a><ul class="toc-headings"><li><a href="#what-does-version-do">What does <code>version</code> do?</a></li><li><a href="#why-do-we-use-lerna-version---conventional-commits">Why do we use <code>lerna version --conventional-commits</code>?</a></li><li><a href="#why-do-we-use-lerna-publish-from-package">Why do we use <code>lerna publish from-package</code>?</a></li><li><a href="#why-do-we-use---no-git-tag-version">Why do we use <code>--no-git-tag-version</code>?</a></li><li><a href="#why-do-we-use---no-push">Why do we use <code>--no-push</code>?</a></li></ul></li><li><a href="#conventional-commits">Conventional Commits</a><ul class="toc-headings"><li><a href="#what-is-a-commit">What is a commit?</a></li><li><a href="#why-are-we-using-conventional-commits">Why are we using Conventional Commits?</a></li><li><a href="#how-do-we-enforce-conventional-commits">How do we enforce Conventional Commits?</a></li><li><a href="#what-are-the-commit-conventions-format">What are the commit conventions format?</a></li></ul></li><li><a href="#publishing">Publishing</a><ul class="toc-headings"><li><a href="#what-does-publish-do">What does <code>publish</code> do?</a></li><li><a href="#what-happens-in-ci">What happens in CI?</a></li><li><a href="#why-do-we-use-lerna-publish-from-package-1">Why do we use <code>lerna publish from-package</code>?</a></li></ul></li><li><a href="#lessons-learnt-with-lerna">Lessons learnt with Lerna</a></li><li><a href="#faq">FAQ</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/stacks/" class="nav-home"><img src="/stacks/img/thumbnail_stacks.png" alt="Amido Stacks" width="66" height="58"/></a><div><h5>Docs</h5><a href="/stacks/docs/en/index">Getting Started</a></div><div><h5>Community</h5><a href="https://amido.com/">Amido</a></div><div><h5>More</h5><a href="https://github.com/">GitHub</a></div></section><a href="https://github.com/amido/stacks" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/stacks/img/logo.png" alt="stacks" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Amido Ltd</section></footer></div><script src="http://localhost:undefined/livereload.js"></script></body></html>