"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[812],{8598:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>l});var s=t(4848),i=t(8453);const r={},a=void 0,d={id:"getting_started/next/next-auth",title:"next-auth",description:"@ensono-stacks/next:next-auth",source:"@site/docs/getting_started/next/next-auth.md",sourceDirName:"getting_started/next",slug:"/getting_started/next/next-auth",permalink:"/docs/getting_started/next/next-auth",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{}},o={},l=[{value:"@ensono-stacks/next",id:"ensono-stacks-next-next-auth",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Usage",id:"usage",level:2},{value:"Command line arguments",id:"command-line-arguments",level:3},{value:"Generator Output",id:"generator-output",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h3,{id:"ensono-stacks-next-next-auth",children:["@ensono-stacks/next",":next-auth"]}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"Add Next Authentication to your next application"}),(0,s.jsxs)(n.p,{children:["The next-auth generator will create a new library and configure ",(0,s.jsx)(n.a,{href:"https://next-auth.js.org/",children:"NextAuth.js"})," into an existing Next application. It will add the initial configuration, add the session provider, setup an API endpoint and add local environmental variables. It will also configure provider specific setup."]}),(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),(0,s.jsxs)(n.p,{children:["An existing ",(0,s.jsx)(n.a,{href:"https://nextjs.org/",children:"Next"})," application"]}),(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nx g @ensono-stacks/next:next-auth\n"})}),(0,s.jsx)(n.h3,{id:"command-line-arguments",children:"Command line arguments"}),(0,s.jsx)(n.p,{children:"The following command line arguments are available:"}),(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Accepted Values"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--name"}),(0,s.jsx)(n.td,{children:"The name of the library"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--directory"}),(0,s.jsx)(n.td,{children:"The location of where the library should be installed"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--project"}),(0,s.jsx)(n.td,{children:"The name of the project"}),(0,s.jsx)(n.td,{children:"nameOfApplication"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--provider"}),(0,s.jsx)(n.td,{children:"The provider to be installed"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"none, microsoft-entra-id, auth0"}),(0,s.jsx)(n.td,{children:"none"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--sessionStorage"}),(0,s.jsx)(n.td,{children:"The session storage to be used"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"cookie, redis"}),(0,s.jsx)(n.td,{children:"cookie"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--guestSession"}),(0,s.jsx)(n.td,{children:"Enable guest sessioins"}),(0,s.jsx)(n.td,{children:"boolean"}),(0,s.jsx)(n.td,{children:"true/false"}),(0,s.jsx)(n.td,{children:"true"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--importPath"}),(0,s.jsx)(n.td,{children:"The library name used to import it"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"--skipPackageJson"}),(0,s.jsxs)(n.td,{children:["Do not add dependencies to ",(0,s.jsx)(n.code,{children:"package.json"})]}),(0,s.jsx)(n.td,{children:"boolean"}),(0,s.jsx)(n.td,{children:"true/false"}),(0,s.jsx)(n.td,{children:"false"})]})]})]}),(0,s.jsx)(n.h3,{id:"generator-output",children:"Generator Output"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creates a new Library with the given name. Contains the configuration for Auth.js, including provider and adapter setup, config, and token rotation."}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",metastring:'title="Generated files"',children:"\u251c\u2500\u2500 auth\n\u2502   \u251c\u2500\u2500 src\n\u2502   \u2502   \u251c\u2500\u2500 actions\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 oauth.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 profile.ts\n\u2502   \u2502   \u251c\u2500\u2500 adapter\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 redis-adapter.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 redis-repository.ts\n\u2502   \u2502   \u251c\u2500\u2500 callbacks\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 jwt.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 session.ts\n\u2502   \u2502   \u251c\u2500\u2500 providers\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth0.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 guest.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 types\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.d.ts\n\u2502   \u2502   \u251c\u2500\u2500 utils\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 guards.ts\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 config.ts\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u251c\u2500\u2500 .eslintrc.json\n\u2502   \u251c\u2500\u2500 jest.config.ts\n\u2502   \u251c\u2500\u2500 project.json\n\u2502   \u251c\u2500\u2500 README.md\n\u2502   \u251c\u2500\u2500 tsconfig.json\n\u2502   \u251c\u2500\u2500 tsconfig.lib.json\n\u2514\u2500\u2500 \u2514\u2500\u2500 tsconfig.spec.json\n"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Creates a new Next API endpoint with the file name ",(0,s.jsx)(n.code,{children:"[...nextauth].ts"}),". This contains the dynamic route handler for NextAuth.js which will also contain all of your global NextAuth.js configurations. If you have specified a provider when running the generator this will be added to the providers array"]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="/apps/appName/src/app/api/auth/[...nextauth]/route.ts"',children:'import { handlers } from "@my-stacks-workspace/auth";\n\nexport const { GET, POST } = handlers;\n'})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Install the next-auth package and add to package.json, unless the ",(0,s.jsx)(n.code,{children:"--skipPackageJson"})," option was used"]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="/package.json"',children:'"dependencies": {\n    ...otherDependencies\n    "next-auth": "5.0.0-beta.19",\n    "ioredis": "5.4.1", // if using --sessionStorage=redis\n},\n'})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Create or append an ",(0,s.jsx)(n.code,{children:".env.local"})," file. Adding required next auth environmental variables. These will vary depending on the provider chosen."]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="/.env.local"',children:"NEXTAUTH_URL=http://localhost:4200\nNEXTAUTH_SECRET=secretValue\nAZURE_AD_CLIENT_ID=\nAZURE_AD_CLIENT_SECRET=\nAZURE_AD_TENANT_ID=\n"})}),(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Be sure to update the environmental variables with the values provided by your provider"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Wrap client components with a ",(0,s.jsx)(n.a,{href:"https://next-auth.js.org/getting-started/client#sessionprovider",children:"session provider"})," to access session state."]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:'title="/apps/appName/src/components/client-component.tsx"',children:'"use client";\n\nimport { useSession } from "next-auth/react";\n\nexport default function ClientComponent() {\n  const { data } = useSession();\n\n  if (!data || !data.user || data.user.role === "guest") {\n    return null;\n  }\n\n  return <div>{data.user.name}</div>;\n}\n'})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:'title="/apps/appName/src/app/page.tsx"',children:'import { SessionProvider } from "next-auth/react";\n\nimport { auth } from "@my-stacks-workspace/auth";\n\nimport ClientComponent from "../components/client-component";\nimport GuestSessionProvider from "../components/guest-session";\n\nexport default async function Index() {\n  const session = await auth();\n  return (\n    <>\n      <SessionProvider session={session}>\n        <GuestSessionProvider />\n        <ClientComponent />\n      </SessionProvider>\n    </>\n  );\n}\n'})}),(0,s.jsxs)(n.p,{children:["For further information please see the ",(0,s.jsx)(n.a,{href:"https://next-auth.js.org/getting-started/example#frontend---add-react-hook",children:"Getting Started Guide to Next Auth"})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var s=t(6540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);