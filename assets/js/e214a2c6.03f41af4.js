"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[6903],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return f}});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=r.createContext({}),u=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(a),p=o,f=d["".concat(i,".").concat(p)]||d[p]||m[p]||n;return a?r.createElement(f,l(l({ref:t},c),{},{components:a})):r.createElement(f,l({ref:t},c))}));function f(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,l=new Array(n);l[0]=p;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:o,l[1]=s;for(var u=2;u<n;u++)l[u]=a[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}p.displayName="MDXCreateElement"},5162:function(e,t,a){a.d(t,{Z:function(){return l}});var r=a(7294),o=a(6010),n={tabItem:"tabItem_Ymn6"};function l(e){var t=e.children,a=e.hidden,l=e.className;return r.createElement("div",{role:"tabpanel",className:(0,o.Z)(n.tabItem,l),hidden:a},t)}},4866:function(e,t,a){a.d(t,{Z:function(){return w}});var r=a(7462),o=a(7294),n=a(6010),l=a(2466),s=a(6550),i=a(1980),u=a(7392),c=a(12);function d(e){return function(e){var t,a;return null!=(t=null==(a=o.Children.map(e,(function(e){if(!e||(0,o.isValidElement)(e)&&(t=e.props)&&"object"==typeof t&&"value"in t)return e;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:a.filter(Boolean))?t:[]}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function m(e){var t=e.values,a=e.children;return(0,o.useMemo)((function(){var e=null!=t?t:d(a);return function(e){var t=(0,u.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,a])}function p(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function f(e){var t=e.queryString,a=void 0!==t&&t,r=e.groupId,n=(0,s.k6)(),l=function(e){var t=e.queryString,a=void 0!==t&&t,r=e.groupId;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:a,groupId:r});return[(0,i._X)(l),(0,o.useCallback)((function(e){if(l){var t=new URLSearchParams(n.location.search);t.set(l,e),n.replace(Object.assign({},n.location,{search:t.toString()}))}}),[l,n])]}function h(e){var t,a,r,n,l=e.defaultValue,s=e.queryString,i=void 0!==s&&s,u=e.groupId,d=m(e),h=(0,o.useState)((function(){return function(e){var t,a=e.defaultValue,r=e.tabValues;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!p({value:a,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+a+'" but none of its children has the corresponding value. Available values are: '+r.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return a}var o=null!=(t=r.find((function(e){return e.default})))?t:r[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:l,tabValues:d})})),b=h[0],v=h[1],k=f({queryString:i,groupId:u}),g=k[0],y=k[1],w=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:u}.groupId),a=(0,c.Nk)(t),r=a[0],n=a[1],[r,(0,o.useCallback)((function(e){t&&n.set(e)}),[t,n])]),_=w[0],E=w[1],C=function(){var e=null!=g?g:_;return p({value:e,tabValues:d})?e:null}();return(0,o.useLayoutEffect)((function(){C&&v(C)}),[C]),{selectedValue:b,selectValue:(0,o.useCallback)((function(e){if(!p({value:e,tabValues:d}))throw new Error("Can't select invalid tab value="+e);v(e),y(e),E(e)}),[y,E,d]),tabValues:d}}var b=a(2389),v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){var t=e.className,a=e.block,s=e.selectedValue,i=e.selectValue,u=e.tabValues,c=[],d=(0,l.o5)().blockElementScrollPositionUntilNextRender,m=function(e){var t=e.currentTarget,a=c.indexOf(t),r=u[a].value;r!==s&&(d(t),i(r))},p=function(e){var t,a=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":var r,o=c.indexOf(e.currentTarget)+1;a=null!=(r=c[o])?r:c[0];break;case"ArrowLeft":var n,l=c.indexOf(e.currentTarget)-1;a=null!=(n=c[l])?n:c[c.length-1]}null==(t=a)||t.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.Z)("tabs",{"tabs--block":a},t)},u.map((function(e){var t=e.value,a=e.label,l=e.attributes;return o.createElement("li",(0,r.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:function(e){return c.push(e)},onKeyDown:p,onClick:m},l,{className:(0,n.Z)("tabs__item",v.tabItem,null==l?void 0:l.className,{"tabs__item--active":s===t})}),null!=a?a:t)})))}function g(e){var t=e.lazy,a=e.children,r=e.selectedValue,n=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){var l=n.find((function(e){return e.props.value===r}));return l?(0,o.cloneElement)(l,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},n.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==r})})))}function y(e){var t=h(e);return o.createElement("div",{className:(0,n.Z)("tabs-container",v.tabList)},o.createElement(k,(0,r.Z)({},e,t)),o.createElement(g,(0,r.Z)({},e,t)))}function w(e){var t=(0,b.Z)();return o.createElement(y,(0,r.Z)({key:String(t)},e))}},1443:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return c},default:function(){return b},frontMatter:function(){return u},metadata:function(){return d},toc:function(){return p}});var r=a(7462),o=a(3366),n=(a(7294),a(3905)),l=a(4866),s=a(5162),i=["components"],u={id:"setting_up_cosmos_db_locally_java",title:"Cosmos DB Emulator",sidebar_label:"Cosmos DB Emulator",hide_title:!1,hide_table_of_contents:!1,description:"How to set up the Cosmos DB Emulator",keywords:["cosmos db","emulator","settings","template","certificate"]},c=void 0,d={unversionedId:"workloads/azure/backend/java/setting_up_cosmos_db_locally_java",id:"workloads/azure/backend/java/setting_up_cosmos_db_locally_java",title:"Cosmos DB Emulator",description:"How to set up the Cosmos DB Emulator",source:"@site/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java.md",sourceDirName:"workloads/azure/backend/java",slug:"/workloads/azure/backend/java/setting_up_cosmos_db_locally_java",permalink:"/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java",draft:!1,tags:[],version:"current",frontMatter:{id:"setting_up_cosmos_db_locally_java",title:"Cosmos DB Emulator",sidebar_label:"Cosmos DB Emulator",hide_title:!1,hide_table_of_contents:!1,description:"How to set up the Cosmos DB Emulator",keywords:["cosmos db","emulator","settings","template","certificate"]},sidebar:"docs",previous:{title:"Requirements",permalink:"/docs/workloads/azure/backend/java/requirements_java"},next:{title:"Getting started",permalink:"/docs/workloads/azure/backend/java/quickstart_java"}},m={},p=[{value:"Set up Cosmos DB Emulator locally",id:"set-up-cosmos-db-emulator-locally",level:2},{value:"Using the Cosmos DB Emulator to run the database locally",id:"using-the-cosmos-db-emulator-to-run-the-database-locally",level:3},{value:"Create the Cosmos DB structure",id:"create-the-cosmos-db-structure",level:3},{value:"Export Azure Cosmos DB Emulator certificates to use in the Java Application",id:"export-azure-cosmos-db-emulator-certificates-to-use-in-the-java-application",level:3},{value:"Determine which root certificates have been installed",id:"determine-which-root-certificates-have-been-installed",level:3},{value:"Download the certificate",id:"download-the-certificate",level:4},{value:"Import to Java trust store",id:"import-to-java-trust-store",level:4}],f={toc:p},h="wrapper";function b(e){var t=e.components,u=(0,o.Z)(e,i);return(0,n.kt)(h,(0,r.Z)({},f,u,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"set-up-cosmos-db-emulator-locally"},"Set up Cosmos DB Emulator locally"),(0,n.kt)("p",null,"The Azure CosmosDB Emulator provides a local environment that emulates the Azure Cosmos DB\nservice for development purposes. Using the Azure CosmosDB Emulator, you can develop and test\nyour application locally, without creating an Azure subscription or incurring any costs.\nLatest instruction can be found in ",(0,n.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator?tabs=cli%2Cssl-netstd21"},"here")),(0,n.kt)("h3",{id:"using-the-cosmos-db-emulator-to-run-the-database-locally"},"Using the Cosmos DB Emulator to run the database locally"),(0,n.kt)("p",null,"Download and install the latest version of ",(0,n.kt)("strong",{parentName:"p"},"CosmosDB Emulator"),". Once it's installed, it will be\navailable on ",(0,n.kt)("a",{parentName:"p",href:"https://localhost:8081/_explorer/index.html"},"localhost"),"."),(0,n.kt)(l.Z,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],mdxType:"Tabs"},(0,n.kt)(s.Z,{value:"windows",mdxType:"TabItem"},"You can also find the Emulator from Start Menu and type Azure CosmosDB Emulator."),(0,n.kt)(s.Z,{value:"unix",mdxType:"TabItem"},(0,n.kt)("p",null,"The ",(0,n.kt)("strong",{parentName:"p"},"CosmosDB Emulator")," service is primarily a Windows service, so using it in Unix/Linux/MacOS requires a few\nadditional steps. One of the simplest ways of running the emulator is to download\nthe ",(0,n.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cosmos-db/linux-emulator"},"Linux Emulator")," for Docker.\nPlease follow the installation instructions, with one exception: when running the Docker image, don't set\nthe ",(0,n.kt)("inlineCode",{parentName:"p"},"AZURE_COSMOS_EMULATOR_IP_ADDRESS_OVERRIDE=$ipaddr"),". Instead, set it to ",(0,n.kt)("inlineCode",{parentName:"p"},"127.0.0.1"),"."))),(0,n.kt)("p",null,"The value for ",(0,n.kt)("inlineCode",{parentName:"p"},"COSMOSDB_KEY")," can be found within the emulator. See Primary Key:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"cosmosdb",src:a(1366).Z,width:"2432",height:"792"}),"\nPlease, take a note of the cosmosdb URI, databaseName and key, as they will be needed to configure the\napplication in a further step."),(0,n.kt)("h3",{id:"create-the-cosmos-db-structure"},"Create the Cosmos DB structure"),(0,n.kt)("p",null,"Based on the template the CosmosDB has to contain a fixed structure."),(0,n.kt)("p",null,"Create a collection ",(0,n.kt)("inlineCode",{parentName:"p"},"Stacks")," with a container id ",(0,n.kt)("inlineCode",{parentName:"p"},"menu")," and the partition key ",(0,n.kt)("inlineCode",{parentName:"p"},"/id"),"."),(0,n.kt)("p",null,"Create a database called Ensono Stacks for the application, and a database called ",(0,n.kt)("inlineCode",{parentName:"p"},"CosmosDBPackage")," for the\nintegration tests of the CosmosDB package (using the same container id and partition key as the main database)."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"cosmosdb",src:a(3453).Z,width:"1238",height:"685"})),(0,n.kt)("br",null),(0,n.kt)("p",null,"The ",(0,n.kt)("strong",{parentName:"p"},"Ensono Stacks")," database should have a container called ",(0,n.kt)("strong",{parentName:"p"},"Menu")," partitioned by ",(0,n.kt)("strong",{parentName:"p"},"/id"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"cosmosdb",src:a(778).Z,width:"3840",height:"1267"})),(0,n.kt)("br",null),(0,n.kt)("h3",{id:"export-azure-cosmos-db-emulator-certificates-to-use-in-the-java-application"},"Export Azure Cosmos DB Emulator certificates to use in the Java Application"),(0,n.kt)(l.Z,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],mdxType:"Tabs"},(0,n.kt)(s.Z,{value:"windows",mdxType:"TabItem"},"Start the Windows Certificate manager by running certlm.msc and navigate to the Personal->Certificates folder and open the certificate with the friendly name DocumentDbEmulatorCertificate.",(0,n.kt)("p",null,(0,n.kt)("img",{alt:"certificates",src:a(1028).Z,width:"1497",height:"620"})),(0,n.kt)("p",null,"Follow the steps in ",(0,n.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator-export-ssl-certificates#export-emulator-certificate"},"Export the Azure Cosmos DB TLS/SSL certificate"),"\nAlso Export CosmosEmulatorSecretes following the above link."),(0,n.kt)("h3",{id:"determine-which-root-certificates-have-been-installed"},"Determine which root certificates have been installed"),(0,n.kt)("p",null,"Follow the steps to determine which root certificates have been installed ",(0,n.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/developer/java/sdk/java-sdk-add-certificate-ca-store#determining-which-root-certificates-are-installed"},"Add Root certificate")),(0,n.kt)("p",null,"Now import the documentdbemulatorcert and CosmosEmulatorSecrets certificate."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'keytool -keystore "location to download the root certificate" -cacerts -importcert -alias documentdbemulator -file "location of documentdbemulatorcert.cer"\n')),(0,n.kt)("p",null,'type the password when prompted "changeit" (This should be the same if you haven\'t changed it when listing the certificates).\nIf asked "do you trust this certificate" type in "y".'),(0,n.kt)("p",null,"follow the above steps to import cosmosemulatorsecrets certificate"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'keytool -keystore "location to download the root certificate" -cacerts -importcert -alias cosmosemulatorcert -file "location of cosmosemulatorsecrets.cer"\n')),(0,n.kt)("p",null,"Go to URL in your browser:"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Firefox"),' -- click on HTTPS certificate chain (the lock icon right next to URL address). Click "more info" > "security" > "show certificate" > "details" > "export..". Pickup the name and choose file type example.cer.'),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Chrome"),'  -- click on site icon left to address in address bar, select "Certificate" -> "Details" -> "Export" and save in format "Der-encoded binary, single certificate".'),(0,n.kt)("p",null,"Now running the below should list 4 certificates."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"keytool -list -keystore cacerts\n"))),(0,n.kt)(s.Z,{value:"unix",mdxType:"TabItem"},(0,n.kt)("h4",{id:"download-the-certificate"},"Download the certificate"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"curl -k https://localhost:8081/_explorer/emulator.pem > emulatorcert.crt\n")),(0,n.kt)("h4",{id:"import-to-java-trust-store"},"Import to Java trust store"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"keytool -importcert -cacerts -alias documentdbemulator -file <path to emulatorcert.crt>\n")),(0,n.kt)("p",null,"In order to make sure the certificate is there, you can run the following:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"keytool -list -cacerts | grep -A1 documentdbemulator\n")))))}b.isMDXComponent=!0},3453:function(e,t,a){t.Z=a.p+"assets/images/cosmosdb_emulator_1-eb5c6355a0662db45234724a920edac3.png"},778:function(e,t,a){t.Z=a.p+"assets/images/cosmosdb_emulator_2-ea8bcc2395126bc2cb4826568d1b256d.png"},1366:function(e,t,a){t.Z=a.p+"assets/images/cosmosdb_emulator_3-ddb539bc14733fdf2bc3cb8dc022cf09.png"},1028:function(e,t,a){t.Z=a.p+"assets/images/cosmosdb_emulator_certificate-3ebcfb8c1a7eface5852be7e3ba17061.png"}}]);