"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[7907,4559,3356,2893,8237,9746],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(h,l(l({ref:t},u),{},{components:n})):a.createElement(h,l({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8215:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},4426:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(7462),r=n(7294),i=n(2389),l=n(9443);var o=function(){var e=(0,r.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(78),p=n(6010),u="tabItem_vU9c";function d(e){var t,n,a,i=e.lazy,l=e.block,d=e.defaultValue,c=e.values,m=e.groupId,h=e.className,g=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=c?c:g.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),f=(0,s.lx)(k,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var x=null===d?d:null!=(t=null!=d?d:null==(n=g.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=g[0])?void 0:a.props.value;if(null!==x&&!k.some((function(e){return e.value===x})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+x+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=o(),N=v.tabGroupChoices,y=v.setTabGroupChoices,b=(0,r.useState)(x),w=b[0],A=b[1],T=[],_=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var C=N[m];null!=C&&C!==w&&k.some((function(e){return e.value===C}))&&A(C)}var j=function(e){var t=e.currentTarget,n=T.indexOf(t),a=k[n].value;a!==w&&(_(t),A(a),null!=m&&y(m,a))},E=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=T.indexOf(e.currentTarget)+1;n=T[a]||T[0];break;case"ArrowLeft":var r=T.indexOf(e.currentTarget)-1;n=T[r]||T[T.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,p.Z)("tabs",{"tabs--block":l},h)},k.map((function(e){var t=e.value,n=e.label;return r.createElement("li",{role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,className:(0,p.Z)("tabs__item",u,{"tabs__item--active":w===t}),key:t,ref:function(e){return T.push(e)},onKeyDown:E,onFocus:j,onClick:j},null!=n?n:t)}))),i?(0,r.cloneElement)(g.filter((function(e){return e.props.value===w}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==w})}))))}function c(e){var t=(0,i.Z)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}},9443:function(e,t,n){var a=(0,n(7294).createContext)(void 0);t.Z=a},4590:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,p={unversionedId:"nx/next/init-deployment",id:"nx/next/init-deployment",isDocsHomePage:!1,title:"init-deployment",description:"@ensono-stacks/next:init-deployment",source:"@site/docs/nx/next/init-deployment.md",sourceDirName:"nx/next",slug:"/nx/next/init-deployment",permalink:"/docs/nx/next/init-deployment",tags:[],version:"current",frontMatter:{}},u=[{value:"@ensono-stacks/next:init-deployment",id:"ensono-stacksnextinit-deployment",children:[],level:3},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"Command line arguments",id:"command-line-arguments",children:[],level:3},{value:"Generator Output",id:"generator-output",children:[],level:3}],level:2},{value:"Understanding the Infrastructure",id:"understanding-the-infrastructure",children:[{value:"build/azDevOps",id:"buildazdevops",children:[],level:3},{value:"taskctl",id:"taskctl",children:[],level:3},{value:"Helm",id:"helm",children:[],level:3},{value:"Versioning",id:"versioning",children:[],level:3},{value:"Package &amp; Push",id:"package--push",children:[],level:3},{value:"Terraform",id:"terraform",children:[],level:3}],level:2}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextinit-deployment"},"@ensono-stacks/next:init-deployment"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Configure Deployment & Infra for your Next project"),(0,i.kt)("p",null,"The deployment generator will provide all the necessary tools and setup ready to host your application in a Kubernetes Cluster."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application. This may already exist if you agreed to install the infra during next:init generator."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:init-deployment\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u251c\u2500\u2500 workspace root\n    \u251c\u2500\u2500 apps\n        \u251c\u2500\u2500 myapp\n            \u251c\u2500\u2500 deploy\n                \u251c\u2500\u2500 helm\n                \u251c\u2500\u2500 terraform\n            \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 libs\n        \u251c\u2500\u2500 next-helm-chart\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Creates numerous files; main helm config as a library ",(0,i.kt)("inlineCode",{parentName:"p"},"next-helm-chart")," under libs and terraform config under the ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy")," folder within the app. You can then go in and update relevant parts for your use case.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Adds following files to .gitignore"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"'**/.terraform/*',\n'*.tfstate',\n'*.tfstate.*',\n'crash.log',\n'crash.*.log',\n'override.tf',\n'override.tf.json',\n'*_override.tf',\n'*_override.tf.json',\n'.terraformrc',\n'terraform.rc',\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"installs following dev dependencies")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"@nx-tools/nx-container\n@nx-tools/container-metadata\n@jscutlery/semver\n")),(0,i.kt)("h2",{id:"understanding-the-infrastructure"},"Understanding the Infrastructure"),(0,i.kt)("p",null,"Azure devops configuration exists within the build folder for each new generated app project. This folder lives at root."),(0,i.kt)("h3",{id:"buildazdevops"},"build/azDevOps"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"azuredevops-runner.yaml")),(0,i.kt)("p",null,"Here you will find the actions for triggering the pipelines. Basically, creating a PR will build as a non prod artefact and merging into main branch will build as a prod artefact, with the relevant parameter specified."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"azuredevops-stages.yaml")),(0,i.kt)("p",null,"This is of course the actual stages of the pipeline that are configured. Most of the detail is done via taskctl, which can found as the last task in the build job."),(0,i.kt)("h3",{id:"taskctl"},"taskctl"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/taskctl/taskctl"},"taskctl")," has been used to enable across different environments and builds. Cross platform, one single syntax."),(0,i.kt)("p",null,"As a rule of thumb, each task here references a target execution via Nx defined inside project.json. The flag --target is used to pass in the appropriate value."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build/taskctl/tasks.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'helm:\n  description: Lint Helm Charts\n  command:\n    - npx nx affected --base="$BASE_SHA" --target=lint\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"apps/myapp/project.json")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'"lint":\n  {\n    "executor": "nx:run-commands",\n    "options":\n      {\n        "commands": [{ "command": "helm lint", "forwardAllArgs": false }],\n        "cwd": "libs/next-helm-chart/build/helm",\n      },\n  }\n')),(0,i.kt)("h3",{id:"helm"},"Helm"),(0,i.kt)("p",null,"The configuration files for Helm Charts live inside the libs folder under directory for your app, contained as its own library"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"myproject/apps/myapp/libs/next-helm-chart/build/helm")),(0,i.kt)("p",null,"As a rule of thumb, target execution is defined via Nx inside project.json. The flag --target is used to pass in the appropriate values for each intended target run."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"libs/next-helm-chart/project.json")),(0,i.kt)("p",null,"Hence, running the following will trigger the intended execution. The pipeline takes care of this for us."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'npx nx affected --base="$BASE_SHA" --target=lint\n')),(0,i.kt)("p",null,"In the infra pipeline, the steps for Helm will begin by linting, followed by either an upgrade or install. If the Helm chart is already installed, then an upgrade occurs based on the given command. If it isn't installed, then an installation occurs instead. The command accepts a ",(0,i.kt)("inlineCode",{parentName:"p"},"--atomic")," flag which will allow Helm to roll back to the previous release should a failure during upgrade occur. On install, this would cause the installation to fail if there were any issues."),(0,i.kt)("p",null,"The remaining tasks are then carried out post versioning, covered in the next section."),(0,i.kt)("h3",{id:"versioning"},"Versioning"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/jscutlery/semver"},"jscutlery:semver")," is an Nx plugin which has been configured to automate semantic versioning and release in these projects. It follow conventional commits and is also applied to proceeding pipeline targets such as Helm charts."),(0,i.kt)("h3",{id:"package--push"},"Package & Push"),(0,i.kt)("p",null,"After versioning, our build is containerised using Docker and pushed to the set Azure registry."),(0,i.kt)("p",null,"Likewise, the Helm Charts are also packaged and pushed to their respective place in the Azure registry."),(0,i.kt)("p",null,"Finally a Github release is tagged with relevant notes using jscutlery."),(0,i.kt)("h3",{id:"terraform"},"Terraform"),(0,i.kt)("p",null,"This is the last group of tasks to run as part of the infrastructure. See ",(0,i.kt)("inlineCode",{parentName:"p"},"myproject/apps/myapp/deploy/terraform")," for configuration files."),(0,i.kt)("p",null,"One thing to highlight is that once the Terraform apply task is completed, a Helm install will also be executed. As mentioned earlier, the default behaviour is to deploy a non-production instance when a PR is created and once the PR is merged, then the deployment is made to production.")))}c.isMDXComponent=!0},7434:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,p={unversionedId:"nx/next/init",id:"nx/next/init",isDocsHomePage:!1,title:"init",description:"@ensono-stacks/next:init",source:"@site/docs/nx/next/init.md",sourceDirName:"nx/next",slug:"/nx/next/init",permalink:"/docs/nx/next/init",tags:[],version:"current",frontMatter:{}},u=[{value:"@ensono-stacks/next:init",id:"ensono-stacksnextinit",children:[],level:3},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"Command line arguments",id:"command-line-arguments",children:[],level:3},{value:"Generator Output",id:"generator-output",children:[],level:3}],level:2}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextinit"},"@ensono-stacks/next:init"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Adds custom config and developer tools to an existing next application"),(0,i.kt)("p",null,"The next init generator will add a custom ESlint config to an existing NextJs application, install ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-testing-library")," to the project. as well as update project.json with a custom test config to allow coverage collection from ",(0,i.kt)("a",{parentName:"p",href:"https://jestjs.io/"},"jest"),"."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:init\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the existing next application"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("p",null,"The following files will be updated."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"UPDATE apps/baseline-next-app/project.json #Updated with custom test config to allow for coverage collection\nUPDATE apps/baseline-next-app/.eslintrc.json #Ehanced with additional linting rules\nUPDATE apps/baseline-next-app/tsconfig.json #Minor enhancements\nUPDATE apps/baseline-next-app/tsconfig.spec.json #Updates for monorepo structure\nUPDATE apps/baseline-next-app/specs/index.spec.tsx #Formatting changes\n")),(0,i.kt)("p",null,"A final message is provided if the developer would like to run the relevant deployment generator that supports this FE.\n",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next:init-deployment"),".")))}c.isMDXComponent=!0},383:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,p={unversionedId:"nx/next/next-auth-redis-deployment",id:"nx/next/next-auth-redis-deployment",isDocsHomePage:!1,title:"next-auth-redis-deployment",description:"@ensono-stacks/next:next-auth-redis-deployment",source:"@site/docs/nx/next/next-auth-redis-deployment.md",sourceDirName:"nx/next",slug:"/nx/next/next-auth-redis-deployment",permalink:"/docs/nx/next/next-auth-redis-deployment",tags:[],version:"current",frontMatter:{}},u=[{value:"@ensono-stacks/next:next-auth-redis-deployment",id:"ensono-stacksnextnext-auth-redis-deployment",children:[],level:3},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"Command line arguments",id:"command-line-arguments",children:[],level:3},{value:"Generator Output",id:"generator-output",children:[],level:3}],level:2}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextnext-auth-redis-deployment"},"@ensono-stacks/next:next-auth-redis-deployment"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Configure Deployment & Infra to support Redis in your Next application"),(0,i.kt)("p",null,"The next-auth-redis-deployment generator will add required Redis config into your existing Next app with Next-auth."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application with Next-auth. Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next:next-auth")," generator to add this into your application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:next-auth-redis-deployment\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("p",null,"When infrastructure is detected for the application, these files will be enhanced to cater for Redis:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/build/values',"[-prod]",".yaml files will have 3 new entries added for redis")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'redisURL: ""\nnextAuthSecret: ""\nnextAuthURL: <app-name>.<internal/external domain>\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/terraform/main.tf will have a new azurerm_redis_cache resource added. The variables.tf file will have these corresponding variables defined')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'resource "azurerm_redis_cache" "default_primary" {\n  name                = var.redis_name\n  location            = var.redis_resource_group_location\n  resource_group_name = var.redis_resource_group_name\n  capacity            = var.redis_capacity\n  family              = var.redis_family\n  sku_name            = var.redis_sku_name\n  minimum_tls_version = var.minimum_tls_version\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/terraform/',"[prod/nonprod]",".tfvars will have additional variables added.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'redis_name =\n  "<company>-<domain>-<prod/nonprod>-<cloud region>-<business component>";\nredis_resource_group_location = "%REPLACE%";\nredis_resource_group_name =\n  "<company>-<domain>-<prod/nonprod>-<cloud region>-<business component>";\n')),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Be sure to update the redis_resource_group_location value"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/terraform/outputs.tf will have the redis_connection_string added')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'output "redis_connection_string" {\n  sensitive = true\n  value     = "rediss://:${azurerm_redis_cache.default_primary.primary_access_key}@${azurerm_redis_cache.default_primary.hostname}:${azurerm_redis_cache.default_primary.ssl_port}"\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/.env.local will have the REDIS_URL env variable added and set')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"REDIS_URL=localhost:6379\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'"app-name"/project.json will have the helm-upgrade commands updated to use the NEXTAUTH_SECRET')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'"helm-upgrade": {\n      "executor": "nx:run-commands",\n      "options": {\n        "commands": [\n          {\n            "command": "helm upgrade [... unchanged ...] --set nextAuthSecret=\\\\\\"$NEXTAUTH_SECRET\\\\\\"",\n            "forwardAllArgs": false\n          }\n        ],\n        "cwd": "apps/baseline-next-app/build/terraform"\n      },\n      "configurations": {\n        "prod": {\n          "commands": [\n            {\n              "command": "helm upgrade [... unchanged ...] --set nextAuthSecret=\\\\\\"$NEXTAUTH_SECRET\\\\\\"",\n              "forwardAllArgs": false\n            }\n          ]\n        }\n      }\n')),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For Azure DevOps, the ",(0,i.kt)("strong",{parentName:"p"},"NEXTAUTH_SECRET")," needs to be added to the <company",">","-<component",">","-<domain",">","-nonprod and <company",">","-<component",">","-<domain",">","-prod' variable groups")))))}c.isMDXComponent=!0},7807:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,p={unversionedId:"nx/next/next-auth-redis",id:"nx/next/next-auth-redis",isDocsHomePage:!1,title:"next-auth-redis",description:"@ensono-stacks/next:next-auth-redis",source:"@site/docs/nx/next/next-auth-redis.md",sourceDirName:"nx/next",slug:"/nx/next/next-auth-redis",permalink:"/docs/nx/next/next-auth-redis",tags:[],version:"current",frontMatter:{}},u=[{value:"@ensono-stacks/next:next-auth-redis",id:"ensono-stacksnextnext-auth-redis",children:[],level:3},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"Command line arguments",id:"command-line-arguments",children:[],level:3},{value:"Generator Output",id:"generator-output",children:[],level:3}],level:2}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextnext-auth-redis"},"@ensono-stacks/next:next-auth-redis"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Add Redis for session management to your Next application"),(0,i.kt)("p",null,"The next-auth-redis generator will add Redis for session management into your existing Next app with Next-auth."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application with Next-auth. Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next:next-auth")," generator to add this into your application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:next-auth-redis\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--adapterName"),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the generated Redis adapter library"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"next-auth-redis")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--envVar"),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the env var that stores connection string for Redis"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"REDIS_URL")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("p",null,"A new redis library will be added to your ",(0,i.kt)("inlineCode",{parentName:"p"},"libs")," folder with the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"libs\n\u2502   next-auth-redis\n\u2502   \u251c\u2500\u2500  src\n\u2502   \u2502   \u251c\u2500\u2500 index.ts       #All code required for session management with Redis\n\u2502   \u2502   \u251c\u2500\u2500 index.test.ts  #Unit tests using 'ioredis-mock' to mock Redis functions.\n\u2502   \u251c\u2500\u2500  README.md\n\u2502   \u251c\u2500\u2500 tsconfig.json\n\u2502   \u251c\u2500\u2500 tsconfig.lib.json\n\u2502   \u251c\u2500\u2500 project.json\n\u2502   \u251c\u2500\u2500 .eslintrc.json\n\u2502   \u251c\u2500\u2500 jest.config.ts\n\u2514\u2500\u2500 \u2514\u2500\u2500 tsconfig.spec.json\n")),(0,i.kt)("p",null,'In order for Redis to be used within next-auth a new entry for the redis library is added to the tsconfig.base.json "paths"'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"paths": {\n      "@<workspace-name>/next-auth-redis": [\n        "libs/next-auth-redis/src/index.ts"\n      ]\n    }\n')),(0,i.kt)("p",null,"Your ",(0,i.kt)("inlineCode",{parentName:"p"},"[...nextauth].ts")," file within the Next application will be updated to use the new Redis adapter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Redis } from 'ioredis';\nimport NextAuth from 'next-auth';\nimport AzureADProvider from 'next-auth/providers/azure-ad';\n\nimport { IORedisAdapter } from '@0-5-23-next-with-test-app/next-auth-redis';\n\nconst nextAuth = NextAuth({\n  providers: [\n    AzureADProvider({\n      clientId: process.env.AZURE_AD_CLIENT_ID,\n      clientSecret: process.env.AZURE_AD_CLIENT_SECRET,\n      tenantId: process.env.AZURE_AD_TENANT_ID,\n    }),\n  ],\n  adapter: IORedisAdapter(new Redis(process.env.REDIS_URL)),\n});\n\nexport default nextAuth;\n")),(0,i.kt)("p",null,"A final message is provided if the developer would like to run the relevant deployment generator that supports this FE.\n",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next:next-auth-redis-deployment"),".")))}c.isMDXComponent=!0},5155:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,p={unversionedId:"nx/next/next-auth",id:"nx/next/next-auth",isDocsHomePage:!1,title:"next-auth",description:"@ensono-stacks/next:next-auth",source:"@site/docs/nx/next/next-auth.md",sourceDirName:"nx/next",slug:"/nx/next/next-auth",permalink:"/docs/nx/next/next-auth",tags:[],version:"current",frontMatter:{}},u=[{value:"@ensono-stacks/next:next-auth",id:"ensono-stacksnextnext-auth",children:[],level:3},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Usage",id:"usage",children:[{value:"Command line arguments",id:"command-line-arguments",children:[],level:3},{value:"Generator Output",id:"generator-output",children:[],level:3}],level:2}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextnext-auth"},"@ensono-stacks/next:next-auth"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Add Next Authentication to your next application"),(0,i.kt)("p",null,"The next-auth generator will install and configure ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/"},"NextAuth.js")," into an existing Next application. It will add the initial configuration, add the session provider, setup an API endpoint and add local environmental variables. It will also configure provider specific setup."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:next-auth\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--provider"),(0,i.kt)("td",{parentName:"tr",align:null},"The provider to be installed"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"none/azureAd"),(0,i.kt)("td",{parentName:"tr",align:null},"none")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--skipPackageJson"),(0,i.kt)("td",{parentName:"tr",align:null},"Do not add dependencies to ",(0,i.kt)("inlineCode",{parentName:"td"},"package.json")),(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},"true/false"),(0,i.kt)("td",{parentName:"tr",align:null},"false")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Creates a new Next API endpoint with the file name ",(0,i.kt)("inlineCode",{parentName:"li"},"[...nextauth].ts"),". This contains the dynamic route handler for NextAuth.js which will also contain all of your global NextAuth.js configurations. If you have specified a provider when running the generator this will be added to the providers array")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/apps/appName/pages/api/[...nextauth].ts"',title:'"/apps/appName/pages/api/[...nextauth].ts"'},"import NextAuth from 'next-auth';\nimport AzureADProvider from 'next-auth/providers/azure-ad';\nconst nextAuth = NextAuth({\n  providers: [\n    AzureADProvider({\n      clientId: process.env.AZURE_AD_CLIENT_ID,\n      clientSecret: process.env.AZURE_AD_CLIENT_SECRET,\n      tenantId: process.env.AZURE_AD_TENANT_ID,\n    }),\n  ],\n});\nexport default nextAuth;\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install the next-auth package and add to package.json, unless the ",(0,i.kt)("inlineCode",{parentName:"li"},"--skipPackageJson")," option was used")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="/package.json"',title:'"/package.json"'},'"dependencies": {\n    ...otherDependencies\n    "next-auth": "4.18.8",\n},\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create or append an ",(0,i.kt)("inlineCode",{parentName:"li"},".env.local")," file. Adding required next auth environmental variables. These will vary depending on the provider chosen. ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/.env.local"',title:'"/.env.local"'},"NEXTAUTH_URL=http://localhost:4200\nNEXTAUTH_SECRET=secretValue\nAZURE_AD_CLIENT_ID=\nAZURE_AD_CLIENT_SECRET=\nAZURE_AD_TENANT_ID=\n")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Be sure to update the environmental variables with the values provided by your provider"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Append the ",(0,i.kt)("inlineCode",{parentName:"li"},"_app.tsx")," file with a ",(0,i.kt)("a",{parentName:"li",href:"https://next-auth.js.org/getting-started/client#sessionprovider"},"session provider")," ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/apps/appName/_app.tsx"',title:'"/apps/appName/_app.tsx"'},"import { AppProps } from 'next/app';\nimport Head from 'next/head';\nimport './styles.css';\nimport { SessionProvider } from 'next-auth/react';\nfunction CustomApp({\n  Component,\n  pageProps: { session, ...pageProps },\n}: AppProps) {\n  return (\n    <SessionProvider session={session}>\n      <Head>\n        <title>Welcome to testing!</title>\n      </Head>\n      <main className=\"app\">\n        <Component {...pageProps} />\n      </main>\n    </SessionProvider>\n  );\n}\nexport default CustomApp;\n")),(0,i.kt)("p",null,"From here with the configuration complete it is now possible to access the ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/getting-started/client#usesession"},"useSession")," hook from next auth. For further information please see the ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/getting-started/example#frontend---add-react-hook"},"Getting Started Guide to Next Auth"))))}c.isMDXComponent=!0},8699:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return h},contentTitle:function(){return g},metadata:function(){return k},toc:function(){return f},default:function(){return v}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=n(7434),o=n(4590),s=n(5155),p=n(7807),u=n(383),d=n(4426),c=n(8215),m=["components"],h={id:"ensono-stacks-next",title:"@ensono-stacks/next",sidebar_label:"@ensono-stacks/next",description:"Using next with stacks!",keywords:["NX","monorepo","stacks","ensono","next","generator","executor","redis"]},g=void 0,k={unversionedId:"nx/next/ensono-stacks-next",id:"nx/next/ensono-stacks-next",isDocsHomePage:!1,title:"@ensono-stacks/next",description:"Using next with stacks!",source:"@site/docs/nx/next/plugin-information.md",sourceDirName:"nx/next",slug:"/nx/next/ensono-stacks-next",permalink:"/docs/nx/next/ensono-stacks-next",tags:[],version:"current",frontMatter:{id:"ensono-stacks-next",title:"@ensono-stacks/next",sidebar_label:"@ensono-stacks/next",description:"Using next with stacks!",keywords:["NX","monorepo","stacks","ensono","next","generator","executor","redis"]},sidebar:"docs",previous:{title:"@ensono-stacks/workspace",permalink:"/docs/nx/workspace/ensono-stacks-workspace"},next:{title:"@ensono-stacks/azure-node",permalink:"/docs/nx/azure-node/ensono-stacks-azure-node"}},f=[{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Setting up @ensono-stacks/next",id:"setting-up-ensono-stacksnext",children:[],level:2},{value:"Executors and Generators",id:"executors-and-generators",children:[{value:"Generators",id:"generators",children:[],level:3}],level:2}],x={toc:f};function v(e){var t=e.components,n=(0,r.Z)(e,m);return(0,i.kt)("wrapper",(0,a.Z)({},x,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"next")," plugin contains generators to augment existing NextJs projects. Adding eslint rules, testing config as well as installing and configuring NextAuth.js in your NextJs app."),(0,i.kt)("p",null,"Using a standard setup for your Next app ensures consistency and code quality across multiple applications quickly. NextAuth (alongside Redis) can also be quickly added to a project without costly configuration and setup."),(0,i.kt)("p",null,"Using the deployment generator you can setup your application with the necessary infrastructure config to host it in k8s."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application. Note the generator will fail if run in an empty workspace with no applications. To create a new Next application please run the NX Next generator with the following command including any relevant options. See ",(0,i.kt)("a",{parentName:"p",href:"https://nx.dev/packages/next"},"@nrwl/next plugin docs")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @nrwl/next:app my-new-app\n")),(0,i.kt)("p",null,"Ensure the ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"executedGenerators")," fields are present within ",(0,i.kt)("inlineCode",{parentName:"p"},"nx.json")," for FE code generation."),(0,i.kt)("p",null,"Ensure the ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," fields are present and populated within ",(0,i.kt)("inlineCode",{parentName:"p"},"nx.json")," for deployment/infra generation."),(0,i.kt)("p",null,"An example of the expected structure can be ",(0,i.kt)("a",{parentName:"p",href:"/docs/nx/workspace/ensono-stacks-workspace#prerequisites"},"seen here")," under ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/workspace:init"),"\u200b prerequisites."),(0,i.kt)("h2",{id:"setting-up-ensono-stacksnext"},"Setting up @ensono-stacks/next"),(0,i.kt)("p",null,"Install the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next")," with the following command:"),(0,i.kt)(d.Z,{mdxType:"Tabs"},(0,i.kt)(c.Z,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save-dev @ensono-stacks/next@latest\n"))),(0,i.kt)(c.Z,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add --dev @ensono-stacks/next@latest\n")))),(0,i.kt)("h2",{id:"executors-and-generators"},"Executors and Generators"),(0,i.kt)("p",null,"To see a list of the plugin capabilities run the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx list @ensono-stacks/next\n")),(0,i.kt)("p",null,"View additional information about a plugin capability through the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:[generator-executor-name] --help\n")),(0,i.kt)("h3",{id:"generators"},"Generators"),(0,i.kt)(l.default,{mdxType:"Init"}),(0,i.kt)(o.default,{mdxType:"NextInitDeployment"}),(0,i.kt)(s.default,{mdxType:"NextAuth"}),(0,i.kt)(p.default,{mdxType:"NextAuthRedis"}),(0,i.kt)(u.default,{mdxType:"NextAuthRedisDeployment"}))}v.isMDXComponent=!0}}]);