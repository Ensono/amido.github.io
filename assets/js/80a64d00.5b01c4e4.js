"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[5936],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return f}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),s=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=s(r),m=a,f=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return r?n.createElement(f,i(i({ref:t},u),{},{components:r})):n.createElement(f,i({ref:t},u))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[d]="string"==typeof e?e:a,i[1]=p;for(var s=2;s<o;s++)i[s]=r[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},370:function(e,t,r){r.r(t),r.d(t,{contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return u}});var n=r(7462),a=r(3366),o=(r(7294),r(3905)),i=["components"],p={id:"core_data_platform_deployment_azure",title:"Infrastructure Deployment",sidebar_label:"2. Infrastructure Deployment",hide_title:!1,hide_table_of_contents:!1,description:"Infrastructure deployment",keywords:["stacks cli","data","infrastructure","azure","template"]},l=void 0,s={unversionedId:"workloads/azure/data/getting_started/core_data_platform_deployment_azure",id:"workloads/azure/data/getting_started/core_data_platform_deployment_azure",isDocsHomePage:!1,title:"Infrastructure Deployment",description:"Infrastructure deployment",source:"@site/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure.md",sourceDirName:"workloads/azure/data/getting_started",slug:"/workloads/azure/data/getting_started/core_data_platform_deployment_azure",permalink:"/docs/workloads/azure/data/getting_started/core_data_platform_deployment_azure",tags:[],version:"current",frontMatter:{id:"core_data_platform_deployment_azure",title:"Infrastructure Deployment",sidebar_label:"2. Infrastructure Deployment",hide_title:!1,hide_table_of_contents:!1,description:"Infrastructure deployment",keywords:["stacks cli","data","infrastructure","azure","template"]},sidebar:"docs",previous:{title:"1. Generate a data project",permalink:"/docs/workloads/azure/data/getting_started/generate_project"},next:{title:"3. Local Development Quickstart",permalink:"/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure"}},u=[{value:"Step 1: Create branch and set networking option",id:"step-1-create-branch-and-set-networking-option",children:[],level:2},{value:"Step 2: Add Infrastructure pipeline in Azure DevOps",id:"step-2-add-infrastructure-pipeline-in-azure-devops",children:[],level:2},{value:"Step 3: Deploy Infrastructure in non-production environment",id:"step-3-deploy-infrastructure-in-non-production-environment",children:[],level:2},{value:"Step 4: Deploy Infrastructure in further environments",id:"step-4-deploy-infrastructure-in-further-environments",children:[],level:2},{value:"Next steps",id:"next-steps",children:[],level:2}],d={toc:u},c="wrapper";function m(e){var t=e.components,r=(0,a.Z)(e,i);return(0,o.kt)(c,(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This section provides an overview of generating a new Data Platform project and deploying core infrastructure for Stacks Data Platform."),(0,o.kt)("p",null,"It assumes you have ",(0,o.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/getting_started/generate_project"},"generated a new data project using Stacks"),", and that the following ",(0,o.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/requirements_data_azure"},"requirements")," are in place:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/workloads/azure/data/requirements_data_azure#azure-subscription"},"Azure subscription and service principal"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If you want to provision the infrastructure within a private network, this can be done as part of a ",(0,o.kt)("a",{parentName:"li",href:"../infrastructure_data_azure#networking"},"Hub-Spoke network topology"),". Spoke virtual network and subnet for private endpoints must be provisioned for each environment. The hub network must contain a self-hosted agent. See ",(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli"},"Microsoft documentation")," for more details on implementing Hub-spoke network topology in Azure."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/workloads/azure/data/requirements_data_azure#azure-devops"},"Azure DevOps project with Pipelines variable groups"),".")),(0,o.kt)("h2",{id:"step-1-create-branch-and-set-networking-option"},"Step 1: Create branch and set networking option"),(0,o.kt)("p",null,"Open the project locally and create a new feature branch e.g.:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git checkout -b feat/infra-pipeline\n")),(0,o.kt)("p",null,"The file ",(0,o.kt)("inlineCode",{parentName:"p"},"deploy/azure/infra/vars.tf")," contains a variable ",(0,o.kt)("inlineCode",{parentName:"p"},"enable_private_networks"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you want to provision infrastructure within a ",(0,o.kt)("a",{parentName:"li",href:"../infrastructure_data_azure#networking"},"private network"),", ensure this variable is set to ",(0,o.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,o.kt)("li",{parentName:"ul"},"If you want to provision infrastructure with a default deployment model, ensure this variable is set to ",(0,o.kt)("inlineCode",{parentName:"li"},"false"),".")),(0,o.kt)("h2",{id:"step-2-add-infrastructure-pipeline-in-azure-devops"},"Step 2: Add Infrastructure pipeline in Azure DevOps"),(0,o.kt)("p",null,"A YAML file containing a template Azure DevOps CI/CD pipeline for building and deploying the core infrastructure is provided in ",(0,o.kt)("inlineCode",{parentName:"p"},"build/azDevOps/azure/air-infrastructure-data.yml")," - this should be added as the definition for a new pipeline in Azure DevOps."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Sign-in to your Azure DevOps organization and go to your project"),(0,o.kt)("li",{parentName:"ol"},"Go to Pipelines, and then select ",(0,o.kt)("strong",{parentName:"li"},"New pipeline")),(0,o.kt)("li",{parentName:"ol"},"Name the new pipeline, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"amido.stacks-data-infrastructure")),(0,o.kt)("li",{parentName:"ol"},"For the pipeline definition, specify the YAML file in the project repository feature branch (",(0,o.kt)("inlineCode",{parentName:"li"},"air-infrastructure-data.yml"),") and save"),(0,o.kt)("li",{parentName:"ol"},"The new pipeline will require access to any Azure DevOps pipeline variable groups specified in the pipeline YAML. Under each variable group, go to 'Pipeline permissions' and add the pipeline.")),(0,o.kt)("h2",{id:"step-3-deploy-infrastructure-in-non-production-environment"},"Step 3: Deploy Infrastructure in non-production environment"),(0,o.kt)("p",null,"Run the pipeline configured in Step 2 to commence the build and deployment process."),(0,o.kt)("p",null,"Running this pipeline in Azure DevOps will initiate the deployment of artifacts into the non-production (nonprod) environment. It's important to monitor the progress of this deployment to ensure its success. You can track the progress and status of the deployment within the Pipelines section of Azure DevOps."),(0,o.kt)("p",null,"If successful, the core infrastructure resources will now be available in the nonprod Stacks environment. To view these deployed resources, navigate to the ",(0,o.kt)("a",{parentName:"p",href:"https://portal.azure.com/"},"Azure portal")," and search for the resource group associated with the deployment. This resource group is named based upon values provided during step 1 in the pattern\n",(0,o.kt)("inlineCode",{parentName:"p"},"companyname-projectname-stage-region-component")," (for example: ",(0,o.kt)("inlineCode",{parentName:"p"},"amido-stacks-dev-euw-de"),"). Within the resource group, you'll find a list of the resources that were deployed."),(0,o.kt)("p",null,"Once core infrasturcture resources are deployed in nonprod environment, values will need adding into the nonprod variable group to reflect the deployed resources (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"amido-stacks-de-pipeline-nonprod"),"). For additional information, see ",(0,o.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/requirements_data_azure#azure-pipelines-variable-groups"},"Pipelines variable groups"),"."),(0,o.kt)("h2",{id:"step-4-deploy-infrastructure-in-further-environments"},"Step 4: Deploy Infrastructure in further environments"),(0,o.kt)("p",null,"By default Stacks provides a framework for managing the platform across two environments - nonprod and prod.\nThe template CI/CD pipelines provided are based upon these two platform environments (nonprod and prod) - but these may be amended depending upon the specific requirements of your project and organisation."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Deployment to the non-production (nonprod) environment is triggered on a feature branch when a pull request is open"),(0,o.kt)("li",{parentName:"ul"},"Deployment to the production (prod) environment is triggered on merging to the ",(0,o.kt)("inlineCode",{parentName:"li"},"main")," branch, followed by manual approval of the release step.")),(0,o.kt)("p",null,"Once core infrastructure resources are deployed in prod environment, values will need adding into the prod variable group to reflect the deployed resources (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"amido-stacks-de-pipeline-prod"),"). For additional information, see ",(0,o.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/requirements_data_azure#azure-pipelines-variable-groups"},"Pipelines variable groups"),"."),(0,o.kt)("h2",{id:"next-steps"},"Next steps"),(0,o.kt)("p",null,"Now you have generated and deployed a new Stacks data platform, ",(0,o.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/getting_started/dev_quickstart_data_azure"},"setup your local development environment"),"."))}m.isMDXComponent=!0}}]);