"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[8175,6422,6915,7282],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,g=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(g,l(l({ref:t},p),{},{components:n})):a.createElement(g,l({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(7294),r=n(6010),i={tabItem:"tabItem_Ymn6"};function l(e){var t=e.children,n=e.hidden,l=e.className;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,l),hidden:n},t)}},4866:function(e,t,n){n.d(t,{Z:function(){return b}});var a=n(7462),r=n(7294),i=n(6010),l=n(2466),o=n(6550),s=n(1980),u=n(7392),p=n(12);function c(e){return function(e){var t,n;return null!=(t=null==(n=r.Children.map(e,(function(e){if(!e||(0,r.isValidElement)(e)&&(t=e.props)&&"object"==typeof t&&"value"in t)return e;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function d(e){var t=e.values,n=e.children;return(0,r.useMemo)((function(){var e=null!=t?t:c(n);return function(e){var t=(0,u.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function m(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function g(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId,i=(0,o.k6)(),l=function(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:n,groupId:a});return[(0,s._X)(l),(0,r.useCallback)((function(e){if(l){var t=new URLSearchParams(i.location.search);t.set(l,e),i.replace(Object.assign({},i.location,{search:t.toString()}))}}),[l,i])]}function h(e){var t,n,a,i,l=e.defaultValue,o=e.queryString,s=void 0!==o&&o,u=e.groupId,c=d(e),h=(0,r.useState)((function(){return function(e){var t,n=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(t=a.find((function(e){return e.default})))?t:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:l,tabValues:c})})),k=h[0],f=h[1],v=g({queryString:s,groupId:u}),x=v[0],N=v[1],b=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:u}.groupId),n=(0,p.Nk)(t),a=n[0],i=n[1],[a,(0,r.useCallback)((function(e){t&&i.set(e)}),[t,i])]),y=b[0],w=b[1],T=function(){var e=null!=x?x:y;return m({value:e,tabValues:c})?e:null}();return(0,r.useLayoutEffect)((function(){T&&f(T)}),[T]),{selectedValue:k,selectValue:(0,r.useCallback)((function(e){if(!m({value:e,tabValues:c}))throw new Error("Can't select invalid tab value="+e);f(e),N(e),w(e)}),[N,w,c]),tabValues:c}}var k=n(2389),f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){var t=e.className,n=e.block,o=e.selectedValue,s=e.selectValue,u=e.tabValues,p=[],c=(0,l.o5)().blockElementScrollPositionUntilNextRender,d=function(e){var t=e.currentTarget,n=p.indexOf(t),a=u[n].value;a!==o&&(c(t),s(a))},m=function(e){var t,n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":var a,r=p.indexOf(e.currentTarget)+1;n=null!=(a=p[r])?a:p[0];break;case"ArrowLeft":var i,l=p.indexOf(e.currentTarget)-1;n=null!=(i=p[l])?i:p[p.length-1]}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((function(e){var t=e.value,n=e.label,l=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:function(e){return p.push(e)},onKeyDown:m,onClick:d},l,{className:(0,i.Z)("tabs__item",f.tabItem,null==l?void 0:l.className,{"tabs__item--active":o===t})}),null!=n?n:t)})))}function x(e){var t=e.lazy,n=e.children,a=e.selectedValue,i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){var l=i.find((function(e){return e.props.value===a}));return l?(0,r.cloneElement)(l,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a})})))}function N(e){var t=h(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",f.tabList)},r.createElement(v,(0,a.Z)({},e,t)),r.createElement(x,(0,a.Z)({},e,t)))}function b(e){var t=(0,k.Z)();return r.createElement(N,(0,a.Z)({key:String(t)},e))}},9018:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,u={unversionedId:"getting_started/next/init-deployment",id:"getting_started/next/init-deployment",title:"init-deployment",description:"@ensono-stacks/next:init-deployment",source:"@site/docs/getting_started/next/init-deployment.md",sourceDirName:"getting_started/next",slug:"/getting_started/next/init-deployment",permalink:"/docs/getting_started/next/init-deployment",draft:!1,tags:[],version:"current",frontMatter:{}},p={},c=[{value:"@ensono-stacks/next:init-deployment",id:"ensono-stacksnextinit-deployment",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Usage",id:"usage",level:2},{value:"Command line arguments",id:"command-line-arguments",level:3},{value:"Generator Output",id:"generator-output",level:3},{value:"Understanding the Infrastructure",id:"understanding-the-infrastructure",level:2},{value:"build/azDevOps",id:"buildazdevops",level:3},{value:"taskctl",id:"taskctl",level:3},{value:"Helm",id:"helm",level:3},{value:"Versioning",id:"versioning",level:3},{value:"Package &amp; Push",id:"package--push",level:3},{value:"Terraform",id:"terraform",level:3}],d={toc:c},m="wrapper";function g(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextinit-deployment"},"@ensono-stacks/next:init-deployment"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Configure Deployment & Infra for your Next project"),(0,i.kt)("p",null,"The deployment generator will provide all the necessary tools and setup ready to host your application in a Kubernetes Cluster."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application. This may already exist if you agreed to install the infra during next:init generator."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:init-deployment\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u251c\u2500\u2500 workspace root\n    \u251c\u2500\u2500 apps\n        \u251c\u2500\u2500 myapp\n            \u251c\u2500\u2500 deploy\n                \u251c\u2500\u2500 helm\n                \u251c\u2500\u2500 terraform\n            \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 libs\n        \u251c\u2500\u2500 next-helm-chart\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Creates numerous files; main helm config as a library ",(0,i.kt)("inlineCode",{parentName:"p"},"next-helm-chart")," under libs and terraform config under the ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy")," folder within the app. You can then go in and update relevant parts for your use case.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Adds following files to .gitignore"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"'**/.terraform/*',\n'*.tfstate',\n'*.tfstate.*',\n'crash.log',\n'crash.*.log',\n'override.tf',\n'override.tf.json',\n'*_override.tf',\n'*_override.tf.json',\n'.terraformrc',\n'terraform.rc',\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"installs following dev dependencies")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"@nx-tools/nx-container\n@nx-tools/container-metadata\n@jscutlery/semver\n")),(0,i.kt)("h2",{id:"understanding-the-infrastructure"},"Understanding the Infrastructure"),(0,i.kt)("p",null,"Azure devops configuration exists within the build folder for each new generated app project. This folder lives at root."),(0,i.kt)("h3",{id:"buildazdevops"},"build/azDevOps"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"azuredevops-runner.yaml")),(0,i.kt)("p",null,"Here you will find the actions for triggering the pipelines. Basically, creating a PR will build as a non prod artefact and merging into main branch will build as a prod artefact, with the relevant parameter specified."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"azuredevops-stages.yaml")),(0,i.kt)("p",null,"This is of course the actual stages of the pipeline that are configured. Most of the detail is done via taskctl, which can found as the last task in the build job."),(0,i.kt)("h3",{id:"taskctl"},"taskctl"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/taskctl/taskctl"},"taskctl")," has been used to enable across different environments and builds. Cross platform, one single syntax."),(0,i.kt)("p",null,"As a rule of thumb, each task here references a target execution via Nx defined inside project.json. The flag --target is used to pass in the appropriate value."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build/taskctl/tasks.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'helm:\n  description: Lint Helm Charts\n  command:\n    - npx nx affected --base="$BASE_SHA" --target=lint\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"apps/myapp/project.json")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'"lint":\n  {\n    "executor": "nx:run-commands",\n    "options":\n      {\n        "commands": [{ "command": "helm lint", "forwardAllArgs": false }],\n        "cwd": "libs/next-helm-chart/build/helm",\n      },\n  }\n')),(0,i.kt)("h3",{id:"helm"},"Helm"),(0,i.kt)("p",null,"The configuration files for Helm Charts live inside the libs folder under directory for your app, contained as its own library"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"myproject/apps/myapp/libs/next-helm-chart/build/helm")),(0,i.kt)("p",null,"As a rule of thumb, target execution is defined via Nx inside project.json. The flag --target is used to pass in the appropriate values for each intended target run."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"libs/next-helm-chart/project.json")),(0,i.kt)("p",null,"Hence, running the following will trigger the intended execution. The pipeline takes care of this for us."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'npx nx affected --base="$BASE_SHA" --target=lint\n')),(0,i.kt)("p",null,"In the infra pipeline, the steps for Helm will begin by linting, followed by either an upgrade or install. If the Helm chart is already installed, then an upgrade occurs based on the given command. If it isn't installed, then an installation occurs instead. The command accepts a ",(0,i.kt)("inlineCode",{parentName:"p"},"--atomic")," flag which will allow Helm to roll back to the previous release should a failure during upgrade occur. On install, this would cause the installation to fail if there were any issues."),(0,i.kt)("p",null,"The remaining tasks are then carried out post versioning, covered in the next section."),(0,i.kt)("h3",{id:"versioning"},"Versioning"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/jscutlery/semver"},"jscutlery:semver")," is an Nx plugin which has been configured to automate semantic versioning and release in these projects. It follow conventional commits and is also applied to proceeding pipeline targets such as Helm charts."),(0,i.kt)("h3",{id:"package--push"},"Package & Push"),(0,i.kt)("p",null,"After versioning, our build is containerised using Docker and pushed to the set Azure registry."),(0,i.kt)("p",null,"Likewise, the Helm Charts are also packaged and pushed to their respective place in the Azure registry."),(0,i.kt)("p",null,"Finally a Github release is tagged with relevant notes using jscutlery."),(0,i.kt)("h3",{id:"terraform"},"Terraform"),(0,i.kt)("p",null,"This is the last group of tasks to run as part of the infrastructure. See ",(0,i.kt)("inlineCode",{parentName:"p"},"myproject/apps/myapp/deploy/terraform")," for configuration files."),(0,i.kt)("p",null,"One thing to highlight is that once the Terraform apply task is completed, a Helm install will also be executed. As mentioned earlier, the default behaviour is to deploy a non-production instance when a PR is created and once the PR is merged, then the deployment is made to production.")))}g.isMDXComponent=!0},7488:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,u={unversionedId:"getting_started/next/init",id:"getting_started/next/init",title:"init",description:"@ensono-stacks/next:init",source:"@site/docs/getting_started/next/init.md",sourceDirName:"getting_started/next",slug:"/getting_started/next/init",permalink:"/docs/getting_started/next/init",draft:!1,tags:[],version:"current",frontMatter:{}},p={},c=[{value:"@ensono-stacks/next:init",id:"ensono-stacksnextinit",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Usage",id:"usage",level:2},{value:"Command line arguments",id:"command-line-arguments",level:3},{value:"Generator Output",id:"generator-output",level:3}],d={toc:c},m="wrapper";function g(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextinit"},"@ensono-stacks/next:init"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Adds custom config and developer tools to an existing next application"),(0,i.kt)("p",null,"The next init generator will add a custom ESlint config to an existing NextJs application, install ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-testing-library")," to the project. as well as update project.json with a custom test config to allow coverage collection from ",(0,i.kt)("a",{parentName:"p",href:"https://jestjs.io/"},"jest"),"."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:init\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the existing next application"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("p",null,"The following files will be updated."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"UPDATE apps/baseline-next-app/project.json #Updated with custom test config to allow for coverage collection\nUPDATE apps/baseline-next-app/.eslintrc.json #Ehanced with additional linting rules\nUPDATE apps/baseline-next-app/tsconfig.json #Minor enhancements\nUPDATE apps/baseline-next-app/tsconfig.spec.json #Updates for monorepo structure\nUPDATE apps/baseline-next-app/specs/index.spec.tsx #Formatting changes\n")),(0,i.kt)("p",null,"The generator will also add ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/dequelabs/axe-core-npm/blob/develop/packages/react/README.md"},"react-axe")," (version 4.7.3) into the app via the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="...app.tsx"',title:'"...app.tsx"'},"// @ts-ignore\nif (typeof window !== 'undefined' && process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line global-require\n    const axe = require('@axe-core/react'); // eslint-disable-line @typescript-eslint/no-var-requires\n    // eslint-disable-next-line global-require\n    const React = require('react'); // eslint-disable-line @typescript-eslint/no-var-requires\n    // eslint-disable-next-line global-require\n    const ReactDOM = require('react-dom'); // eslint-disable-line @typescript-eslint/no-var-requires\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    axe(React, ReactDOM, 1000);\n}\n\n...\n")),(0,i.kt)("p",null,"react-axe has been added so your app can be tested for accessibility and results will show in the Chrome DevTools console."),(0,i.kt)("p",null,"A final message is provided if the developer would like to run the relevant deployment generator that supports this FE.\n",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next:init-deployment"),".")))}g.isMDXComponent=!0},8597:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={},s=void 0,u={unversionedId:"getting_started/next/next-auth",id:"getting_started/next/next-auth",title:"next-auth",description:"@ensono-stacks/next:next-auth",source:"@site/docs/getting_started/next/next-auth.md",sourceDirName:"getting_started/next",slug:"/getting_started/next/next-auth",permalink:"/docs/getting_started/next/next-auth",draft:!1,tags:[],version:"current",frontMatter:{}},p={},c=[{value:"@ensono-stacks/next:next-auth",id:"ensono-stacksnextnext-auth",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Usage",id:"usage",level:2},{value:"Command line arguments",id:"command-line-arguments",level:3},{value:"Generator Output",id:"generator-output",level:3}],d={toc:c},m="wrapper";function g(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"ensono-stacksnextnext-auth"},"@ensono-stacks/next:next-auth"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Add Next Authentication to your next application"),(0,i.kt)("p",null,"The next-auth generator will install and configure ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/"},"NextAuth.js")," into an existing Next application. It will add the initial configuration, add the session provider, setup an API endpoint and add local environmental variables. It will also configure provider specific setup."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:next-auth\n")),(0,i.kt)("h3",{id:"command-line-arguments"},"Command line arguments"),(0,i.kt)("p",null,"The following command line arguments are available:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Option"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Accepted Values"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--project"),(0,i.kt)("td",{parentName:"tr",align:null},"The name of the project"),(0,i.kt)("td",{parentName:"tr",align:null},"nameOfApplication"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--provider"),(0,i.kt)("td",{parentName:"tr",align:null},"The provider to be installed"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"none/azureAd"),(0,i.kt)("td",{parentName:"tr",align:null},"none")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"--skipPackageJson"),(0,i.kt)("td",{parentName:"tr",align:null},"Do not add dependencies to ",(0,i.kt)("inlineCode",{parentName:"td"},"package.json")),(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},"true/false"),(0,i.kt)("td",{parentName:"tr",align:null},"false")))),(0,i.kt)("h3",{id:"generator-output"},"Generator Output"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Creates a new Next API endpoint with the file name ",(0,i.kt)("inlineCode",{parentName:"li"},"[...nextauth].ts"),". This contains the dynamic route handler for NextAuth.js which will also contain all of your global NextAuth.js configurations. If you have specified a provider when running the generator this will be added to the providers array")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/apps/appName/pages/api/[...nextauth].ts"',title:'"/apps/appName/pages/api/[...nextauth].ts"'},"import NextAuth from 'next-auth';\nimport AzureADProvider from 'next-auth/providers/azure-ad';\nconst nextAuth = NextAuth({\n  providers: [\n    AzureADProvider({\n      clientId: process.env.AZURE_AD_CLIENT_ID,\n      clientSecret: process.env.AZURE_AD_CLIENT_SECRET,\n      tenantId: process.env.AZURE_AD_TENANT_ID,\n    }),\n  ],\n});\nexport default nextAuth;\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install the next-auth package and add to package.json, unless the ",(0,i.kt)("inlineCode",{parentName:"li"},"--skipPackageJson")," option was used")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="/package.json"',title:'"/package.json"'},'"dependencies": {\n    ...otherDependencies\n    "next-auth": "4.18.8",\n},\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create or append an ",(0,i.kt)("inlineCode",{parentName:"li"},".env.local")," file. Adding required next auth environmental variables. These will vary depending on the provider chosen. ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/.env.local"',title:'"/.env.local"'},"NEXTAUTH_URL=http://localhost:4200\nNEXTAUTH_SECRET=secretValue\nAZURE_AD_CLIENT_ID=\nAZURE_AD_CLIENT_SECRET=\nAZURE_AD_TENANT_ID=\n")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Be sure to update the environmental variables with the values provided by your provider")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Append the ",(0,i.kt)("inlineCode",{parentName:"li"},"_app.tsx")," file with a ",(0,i.kt)("a",{parentName:"li",href:"https://next-auth.js.org/getting-started/client#sessionprovider"},"session provider")," ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="/apps/appName/_app.tsx"',title:'"/apps/appName/_app.tsx"'},"import { AppProps } from 'next/app';\nimport Head from 'next/head';\nimport './styles.css';\nimport { SessionProvider } from 'next-auth/react';\nfunction CustomApp({\n  Component,\n  pageProps: { session, ...pageProps },\n}: AppProps) {\n  return (\n    <SessionProvider session={session}>\n      <Head>\n        <title>Welcome to testing!</title>\n      </Head>\n      <main className=\"app\">\n        <Component {...pageProps} />\n      </main>\n    </SessionProvider>\n  );\n}\nexport default CustomApp;\n")),(0,i.kt)("p",null,"From here with the configuration complete it is now possible to access the ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/getting-started/client#usesession"},"useSession")," hook from next auth. For further information please see the ",(0,i.kt)("a",{parentName:"p",href:"https://next-auth.js.org/getting-started/example#frontend---add-react-hook"},"Getting Started Guide to Next Auth"))))}g.isMDXComponent=!0},3679:function(e,t,n){n.r(t),n.d(t,{assets:function(){return h},contentTitle:function(){return m},default:function(){return x},frontMatter:function(){return d},metadata:function(){return g},toc:function(){return k}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=n(7488),o=n(9018),s=n(8597),u=n(4866),p=n(5162),c=["components"],d={id:"ensono-stacks-next",title:"@ensono-stacks/next",sidebar_label:"@ensono-stacks/next",description:"Using next with Ensono Stacks!",keywords:["NX","monorepo","stacks","ensono","next","generator","executor","redis"]},m=void 0,g={unversionedId:"getting_started/next/ensono-stacks-next",id:"getting_started/next/ensono-stacks-next",title:"@ensono-stacks/next",description:"Using next with Ensono Stacks!",source:"@site/docs/getting_started/next/plugin-information.md",sourceDirName:"getting_started/next",slug:"/getting_started/next/ensono-stacks-next",permalink:"/docs/getting_started/next/ensono-stacks-next",draft:!1,tags:[],version:"current",frontMatter:{id:"ensono-stacks-next",title:"@ensono-stacks/next",sidebar_label:"@ensono-stacks/next",description:"Using next with Ensono Stacks!",keywords:["NX","monorepo","stacks","ensono","next","generator","executor","redis"]},sidebar:"docs",previous:{title:"@ensono-stacks/workspace",permalink:"/docs/getting_started/workspace/ensono-stacks-workspace"},next:{title:"@ensono-stacks/azure-node",permalink:"/docs/getting_started/azure-node/ensono-stacks-azure-node"}},h={},k=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting up @ensono-stacks/next",id:"setting-up-ensono-stacksnext",level:2},{value:"Executors and Generators",id:"executors-and-generators",level:2},{value:"Generators",id:"generators",level:3}],f={toc:k},v="wrapper";function x(e){var t=e.components,n=(0,r.Z)(e,c);return(0,i.kt)(v,(0,a.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"next")," plugin contains generators to augment existing NextJs projects. Adding eslint rules, testing config as well as installing and configuring NextAuth.js in your NextJs app."),(0,i.kt)("p",null,"Using a standard setup for your Next app ensures consistency and code quality across multiple applications quickly. NextAuth (alongside Redis) can also be quickly added to a project without costly configuration and setup."),(0,i.kt)("p",null,"Using the deployment generator you can setup your application with the necessary infrastructure config to host it in k8s."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"An existing ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next")," application. Note the generator will fail if run in an empty workspace with no applications. To create a new Next application please run the NX Next generator with the following command including any relevant options. See ",(0,i.kt)("a",{parentName:"p",href:"https://nx.dev/packages/next"},"@nx/next plugin docs")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @nx/next:app my-new-app\n")),(0,i.kt)("p",null,"Ensure the ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"executedGenerators")," fields are present within ",(0,i.kt)("inlineCode",{parentName:"p"},"nx.json")," for FE code generation."),(0,i.kt)("p",null,"Ensure the ",(0,i.kt)("inlineCode",{parentName:"p"},"stacks")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," fields are present and populated within ",(0,i.kt)("inlineCode",{parentName:"p"},"nx.json")," for deployment/infra generation."),(0,i.kt)("p",null,"An example of the expected structure can be ",(0,i.kt)("a",{parentName:"p",href:"/docs/getting_started/workspace/ensono-stacks-workspace#prerequisites"},"seen here")," under ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/workspace:init"),"\u200b prerequisites."),(0,i.kt)("h2",{id:"setting-up-ensono-stacksnext"},"Setting up @ensono-stacks/next"),(0,i.kt)("p",null,"Install the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ensono-stacks/next")," with the following command:"),(0,i.kt)(u.Z,{mdxType:"Tabs"},(0,i.kt)(p.Z,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save-dev @ensono-stacks/next@latest\n"))),(0,i.kt)(p.Z,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add --dev @ensono-stacks/next@latest\n")))),(0,i.kt)("h2",{id:"executors-and-generators"},"Executors and Generators"),(0,i.kt)("p",null,"To see a list of the plugin capabilities run the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx list @ensono-stacks/next\n")),(0,i.kt)("p",null,"View additional information about a plugin capability through the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nx g @ensono-stacks/next:[generator-executor-name] --help\n")),(0,i.kt)("h3",{id:"generators"},"Generators"),(0,i.kt)(l.default,{mdxType:"Init"}),(0,i.kt)(o.default,{mdxType:"NextInitDeployment"}),(0,i.kt)(s.default,{mdxType:"NextAuth"}))}x.isMDXComponent=!0}}]);