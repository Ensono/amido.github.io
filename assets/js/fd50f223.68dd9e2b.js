"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[6083],{3806:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>h});var a=t(4848),o=t(8453),i=t(1470),r=t(9365);const s={id:"quickstart_java",title:"Getting started with the Java Rest API application",sidebar_label:"Getting started",description:"Getting started with the Java Rest API application",keywords:["java","rest","api","application","spring boot","authorization","docker","swagger","auth0","settings","get started"]},l=void 0,c={id:"workloads/azure/backend/java/quickstart_java",title:"Getting started with the Java Rest API application",description:"Getting started with the Java Rest API application",source:"@site/docs/workloads/azure/backend/java/quickstart_java.md",sourceDirName:"workloads/azure/backend/java",slug:"/workloads/azure/backend/java/quickstart_java",permalink:"/docs/workloads/azure/backend/java/quickstart_java",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"quickstart_java",title:"Getting started with the Java Rest API application",sidebar_label:"Getting started",description:"Getting started with the Java Rest API application",keywords:["java","rest","api","application","spring boot","authorization","docker","swagger","auth0","settings","get started"]},sidebar:"docs",previous:{title:"Cosmos DB Emulator",permalink:"/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java"},next:{title:"Using the Maven Scaffolding",permalink:"/docs/workloads/common/backend/java/scaffolding_java"}},d={},h=[{value:"Using the repository to build the Java Spring Boot Rest API application",id:"using-the-repository-to-build-the-java-spring-boot-rest-api-application",level:2},{value:"Running the application locally",id:"running-the-application-locally",level:2},{value:"Clone one of the Java workloads to your local machine from one of the following repos",id:"clone-one-of-the-java-workloads-to-your-local-machine-from-one-of-the-following-repos",level:3},{value:"Configure the application",id:"configure-the-application",level:3},{value:"Build and run the application",id:"build-and-run-the-application",level:3},{value:"Build and run the application using Cosmos DB Emulator",id:"build-and-run-the-application-using-cosmos-db-emulator",level:3},{value:"Verify that the application has started",id:"verify-that-the-application-has-started",level:3},{value:"Authorization",id:"authorization",level:3},{value:"Auth0 configuration properties",id:"auth0-configuration-properties",level:4},{value:"Swagger/OAS",id:"swaggeroas",level:4},{value:"Health check",id:"health-check",level:4},{value:"Using a Docker image",id:"using-a-docker-image",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"using-the-repository-to-build-the-java-spring-boot-rest-api-application",children:"Using the repository to build the Java Spring Boot Rest API application"}),"\n",(0,a.jsx)(n.h2,{id:"running-the-application-locally",children:"Running the application locally"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.h3,{id:"clone-one-of-the-java-workloads-to-your-local-machine-from-one-of-the-following-repos",children:"Clone one of the Java workloads to your local machine from one of the following repos"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Simple web API: ",(0,a.jsx)(n.a,{href:"https://github.com/Ensono/stacks-java",children:"stacks-java repository"})]}),"\n",(0,a.jsxs)(n.li,{children:["Web API with CQRS: ",(0,a.jsx)(n.a,{href:"https://github.com/Ensono/stacks-java-cqrs",children:"stacks-java-cqrs repository"})]}),"\n",(0,a.jsxs)(n.li,{children:["Web API with CQRS and events: ",(0,a.jsx)(n.a,{href:"https://github.com/Ensono/stacks-java-cqrs-events",children:"stacks-java-cqrs-events repository"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.h3,{id:"configure-the-application",children:"Configure the application"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"The application is currently configured to work with the Azure environment only."})}),"\n",(0,a.jsxs)(n.p,{children:["It uses an Azure ",(0,a.jsx)(n.strong,{children:"CosmosDB"})," database to store the example application data. So you should have access to an instance to use with the application."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["For running on a local environment you can use the ",(0,a.jsx)(n.a,{href:"/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java",children:"Cosmos DB emulator"})," (CosmosDB Emulator has a known fixed key). There is no need for CosmosDB for the simple web API implementation (1.i above) as there is no persistence layer in it.\nFor further info please follow the ",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator?tabs=ssl-netstd21",children:"link"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["Set the cosmosdb URI, databaseName and key in main application configuration file (",(0,a.jsx)(n.code,{children:"application.yml"}),") using the values coming from the CosmosDB Emulator UI."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:"title=application.yml",children:"azure:\n  cosmosdb:\n    uri: xxxxxx\n    database: xxxxxx\n    key: xxxxxx\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In addition, Azure ",(0,a.jsx)(n.strong,{children:"ApplicationInsights"})," is used for logging purposes. If this is unavailable, modify the application so that it doesn't fail to startup if it can't access ApplicationInsights, and simply log to the terminal instead."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:"{3} title=application.yml",children:"application-insights:\n  instrumentation-key: xxxxxx\n  enabled: false\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Alternatively, you can use Spring ",(0,a.jsx)(n.code,{children:"local"})," profile, which is configured to not require cloud infrastructure to run. For the details, please follow the ",(0,a.jsx)(n.a,{href:"https://www.baeldung.com/spring-profiles#4-jvm-system-parameter",children:"Spring Profiles"})," article."]}),"\n",(0,a.jsx)(n.p,{children:"There are two corresponding environment variables that need to be set to interact with these systems:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"COSMOSDB_KEY\nAZURE_APPLICATION_INSIGHTS_INSTRUMENTATION_KEY\n"})}),"\n",(0,a.jsxs)(i.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(r.A,{value:"unix",children:(0,a.jsx)(n.p,{children:"Set the two environment variables as additional variables within e.g. ~/.profile or /etc/profile."})}),(0,a.jsx)(r.A,{value:"windows",children:(0,a.jsx)(n.p,{children:"Open the System Properties then select the Advanced tab, then click on the Environment Variables\nbutton and add the new parameters."})})]}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.h3,{id:"build-and-run-the-application",children:"Build and run the application"}),"\n",(0,a.jsxs)(n.p,{children:["Note that at a minimum ",(0,a.jsx)(n.a,{href:"https://adoptopenjdk.net/",children:"Java 11"})," should be installed."]}),"\n",(0,a.jsxs)(n.p,{children:["Move to the ",(0,a.jsx)(n.code,{children:"<PROJECT-NAME>/java"})," folder, then"]}),"\n",(0,a.jsxs)(i.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(r.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw spring-boot:run\n"})})}),(0,a.jsx)(r.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd spring-boot:run\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["For instructions on how to customise the project for your company please look in the ",(0,a.jsx)(n.a,{href:"/docs/workloads/common/backend/java/scaffolding_java",children:"Scaffolding"})," section"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.h3,{id:"build-and-run-the-application-using-cosmos-db-emulator",children:"Build and run the application using Cosmos DB Emulator"}),"\n",(0,a.jsxs)(n.p,{children:['Please refer to section "Determine which root certificates have been installed" in ',(0,a.jsx)(n.a,{href:"/docs/workloads/azure/backend/java/setting_up_cosmos_db_locally_java",children:"Setting Up CosmosDB Emulator"})]}),"\n",(0,a.jsxs)(n.p,{children:["Move to the ",(0,a.jsx)(n.code,{children:"<PROJECT-NAME>/java"})," folder, then\ngo to ",(0,a.jsx)(n.code,{children:"application.yml"})," either comment out the ",(0,a.jsx)(n.code,{children:"application-insights"})," block or set ",(0,a.jsx)(n.code,{children:"enabled"})," property to ",(0,a.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["In ",(0,a.jsx)(n.code,{children:"logback-spring.xml"})," comment out two sections relating to the application-insights (both the appender and the logger)."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",metastring:"title=logback-spring.xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<configuration>\n  <appender class="ch.qos.logback.core.ConsoleAppender" name="console">\n    <encoder>\n      <pattern>%d{dd-MM-yyyy HH:mm:ss.SSS} %magenta([%thread]) | %X{CorrelationId} |\n        %highlight(%-5level) %logger{36}.%M - %msg%n\n      </pattern>\n    </encoder>\n  </appender>\n  \x3c!-- <appender class="com.microsoft.applicationinsights.logback.ApplicationInsightsAppender"\n    name="aiAppender">\n  </appender> --\x3e\n  <root level="info">\n    <appender-ref ref="console"/>\n  </root>\n  \x3c!-- <root level="info">\n    <appender-ref ref="aiAppender"/> --\x3e\n  </root>\n</configuration>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Set ",(0,a.jsx)(n.code,{children:"COSMOSDB_KEY"})," as an environment variable and set the value to be the primary key value on the emulator."]}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsxs)(i.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(r.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'./mvnw spring-boot:run -Dspring-boot.run.jvmArguments=\'-Djavax.net.ssl.trustStore="<Location of the root cosmos db certificate>" -Djavax.net.ssl.trustStorePassword="changeit"\'\n'})})}),(0,a.jsx)(r.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'mvnw.cmd spring-boot:run -Dspring-boot.run.jvmArguments=\'-Djavax.net.ssl.trustStore="<Location of the root cosmos db certificate>" -Djavax.net.ssl.trustStorePassword="changeit"\'\n'})})})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.h3,{id:"verify-that-the-application-has-started",children:"Verify that the application has started"}),"\n",(0,a.jsxs)(n.p,{children:["Browse to ",(0,a.jsx)(n.a,{href:"http://localhost:9000/v1/menu",children:"http://localhost:9000/v1/menu"}),". This should return a valid JSON response."]}),"\n",(0,a.jsxs)(n.p,{children:["The application configuration uses Swagger/OAS3 to represent the API endpoints. The Swagger UI can be viewed by directing your\nbrowser to ",(0,a.jsx)(n.a,{href:"http://localhost:9000/swagger/index.html",children:"http://localhost:9000/swagger/index.html"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"authorization",children:"Authorization"}),"\n",(0,a.jsxs)(n.p,{children:["All API endpoints are (optionally) protected using ",(0,a.jsx)(n.strong,{children:"Auth0"}),". There is an ",(0,a.jsx)(n.code,{children:"auth.properties"})," file within the project codebase.\nIf the following property within this file is set:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"auth.isEnabled=true\n"})}),"\n",(0,a.jsxs)(n.p,{children:["then clients will need to pass an ",(0,a.jsx)(n.code,{children:"Authorization"})," header containing the Bearer token generated from Auth0 as part of the endpoint request. If the value\nis set to ",(0,a.jsx)(n.code,{children:"false"})," then no authorization is required."]}),"\n",(0,a.jsx)(n.h4,{id:"auth0-configuration-properties",children:"Auth0 configuration properties"}),"\n",(0,a.jsxs)(n.p,{children:["If using Auth0 for authorization, Auth0 itself will need to be configured with both an API definition and an associated Application.\nThere are corresponding configuration values required for the Ensono Stacks application, within the ",(0,a.jsx)(n.code,{children:"auth.properties"})," file, e.g."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"auth0.issuer=https://amidostacks.eu.auth0.com/\nauth0.apiAudience=https://amidostacks.eu.auth0.com/api/v2/\n"})}),"\n",(0,a.jsx)(n.p,{children:"These parameters are used to verify that the JWT supplied in the Authorization header of a request is valid."}),"\n",(0,a.jsx)(n.h4,{id:"swaggeroas",children:"Swagger/OAS"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Automatically generated for the project. Go to ",(0,a.jsx)(n.a,{href:"http://localhost:9000/swagger/index.html",children:"Swagger Index"})," to view."]}),"\n",(0,a.jsxs)(n.li,{children:["Swagger Json is here: ",(0,a.jsx)(n.a,{href:"http://localhost:9000/swagger/oas.json",children:"Swagger Json"})]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"health-check",children:"Health check"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Available at: ",(0,a.jsx)(n.a,{href:"http://localhost:9000/health",children:"health check"}),"\n(This can also be configured to run on another port)"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"using-a-docker-image",children:"Using a Docker image"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://docs.docker.com/docker-for-windows/install/",children:"Install Docker for Windows"})}),"\n",(0,a.jsxs)(n.p,{children:["From the ",(0,a.jsx)(n.code,{children:"<PROJECT-NAME>/java"})," folder, build a Docker image using e.g. the command below:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker build --tag stacks:1.0 .\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This uses the ",(0,a.jsx)(n.code,{children:"Dockerfile"})," in this folder to generate the Docker image."]}),"\n",(0,a.jsxs)(n.p,{children:["If you have an ",(0,a.jsx)(n.code,{children:".m2"})," directory in the ",(0,a.jsx)(n.code,{children:"java/"})," folder, the Docker build will attempt to copy the files inside the container and use the cached versions."]}),"\n",(0,a.jsx)(n.p,{children:"Once the Docker image is created, you can then run a Docker container based on this image using e.g."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run -p 9000:9000 -e AZURE_APPLICATION_INSIGHTS_INSTRUMENTATION_KEY -e AZURE_COSMOSDB_KEY stacks:1.0\n"})}),"\n",(0,a.jsx)(n.p,{children:"which passes in the two required environment variables from your own environment."})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>r});t(6540);var a=t(4164);const o={tabItem:"tabItem_Ymn6"};var i=t(4848);function r(e){let{children:n,hidden:t,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(o.tabItem,r),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>k});var a=t(6540),o=t(4164),i=t(3104),r=t(6347),s=t(205),l=t(7485),c=t(1682),d=t(679);function h(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function u(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:o}}=e;return{value:n,label:t,attributes:a,default:o}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:t}=e;const o=(0,r.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l.aZ)(i),(0,a.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(o.location.search);n.set(i,e),o.replace({...o.location,search:n.toString()})}),[i,o])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,i=u(e),[r,l]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const o=null!=(n=a.find((e=>e.default)))?n:a[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:i}))),[c,h]=g({queryString:t,groupId:o}),[m,x]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[o,i]=(0,d.Dv)(t);return[o,(0,a.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:o}),v=(()=>{const e=null!=c?c:m;return p({value:e,tabValues:i})?e:null})();(0,s.A)((()=>{v&&l(v)}),[v]);return{selectedValue:r,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error("Can't select invalid tab value="+e);l(e),h(e),x(e)}),[h,x,i]),tabValues:i}}var x=t(2303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(4848);function j(e){let{className:n,block:t,selectedValue:a,selectValue:r,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),o=s[t].value;o!==a&&(c(n),r(o))},h=e=>{var n;let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{var a;const n=l.indexOf(e.currentTarget)+1;t=null!=(a=l[n])?a:l[0];break}case"ArrowLeft":{var o;const n=l.indexOf(e.currentTarget)-1;t=null!=(o=l[n])?o:l[l.length-1];break}}null==(n=t)||n.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...i,className:(0,o.A)("tabs__item",v.tabItem,null==i?void 0:i.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:i}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function w(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,o.A)("tabs-container",v.tabList),children:[(0,f.jsx)(j,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function k(e){const n=(0,x.A)();return(0,f.jsx)(w,{...e,children:h(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>s});var a=t(6540);const o={},i=a.createContext(o);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);