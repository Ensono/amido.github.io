"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[1e3],{8886:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var a=t(4848),r=t(8453),s=t(1470),i=t(9365);const o={id:"testing_java",title:"Pre-deployment tests and reports",sidebar_label:"Pre-deployment tests and reports",description:"Pre-deployment tests and reports for Java Rest API project",keywords:["java","rest","api","project","testing","test","unit","component","integration","report","mutation","parallel","owasp","code coverage","configuration","access token","dependency checker"]},l=void 0,c={id:"workloads/azure/backend/java/testing/testing_java",title:"Pre-deployment tests and reports",description:"Pre-deployment tests and reports for Java Rest API project",source:"@site/docs/workloads/azure/backend/java/testing/testing_java.md",sourceDirName:"workloads/azure/backend/java/testing",slug:"/workloads/azure/backend/java/testing/testing_java",permalink:"/docs/workloads/azure/backend/java/testing/testing_java",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"testing_java",title:"Pre-deployment tests and reports",sidebar_label:"Pre-deployment tests and reports",description:"Pre-deployment tests and reports for Java Rest API project",keywords:["java","rest","api","project","testing","test","unit","component","integration","report","mutation","parallel","owasp","code coverage","configuration","access token","dependency checker"]},sidebar:"docs",previous:{title:"Pipeline",permalink:"/docs/workloads/azure/backend/java/pipeline_java"},next:{title:"REST API testing with Serenity",permalink:"/docs/workloads/azure/backend/java/testing/execute_serenity_api_tests"}},u={},d=[{value:"Running the tests",id:"running-the-tests",level:2},{value:"Reports",id:"reports",level:2},{value:"Test reports",id:"test-reports",level:3},{value:"Code coverage report",id:"code-coverage-report",level:3},{value:"Dependency checker report",id:"dependency-checker-report",level:3},{value:"Optional: Mutation testing",id:"optional-mutation-testing",level:3},{value:"Running tests in parallel threads - Using forks",id:"running-tests-in-parallel-threads---using-forks",level:3},{value:"Access token configuration",id:"access-token-configuration",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"running-the-tests",children:"Running the tests"}),"\n",(0,a.jsx)(n.p,{children:"Tests within the code are grouped using Tag annotations. There are three groups: 'Unit', 'Component' and 'Integration'. To just run the unit tests, for example, type:"}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'./mvnw test -Dgroups="Unit"\n'})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'mvnw.cmd test -Dgroups="Unit"\n'})})})]}),"\n",(0,a.jsx)(n.p,{children:"Similarly, for the Component tests, you should use:"}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'./mvnw test -Dgroups="Component"\n'})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'mvnw.cmd test -Dgroups="Component"\n'})})})]}),"\n",(0,a.jsx)(n.p,{children:"and the equivalent for running the Integration tests."}),"\n",(0,a.jsx)(n.h2,{id:"reports",children:"Reports"}),"\n",(0,a.jsx)(n.h3,{id:"test-reports",children:"Test reports"}),"\n",(0,a.jsxs)(n.p,{children:["A test report may be created from the ",(0,a.jsx)(n.code,{children:"test"})," package in Java using the Surefire Plugin.\nThe report file (as either XML or HTML) generated for each of the test classes can be found under ",(0,a.jsx)(n.code,{children:"./target/surefire-reports"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Run the following command to create the report:"}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw surefire:test\n"})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd surefire:test\n"})})})]}),"\n",(0,a.jsx)(n.p,{children:"To generate the Serenity report:"}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw clean verify\n"})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd clean verify\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["The report can be viewed under ",(0,a.jsx)(n.code,{children:"./api-tests/target/site/serenity/index.html"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"code-coverage-report",children:"Code coverage report"}),"\n",(0,a.jsx)(n.p,{children:"The JaCoCo Code Coverage tool allows identifying how much of the code is run during the test suite execution. It is by no means an identifier of code and test quality in its own right but can be helpful for checking if logic paths have test coverage, especially for code updates.\nThis library is run in the API pipeline, with output reports being made available to the CI tool being used."}),"\n",(0,a.jsx)(n.p,{children:"To generate the JaCoCo report, please execute the following command:"}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw jacoco:report\n"})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd jacoco:report\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["The generated report can be viewed under ",(0,a.jsx)(n.code,{children:"./target/site/jacoco/index.html"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"dependency-checker-report",children:"Dependency checker report"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"https://owasp.org/www-project-dependency-check/",children:"OWASP Dependency-Check"})," is a Software Composition Analysis tool that attempts to detect publicly disclosed vulnerabilities contained within a project\u2019s dependencies.\nDependency-check has a command line interface, a Maven plugin, an Ant task, and a Jenkins plugin. The core engine contains a series of analyzers that inspect the project dependencies, collect pieces of information about the dependencies (referred to as evidence within the tool).\nTo generate the dependency checker report please execute:"]}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw clean install -Powasp-dependency-check\n"})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd clean install -Powasp-dependency-check\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["The generated report can be viewed under - ",(0,a.jsx)(n.code,{children:"./target/dependency-check.html"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"optional-mutation-testing",children:"Optional: Mutation testing"}),"\n",(0,a.jsxs)(n.p,{children:["PIT mutation testing is used to generate mutation tests (see ",(0,a.jsx)(n.a,{href:"https://pitest.org/",children:"PIT Documentation"})," for details).\nThe mutation coverage goal analyses all classes in the codebase that match the target tests and target class filters.\nTo run it:"]}),"\n",(0,a.jsxs)(s.A,{groupId:"operating-systems",defaultValue:"unix",values:[{label:"Unix",value:"unix"},{label:"Windows",value:"windows"}],children:[(0,a.jsx)(i.A,{value:"unix",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./mvnw org.pitest:pitest-maven:mutationCoverage\n"})})}),(0,a.jsx)(i.A,{value:"windows",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvnw.cmd org.pitest:pitest-maven:mutationCoverage\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["The generated report can be viewed under \u2013 ",(0,a.jsx)(n.code,{children:"./target/pit-reports/YYYYMMDDHHMI"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"running-tests-in-parallel-threads---using-forks",children:"Running tests in parallel threads - Using forks"}),"\n",(0,a.jsx)(n.p,{children:"Choosing the right forking strategy and parallel execution settings can have a substantial impact on the memory requirements, and the execution time of the build system.\nUsing multiple forks can be a good alternative to running all tests in a single JVM, and can reduce the risk of certain types of errors."}),"\n",(0,a.jsx)(n.p,{children:"Using Forked Test Execution, new JVM processes are spun up to execute the tests, up to a configurable maximum number of processes. This creates better separation between tests, which can improve their reliability."}),"\n",(0,a.jsxs)(n.p,{children:["Maven is set to spawn new processes by the ",(0,a.jsx)(n.code,{children:"forkCount"}),' configuration element, as shown here below. This can either be a number (the maximum number of forks) or a multiplier (the number of forks per CPU).\nThe current configuration uses the value of "2", which means 2 forked processes per CPU:']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"<plugin>\n    <artifactId>maven-failsafe-plugin</artifactId>\n    <version>2.22.2</version>\n    <configuration>\n        <parallel>classes</parallel>\n        <threadCount>2</threadCount>\n        <forkCount>2</forkCount>\n    </configuration>\n</plugin>\n"})}),"\n",(0,a.jsx)(n.h3,{id:"access-token-configuration",children:"Access token configuration"}),"\n",(0,a.jsxs)(n.p,{children:["In order to make the authenticated requests (pass Bearer Token into headers) for the functional tests, please change the value of ",(0,a.jsx)(n.code,{children:"generate.auth0.token"})," from ",(0,a.jsx)(n.code,{children:"serenity.conf"})," file config to 'true'.\nAlso, to get the right access token please provide values for following variables in the ",(0,a.jsx)(n.code,{children:"environment variables"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-properties",children:"- CLIENT_ID\n- CLIENT_SECRET\n- AUDIENCE\n- GRANT_TYPE\n- OAUTH_TOKEN_URL\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In case the Authorization Token is not required the ",(0,a.jsx)(n.code,{children:"generate.auth0.token"})," value is false"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"The more threads are used, the higher the chances of sporadic, hard-to-reproduce test failures due to timeouts and other related issues. The added performance gain of each thread also tends to drop off for higher numbers of threads."})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>i});t(6540);var a=t(4164);const r={tabItem:"tabItem_Ymn6"};var s=t(4848);function i(e){let{children:n,hidden:t,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,i),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>y});var a=t(6540),r=t(4164),s=t(3104),i=t(6347),o=t(205),l=t(7485),c=t(1682),u=t(679);function d(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:r}}=e;return{value:n,label:t,attributes:a,default:r}}))}(t);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:t}=e;const r=(0,i.W6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l.aZ)(s),(0,a.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(r.location.search);n.set(s,e),r.replace({...r.location,search:n.toString()})}),[s,r])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,s=h(e),[i,l]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const r=null!=(n=a.find((e=>e.default)))?n:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s}))),[c,d]=g({queryString:t,groupId:r}),[m,v]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,s]=(0,u.Dv)(t);return[r,(0,a.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:r}),f=(()=>{const e=null!=c?c:m;return p({value:e,tabValues:s})?e:null})();(0,o.A)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);l(e),d(e),v(e)}),[d,v,s]),tabValues:s}}var v=t(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(4848);function b(e){let{className:n,block:t,selectedValue:a,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const n=e.currentTarget,t=l.indexOf(n),r=o[t].value;r!==a&&(c(n),i(r))},d=e=>{var n;let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var a;const n=l.indexOf(e.currentTarget)+1;t=null!=(a=l[n])?a:l[0];break}case"ArrowLeft":{var r;const n=l.indexOf(e.currentTarget)-1;t=null!=(r=l[n])?r:l[l.length-1];break}}null==(n=t)||n.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>l.push(e),onKeyDown:d,onClick:u,...s,className:(0,r.A)("tabs__item",f.tabItem,null==s?void 0:s.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function j(e){let{lazy:n,children:t,selectedValue:r}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=m(e);return(0,x.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,x.jsx)(b,{...n,...e}),(0,x.jsx)(j,{...n,...e})]})}function y(e){const n=(0,v.A)();return(0,x.jsx)(w,{...e,children:d(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(6540);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);