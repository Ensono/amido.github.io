"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[3805],{8212:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"workloads/azure/backend/netcore/security_netcore","title":"Application Security","description":"OAuth for .NET","source":"@site/docs/workloads/azure/backend/netcore/security_netcore.md","sourceDirName":"workloads/azure/backend/netcore","slug":"/workloads/azure/backend/netcore/security_netcore","permalink":"/docs/workloads/azure/backend/netcore/security_netcore","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"security_netcore","title":"Application Security","sidebar_label":"Security","description":"OAuth for .NET","keywords":["oauth",".net","authentication","configuration","enable oauth","authorization url![alt text](image.png)","authorization"]},"sidebar":"docs","previous":{"title":"Logging","permalink":"/docs/workloads/azure/backend/netcore/logging_netcore"},"next":{"title":"Introduction","permalink":"/docs/workloads/common/backend/java/intro_java"}}');var o=n(4848),s=n(8453);const r={id:"security_netcore",title:"Application Security",sidebar_label:"Security",description:"OAuth for .NET",keywords:["oauth",".net","authentication","configuration","enable oauth","authorization url![alt text](image.png)","authorization"]},a=void 0,h={},c=[{value:"Overview",id:"overview",level:2},{value:"Authentication: &quot;Who Are You?&quot;",id:"authentication-who-are-you",level:3},{value:"Authorization: &quot;What Are You Allowed to Do?&quot;",id:"authorization-what-are-you-allowed-to-do",level:3},{value:"In Summary",id:"in-summary",level:3},{value:"Authentication (Checking JWT Access Tokens)",id:"authentication-checking-jwt-access-tokens",level:2},{value:"How to Set Up Authentication",id:"how-to-set-up-authentication",level:3},{value:"Making Login Work in Swagger (Your API Documentation)",id:"making-login-work-in-swagger-your-api-documentation",level:3},{value:"Testing Your API with JWT Tokens",id:"testing-your-api-with-jwt-tokens",level:3},{value:"Checking If Authentication Works Correctly in Tests",id:"checking-if-authentication-works-correctly-in-tests",level:3},{value:"Authorization (Who Can Do What)",id:"authorization-who-can-do-what",level:3}];function l(e){const t={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(t.p,{children:"This project template for building APIs using .NET can be easily set up to use OAuth 2.0 authentication. This means it can work with services that handle user login (like Google, Auth0, or Microsoft)."}),"\n",(0,o.jsxs)(t.admonition,{title:"What's the Difference Between Authentication and Authorization?",type:"note",children:[(0,o.jsxs)(t.p,{children:["When you're building an API or any system that handles users, you'll often hear the terms ",(0,o.jsx)(t.strong,{children:"Authentication"})," and ",(0,o.jsx)(t.strong,{children:"Authorization"}),". While they sound similar, they do very different things."]}),(0,o.jsx)(t.h3,{id:"authentication-who-are-you",children:'Authentication: "Who Are You?"'}),(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"Authentication"})," is all about ",(0,o.jsx)(t.strong,{children:"proving who you are"}),". It's the process of checking whether someone is a valid user."]}),(0,o.jsx)(t.p,{children:"For example, when a user logs in with their username and password (or Google account, etc.), the system checks if their credentials (login info) match an existing user. If they match, the user gets a token (like an ID badge) that proves they're logged in."}),(0,o.jsx)(t.p,{children:"Think of it like a bouncer at a club checking your ID to make sure you are who you say you are."}),(0,o.jsx)(t.h3,{id:"authorization-what-are-you-allowed-to-do",children:'Authorization: "What Are You Allowed to Do?"'}),(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"Authorization"})," happens ",(0,o.jsx)(t.strong,{children:"after"})," authentication and controls ",(0,o.jsx)(t.strong,{children:"what you're allowed to do"}),". Once we know who the user is (they've authenticated), we need to check what actions they can perform."]}),(0,o.jsx)(t.p,{children:"For example, some users might only be allowed to view data, while others can edit or delete it. Authorization makes sure users only access what they have permission to do."}),(0,o.jsx)(t.p,{children:"Think of it like being in a building: you might be allowed to enter the lobby (authentication), but whether you're allowed in restricted areas depends on your access level (authorization)."}),(0,o.jsx)(t.h3,{id:"in-summary",children:"In Summary"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Authentication"})," = Are you a valid user? (Proving who you are)"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Authorization"})," = What can you do? (Checking your permissions)"]}),"\n"]}),(0,o.jsx)(t.p,{children:"Both are important for keeping your application secure!"})]}),"\n",(0,o.jsx)(t.h2,{id:"authentication-checking-jwt-access-tokens",children:"Authentication (Checking JWT Access Tokens)"}),"\n",(0,o.jsxs)(t.p,{children:["In this project, we check if a user is logged in using ",(0,o.jsx)(t.strong,{children:"JWT tokens"}),". A JWT token is like a badge someone gets after they log in. They show this badge whenever they want to access parts of your API that require authentication."]}),"\n",(0,o.jsxs)(t.p,{children:["To check the JWT tokens, we use a built-in .NET tool called the ",(0,o.jsx)(t.strong,{children:"JWT Bearer middleware"}),". This tool automatically handles the process of checking if the token is valid."]}),"\n",(0,o.jsx)(t.p,{children:"By default, the code doesn't require any login to access your API, but you can easily change this by updating some settings."}),"\n",(0,o.jsx)(t.h3,{id:"how-to-set-up-authentication",children:"How to Set Up Authentication"}),"\n",(0,o.jsxs)(t.p,{children:["To turn on authentication (so that users need to log in), you need to update the settings in the ",(0,o.jsx)(t.code,{children:"appsettings.json"})," file. This file is where all your API's important settings are kept."]}),"\n",(0,o.jsx)(t.p,{children:"In this section:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'"JwtBearerAuthentication": {\n    "Audience": "<insert-audience-here>",\n    "Authority": "<insert-authority-here>",\n    "Enabled": false,\n    "OpenApi": {\n        "AuthorizationUrl": "<insert-authorization-url-here>",\n        "ClientId": "<insert-client-id-here>",\n        "TokenUrl": "<insert-token-url-here>"\n    }\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"The important parts to focus on are:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"Enabled"}),": This is set to ",(0,o.jsx)(t.code,{children:"false"})," by default, which means anyone can access your API without logging in. You should change this to ",(0,o.jsx)(t.code,{children:"true"})," to require login."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"Audience"}),": This tells the API who the token (badge) is meant for. For example, if you're using a login service like Auth0, this will be the identifier for your API."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"Authority"}),": This is the place where the token was issued (who gave the badge). Usually, this is the URL of the service you're using to log users in (like ",(0,o.jsx)(t.code,{children:"https://your-auth-service.com"}),")."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Once you fill in the ",(0,o.jsx)(t.code,{children:"Audience"}),", ",(0,o.jsx)(t.code,{children:"Authority"}),", and set ",(0,o.jsx)(t.code,{children:"Enabled"})," to ",(0,o.jsx)(t.code,{children:"true"}),", your API is secured. Now, only users with a valid login token can access certain parts of it."]}),"\n",(0,o.jsx)(t.h3,{id:"making-login-work-in-swagger-your-api-documentation",children:"Making Login Work in Swagger (Your API Documentation)"}),"\n",(0,o.jsxs)(t.p,{children:["Swagger is a tool that lets you document and test your API. You can also use it to test if users can log in. To make this work, you need to add some extra details to the ",(0,o.jsx)(t.code,{children:"appsettings.json"})," file in the ",(0,o.jsx)(t.code,{children:"OpenApi"})," section:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"AuthorizationUrl"})}),": This is the page users will go to when they need to log in."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"ClientId"})}),": This is a special ID that identifies your API in the login system (like a username for your API)."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"TokenUrl"})}),": After the user logs in, this is the URL used to get the token."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"When you set these, users will see a little lock icon next to protected endpoints in the Swagger documentation. Clicking the lock will let them log in and try out the API."}),"\n",(0,o.jsx)(t.p,{children:'If they already have a token, they can also use it directly by selecting "bearer (apiKey)" in Swagger.'}),"\n",(0,o.jsx)(t.h3,{id:"testing-your-api-with-jwt-tokens",children:"Testing Your API with JWT Tokens"}),"\n",(0,o.jsx)(t.p,{children:"When you write tests for your API, you can also set up JWT authentication for those tests. This lets you check that your API behaves correctly when users try to access it with or without a valid login."}),"\n",(0,o.jsxs)(t.p,{children:["You can configure these settings in a file called ",(0,o.jsx)(t.code,{children:"CustomAutoDataAttribute.cs"}),". Here's an example of how it might look:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-csharp",children:'var jwtBearerAuthenticationConfiguration = new JwtBearerAuthenticationConfiguration\n{\n    AllowExpiredTokens = true,  // Lets you use expired tokens for testing\n    Audience = "<insert-audience-here>",\n    Authority = "<insert-authority-here>",\n    Enabled = false,\n    OpenApi = new OpenApiJwtBearerAuthenticationConfiguration\n    {\n        AuthorizationUrl = "<insert-authorization-url-here>",\n        ClientId = "<insert-client-id-here>",\n        TokenUrl = "<insert-token-url-here>"\n    },\n    UseStubbedBackChannelHandler = true  // Pretends to communicate with the login system to make tests faster\n};\n'})}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"AllowExpiredTokens"}),": Normally, expired tokens are rejected, but for testing, you can allow them. This makes it easier to use pre-made tokens."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"UseStubbedBackChannelHandler"}),": This simulates communication with the login system, so you don't have to wait for real requests. It speeds up tests and makes sure they run even if the login system is down."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"checking-if-authentication-works-correctly-in-tests",children:"Checking If Authentication Works Correctly in Tests"}),"\n",(0,o.jsx)(t.p,{children:"When testing, you might want to check these scenarios:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"If no token is provided"}),", your API should return a ",(0,o.jsx)(t.code,{children:"401 Unauthorized"})," error, meaning the user is not logged in."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"If a token is provided but it doesn't have the right permissions"}),", your API should return a ",(0,o.jsx)(t.code,{children:"403 Forbidden"})," error, meaning the user is logged in but not allowed to do certain things."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["To make sure your tests cover these cases, the ",(0,o.jsx)(t.code,{children:"Audience"})," and ",(0,o.jsx)(t.code,{children:"Authority"})," settings in your test code need to match the values used in your JWT tokens."]}),"\n",(0,o.jsxs)(t.p,{children:["You can also store test tokens in a special file called ",(0,o.jsx)(t.code,{children:"AuthTokenFixture.cs"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"authorization-who-can-do-what",children:"Authorization (Who Can Do What)"}),"\n",(0,o.jsxs)(t.p,{children:["This template only handles basic login (authentication), not complex rules about what each user can do (authorization). However, you can add these rules yourself by using .NET's built-in tools, like ",(0,o.jsx)(t.strong,{children:"Authorization Policies"}),". This lets you decide what actions different types of users can take based on the information (claims) in their JWT token."]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(6540);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);