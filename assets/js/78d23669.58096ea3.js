"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[9744],{9809:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var t=n(4848),s=n(8453);const i={id:"infrastructure_data_azure",title:"Infrastructure & Networking",sidebar_label:"Infrastructure & Networking",hide_title:!1,hide_table_of_contents:!1,description:"Infrastructure & Networking overview",keywords:["azure","resource group","adf","adls","blob","databricks","key vault"]},a=void 0,c={id:"workloads/azure/data/architecture/infrastructure_data_azure",title:"Infrastructure & Networking",description:"Infrastructure & Networking overview",source:"@site/docs/workloads/azure/data/architecture/infrastructure_data_azure.md",sourceDirName:"workloads/azure/data/architecture",slug:"/workloads/azure/data/architecture/infrastructure_data_azure",permalink:"/docs/workloads/azure/data/architecture/infrastructure_data_azure",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"infrastructure_data_azure",title:"Infrastructure & Networking",sidebar_label:"Infrastructure & Networking",hide_title:!1,hide_table_of_contents:!1,description:"Infrastructure & Networking overview",keywords:["azure","resource group","adf","adls","blob","databricks","key vault"]},sidebar:"docs",previous:{title:"Architecture Overview",permalink:"/docs/workloads/azure/data/architecture/architecture_data_azure"},next:{title:"Security",permalink:"/docs/workloads/azure/data/architecture/security_data_azure"}},o={},l=[{value:"Infrastructure",id:"infrastructure",level:2},{value:"Networking",id:"networking",level:2},{value:"Databricks secure cluster connectivity",id:"databricks-secure-cluster-connectivity",level:3}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.p,{children:["Core data platform resources are defined within Terraform templates and grouped inside\n",(0,t.jsx)(r.a,{href:"https://github.com/ensono/stacks-azure-data/tree/main/deploy/azure",children:"deploy/azure"})," directory.\nThere are two subfolders in this directory:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"infra"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"networking"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"infrastructure",children:"Infrastructure"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"infra"})," subfolder contains the following definitions:"]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Resource Group"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Azure SQL Database"})," sample instance with database schemas"]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Key Vault"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Key Vault Secrets"}),":","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Connection strings for the created SQL databases"}),"\n",(0,t.jsx)(r.li,{children:"Passwords to the SQL Databases"}),"\n",(0,t.jsx)(r.li,{children:"Service Principal Secret"}),"\n",(0,t.jsx)(r.li,{children:"Azure Tenant ID \u2013 Directory ID for Azure Active Directory application"}),"\n",(0,t.jsx)(r.li,{children:"Azure Client ID \u2013 Application ID for Azure Active Directory application"}),"\n",(0,t.jsx)(r.li,{children:"Databricks access token & host"}),"\n",(0,t.jsx)(r.li,{children:"Other secret names with empty values to be replaced manually. Existing secrets are not\noverwritten."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Azure Data Lake Storage Gen2"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Azure Blob Storage"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Databricks Workspace"})," including:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Key Vault-backed secret scope"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Azure Data Factory"})," including:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Managed identity"})," for the service instance;"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Managed virtual network"})," enabled by default. Creating an integration runtime within\na managed virtual network ensures the data integration process is isolated and secure."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Managed private endpoints"})," created in the Data Factory managed virtual network, these\nestablish private links to Azure resources, such as:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Blob Storage"}),"\n",(0,t.jsx)(r.li,{children:"Azure Data Lake Storage"}),"\n",(0,t.jsx)(r.li,{children:"Key Vault"}),"\n",(0,t.jsx)(r.li,{children:"SQL Database"}),"\n",(0,t.jsx)(r.li,{children:"Databricks Workspace"}),"\n",(0,t.jsx)(r.li,{children:"Databricks Browser Authentication Page"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Role assignments"})," that assign ADF managed identity roles to access the resources linked by\nthe private endpoints."]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Log Analytics Workspace"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"networking",children:"Networking"}),"\n",(0,t.jsxs)(r.p,{children:["Using a private network is the default behaviour in the Ensono Stacks Data Azure Platform. The ",(0,t.jsx)(r.code,{children:"networking"}),"\nsubfolder contains configurations for the created network and subnetworks, at its core using\n",(0,t.jsx)(r.a,{href:"https://github.com/ensono/stacks-terraform/tree/master/azurerm/modules/azurerm-hub-spoke",children:"azurerm-hub-spoke"}),"\nEnsono Stacks Terraform module. See ",(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli",children:"Microsoft documentation"})," for more details on implementing Hub-spoke network topology in Azure."]}),"\n",(0,t.jsx)(r.p,{children:"The following diagram shows network configuration for the two default environments:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Hub network (",(0,t.jsx)(r.code,{children:"is_hub: true"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Nonprod (",(0,t.jsx)(r.code,{children:"is_hub: false"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Prod (",(0,t.jsx)(r.code,{children:"is_hub: false"}),")"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"network_hub_spoke.png",src:n(997).A+"",width:"4088",height:"5813"})}),"\n",(0,t.jsx)(r.h3,{id:"databricks-secure-cluster-connectivity",children:"Databricks secure cluster connectivity"}),"\n",(0,t.jsx)(r.p,{children:"Ensono Stacks Azure Data Platform uses VNet injection to deploy Databricks into a custom virtual network."}),"\n",(0,t.jsx)(r.p,{children:"In most scenarios, we recommend that Azure Databricks is deployed in a fully secure manner, using\nsecure cluster connectivity and disabling public workspace access. This means that Databricks\ncan only be accessed over a private endpoint from within the private network. This also means that\nprojects would need to have networking prerequisites such as ExpressRoute or VPNs in order to access\nthe workspace. If this is not possible, then a virtual machine will need to be set up within the\ntransit subnet. Users will then need to RDP into the VM and access the workspace via that."}),"\n",(0,t.jsx)(r.p,{children:"Even without public IPs and with the data plane deployed into our VNet, there is still the option\nto toggle access to the Workspace UI via public networks. The default configuration disallows access\nto the Databricks workspace over the public internet in production environments, while leaving it\nopen in development environments. This approach enhances the developer experience in case there is\nno properly configured networking/VPN set up in the target subscription."}),"\n",(0,t.jsx)(r.p,{children:"Enabling public workspace access only opens access to the UI via public internet. Access is still\nrestricted based on the IAM policy."}),"\n",(0,t.jsx)(r.p,{children:"The following diagram depicts the Databricks network configuration."}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"network_databricks.png",src:n(4042).A+"",width:"3658",height:"3407"})})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},4042:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/network_databricks-58bef66a170ba0a4b6644c3c20dc0afa.png"},997:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/network_hub_spoke-8f920bb21582cdf8cb4d776649649bf8.png"},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>c});var t=n(6540);const s={},i=t.createContext(s);function a(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);