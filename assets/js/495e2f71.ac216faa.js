"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[1704],{1159:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var t=s(4848),i=s(8453),r=s(1470),a=s(9365);const l={id:"playwright_visual_testing",title:"Visual Regression Testing with Playwright",sidebar_label:"Playwright with Visual Comparisons",description:"Visual regression testing with Playwrights visual comparison API!",keywords:["NX","axe","tests","testing","playwright","visual","regression","applitools","eyes"]},o=void 0,c={id:"testing/testing_in_nx/playwright_visual_testing",title:"Visual Regression Testing with Playwright",description:"Visual regression testing with Playwrights visual comparison API!",source:"@site/docs/testing/testing_in_nx/playwright_visual_testing.md",sourceDirName:"testing/testing_in_nx",slug:"/testing/testing_in_nx/playwright_visual_testing",permalink:"/docs/testing/testing_in_nx/playwright_visual_testing",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"playwright_visual_testing",title:"Visual Regression Testing with Playwright",sidebar_label:"Playwright with Visual Comparisons",description:"Visual regression testing with Playwrights visual comparison API!",keywords:["NX","axe","tests","testing","playwright","visual","regression","applitools","eyes"]},sidebar:"docs",previous:{title:"Accessibility Testing",permalink:"/docs/testing/testing_in_nx/playwright_accessibility_testing"},next:{title:"Playwright with Applitools Eyes",permalink:"/docs/testing/testing_in_nx/playwright_visual_testing_applitools_eyes"}},u={},d=[{value:"Playwright visual comparisons",id:"playwright-visual-comparisons",level:2},{value:"CI strategy for visual comparison",id:"ci-strategy-for-visual-comparison",level:3},{value:"Snapshot configuration",id:"snapshot-configuration",level:3},{value:"Sample tests",id:"sample-tests",level:3},{value:"Running your visual regression tests",id:"running-your-visual-regression-tests",level:2},{value:"Locally",id:"locally",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Performing visual regression testing with Playwright ensures that the visual elements of your application are functioning correctly and are consistent across different browsers, devices, and screen sizes. By catching visual bugs early on in the development process, visual regression testing helps to prevent costly and time-consuming rework, and ensures that the end user has a consistent and polished experience."}),"\n",(0,t.jsx)(n.p,{children:"With Playwright this can be achieved natively through it's visual comparisons api. This is a great first step to capitalise on the benefits of visual regression testing, however, we highly recommend using a cloud based provider such as Applitools eyes. Using Applitools eyes grants multiple benefits over the native capability of playwright such as automated baseline management, greater browser/device support, rich reporting and analytics and easier collaboration."}),"\n",(0,t.jsx)(n.h2,{id:"playwright-visual-comparisons",children:"Playwright visual comparisons"}),"\n",(0,t.jsx)(n.p,{children:"Scaffolding your project with a native configuration for visual regression testing will generate a sample set of tests and update your project configuration."}),"\n",(0,t.jsx)(n.h3,{id:"ci-strategy-for-visual-comparison",children:"CI strategy for visual comparison"}),"\n",(0,t.jsx)(n.p,{children:"When working with visual comparisons using playwright and your own CI system there are a number of challenges:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Users may have different browsers and dependency versions installed locally when capturing images, leading to pixel variance during image comparison."}),"\n",(0,t.jsx)(n.li,{children:"Images captured on different operating systems can lead to pixel variance"}),"\n",(0,t.jsx)(n.li,{children:"Images captured on different CPU architecture can lead to pixel variance"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["One possible solution to this is to utilise the ",(0,t.jsx)(n.a,{href:"https://playwright.dev/docs/docker",children:"Playwright Docker"})," container, however, through extensive testing we still found significant differences when comparing images captured on docker containers for alternative architecture."]}),"\n",(0,t.jsx)(n.h3,{id:"snapshot-configuration",children:"Snapshot configuration"}),"\n",(0,t.jsx)(n.p,{children:"As part of native visual comparisons with playwright the following recommended configuration is added into the projects config file during scaffolding:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:'title="playwright.config.base.ts"',children:"\r\n  /* Visual regression config */\r\n  updateSnapshots: 'missing',\r\n  ignoreSnapshots: !process.env.CI,\r\n  expect: {\r\n    toHaveScreenshot: {\r\n      maxDiffPixelRatio: 0.05,\r\n      threshold: 0.2,\r\n      animations: 'disabled',\r\n    },\r\n    toMatchSnapshot: {\r\n      maxDiffPixelRatio: 0.05,\r\n      threshold: 0.2,\r\n    },\r\n  }\r\n\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["updateSnapshots","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Description: Whether to update expected snapshots with the actual results produced by the test run."}),"\n",(0,t.jsxs)(n.li,{children:["Value: ",(0,t.jsx)(n.strong,{children:"'missing'"})," - Missing snapshots are created, for example when authoring a new test and running it for the first time."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["ignoreSnapshots","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Description: Whether to skip snapshot expectations, such as expect(value).toMatchSnapshot() and await expect(page).toHaveScreenshot().."}),"\n",(0,t.jsxs)(n.li,{children:["Value: ",(0,t.jsx)(n.strong,{children:"!process.env.CI"})," - Any snapshot checks are skipped unless the test is being ran within the CI."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["toHaveScreenshot/toMatchSnapshot::maxDiffPixelRatio","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Description: an acceptable ratio of pixels that are different to the total amount of pixels, between 0 and 1."}),"\n",(0,t.jsxs)(n.li,{children:["Value: ",(0,t.jsx)(n.strong,{children:"0.05"})," - Any images with > 0.05% pixel variance will be flagged."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["toHaveScreenshot/toMatchSnapshot::threshold","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Description: an acceptable perceived colour difference in the YIQ colour space between the same pixel in compared images, between zero (strict) and one (lax)."}),"\n",(0,t.jsxs)(n.li,{children:["Value: ",(0,t.jsx)(n.strong,{children:"0.2"})," - Any pixel with > 20% variance will be flagged"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["toHaveScreenshot::animations","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Description: whether to enable or disable CSS animations, CSS transitions and Web Animations"}),"\n",(0,t.jsxs)(n.li,{children:["Value: ",(0,t.jsx)(n.strong,{children:"disabled"})," - finite animations are fast-forwarded to completion and infinite animations are cancelled to initial state."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["Visual comparisons can be configured in many ways, for further details check out ",(0,t.jsx)(n.a,{href:"https://playwright.dev/docs/api/class-locatorassertions#locator-assertions-to-have-screenshot-1",children:"the docs!"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"sample-tests",children:"Sample tests"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:'title="playwright-visual-regression.spec.ts"',children:'import { test, expect } from "@playwright/test";\r\n\r\ntest.describe("Native @visual-regression", () => {\r\n  test.beforeEach(async ({ page }) => {\r\n    // Wait for network and body to be visible to ensure app is loaded\r\n    await page.goto("/", { waitUntil: "networkidle" });\r\n    await page.waitForSelector("body", { state: "visible" });\r\n  });\r\n\r\n  test("main page to have no visual regressions", async ({ page }) => {\r\n    const screenshot = await page.screenshot({ fullPage: true });\r\n    await expect(screenshot).toMatchSnapshot("main-page.png");\r\n  });\r\n\r\n  test("Expanded information blocks have no visual regressions", async ({\r\n    page,\r\n  }) => {\r\n    // eslint-disable-next-line no-restricted-syntax\r\n    for (const information of await page\r\n      .locator("#commands >> details")\r\n      .elementHandles()) {\r\n      /* eslint-disable no-await-in-loop */\r\n      await information.click();\r\n    }\r\n    await expect(page.locator("#commands")).toHaveScreenshot("info-blocks.png");\r\n  });\r\n});\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The sample contains two tests, showcasing playwrights ability to perform full page comparisons, or target specific areas of the web page.\r\nUpon first run of the test(s) Playwright will capture a baseline image, the name will vary depending on whether a value is passed to the ",(0,t.jsx)(n.code,{children:"toHaveScreenshot()"}),"/",(0,t.jsx)(n.code,{children:"toMatchScreenshot()"})," methods:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Default: auto-generated name consisting of ",(0,t.jsx)(n.code,{children:"desribe block name"}),"-",(0,t.jsx)(n.code,{children:"test case name"}),"-",(0,t.jsx)(n.code,{children:"browser"}),"-",(0,t.jsx)(n.code,{children:"operating system"}),".png"]}),"\n",(0,t.jsxs)(n.li,{children:["Defined: user specified name resulting in ",(0,t.jsx)(n.code,{children:"user defined name"}),"-",(0,t.jsx)(n.code,{children:"browser"}),"-",(0,t.jsx)(n.code,{children:"operating system"}),".png"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["As indicated by the below folder structure, a ",(0,t.jsx)(n.code,{children:"playwright-visual-regression.spec.ts-snapshots"})," folder will be generated for the ",(0,t.jsx)(n.code,{children:"playwright-visual-regression.spec.ts"})," file to house all associated baseline images. Using the ",(0,t.jsx)(n.a,{href:"/docs/testing/testing_in_nx/testing_with_playwright#project-based-configuration",children:"project based configuration"})," multiple screenshots will be captured for each device, in this example capturing the snapshots on windows results in each image being appended with ",(0,t.jsx)(n.em,{children:"'win32'"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",metastring:'title="Output from running the playwright-visual-regression.spec.ts example"',children:".\r\n\u251c\u2500\u2500 playwright-visual-regression.spec.ts-snapshots/\r\n\u2502   \u251c\u2500\u2500 main-page-expanded-blocks-chromium-win32.png\r\n\u2502   \u251c\u2500\u2500 main-page-expanded-blocks-firefox-win32.png\r\n\u2502   \u251c\u2500\u2500 main-page-expanded-blocks-Mobile-Chrome-win32.png\r\n\u2502   \u251c\u2500\u2500 main-page-expanded-blocks-Mobile-Safari-win32.png\r\n\u2502   \u251c\u2500\u2500 main-page-expanded-blocks-webkit-win32.png\r\n\u2502   \u251c\u2500\u2500 Native-visual-regression-main-page-to-have-no-visual-regressions-1-chromium-win32.png\r\n\u2502   \u251c\u2500\u2500 Native-visual-regression-main-page-to-have-no-visual-regressions-1-firefox-win32.png\r\n\u2502   \u251c\u2500\u2500 Native-visual-regression-main-page-to-have-no-visual-regressions-1-Mobile-Chrome-win32.png\r\n\u2502   \u251c\u2500\u2500 Native-visual-regression-main-page-to-have-no-visual-regressions-1-Mobile-Safari-win32.png\r\n\u2502   \u2514\u2500\u2500 Native-visual-regression-main-page-to-have-no-visual-regressions-1-webkit-win32.png\r\n\u2514\u2500\u2500 playwright-visual-regression.spec.ts\n"})}),"\n",(0,t.jsx)(n.h2,{id:"running-your-visual-regression-tests",children:"Running your visual regression tests"}),"\n",(0,t.jsx)(n.h3,{id:"locally",children:"Locally"}),"\n",(0,t.jsxs)(n.p,{children:["Playwright visual tests must be tagged with ",(0,t.jsx)(n.strong,{children:"@visual-regression"})," which enables us to target them through ",(0,t.jsx)(n.strong,{children:"grep"})," as seen in the ",(0,t.jsx)(n.a,{href:"/docs/testing/testing_in_nx/testing_with_playwright#run-specific-tests",children:"'Run specific tests'"})," example"]}),"\n",(0,t.jsxs)(r.A,{children:[(0,t.jsx)(a.A,{value:"grouped",label:"Grouped",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"//multiple tests grouped in a describe block\r\ntest.describe('Example test group @visual-regression', () => {\r\n\r\n   test('visual test 1', async ({ page }) => {\r\n       //test code\r\n   });\r\n\r\n   test('visual test 2', async ({ page }) => {\r\n       //test code\r\n   });\r\n}\n"})})}),(0,t.jsx)(a.A,{value:"individual",label:"Individual",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'test("Example visual test @visual-regression", async ({ page }) => {\r\n  //test code\r\n});\n'})})})]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Tests using playwright visual comparisons ",(0,t.jsx)(n.strong,{children:"MUST"})," be tagged with ",(0,t.jsx)(n.strong,{children:"@visual-regression"})," in order for the 'update snapshots' pipeline to pick up these tests."]})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},9365:(e,n,s)=>{s.d(n,{A:()=>a});s(6540);var t=s(4164);const i={tabItem:"tabItem_Ymn6"};var r=s(4848);function a(e){let{children:n,hidden:s,className:a}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.A)(i.tabItem,a),hidden:s,children:n})}},1470:(e,n,s)=>{s.d(n,{A:()=>j});var t=s(6540),i=s(4164),r=s(3104),a=s(6347),l=s(205),o=s(7485),c=s(1682),u=s(679);function d(e){var n,s;return null!=(n=null==(s=t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:s.filter(Boolean))?n:[]}function h(e){const{values:n,children:s}=e;return(0,t.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:s,attributes:t,default:i}}=e;return{value:n,label:s,attributes:t,default:i}}))}(s);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,s])}function p(e){let{value:n,tabValues:s}=e;return s.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:s}=e;const i=(0,a.W6)(),r=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=s?s:null}({queryString:n,groupId:s});return[(0,o.aZ)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function m(e){const{defaultValue:n,queryString:s=!1,groupId:i}=e,r=h(e),[a,o]=(0,t.useState)((()=>function(e){var n;let{defaultValue:s,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!p({value:s,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+s+'" but none of its children has the corresponding value. Available values are: '+t.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return s}const i=null!=(n=t.find((e=>e.default)))?n:t[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:r}))),[c,d]=g({queryString:s,groupId:i}),[m,v]=function(e){let{groupId:n}=e;const s=function(e){return e?"docusaurus.tab."+e:null}(n),[i,r]=(0,u.Dv)(s);return[i,(0,t.useCallback)((e=>{s&&r.set(e)}),[s,r])]}({groupId:i}),f=(()=>{const e=null!=c?c:m;return p({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{f&&o(f)}),[f]);return{selectedValue:a,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error("Can't select invalid tab value="+e);o(e),d(e),v(e)}),[d,v,r]),tabValues:r}}var v=s(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=s(4848);function w(e){let{className:n,block:s,selectedValue:t,selectValue:a,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),u=e=>{const n=e.currentTarget,s=o.indexOf(n),i=l[s].value;i!==t&&(c(n),a(i))},d=e=>{var n;let s=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var t;const n=o.indexOf(e.currentTarget)+1;s=null!=(t=o[n])?t:o[0];break}case"ArrowLeft":{var i;const n=o.indexOf(e.currentTarget)-1;s=null!=(i=o[n])?i:o[o.length-1];break}}null==(n=s)||n.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":s},n),children:l.map((e=>{let{value:n,label:s,attributes:r}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>o.push(e),onKeyDown:d,onClick:u,...r,className:(0,i.A)("tabs__item",f.tabItem,null==r?void 0:r.className,{"tabs__item--active":t===n}),children:null!=s?s:n},n)}))})}function b(e){let{lazy:n,children:s,selectedValue:r}=e;const a=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===r));return e?(0,t.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function y(e){const n=m(e);return(0,x.jsxs)("div",{className:(0,i.A)("tabs-container",f.tabList),children:[(0,x.jsx)(w,{...n,...e}),(0,x.jsx)(b,{...n,...e})]})}function j(e){const n=(0,v.A)();return(0,x.jsx)(y,{...e,children:d(e.children)},String(n))}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);