"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[9540,4422],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=i,g=u["".concat(l,".").concat(h)]||u[h]||d[h]||o;return n?a.createElement(g,r(r({ref:t},p),{},{components:n})):a.createElement(g,r({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3919:function(e,t,n){function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}n.d(t,{b:function(){return a},Z:function(){return i}})},4996:function(e,t,n){n.d(t,{C:function(){return o},Z:function(){return r}});var a=n(2263),i=n(3919);function o(){var e=(0,a.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,o=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,a){var o=void 0===a?{}:a,r=o.forcePrependBaseUrl,s=void 0!==r&&r,l=o.absolute,c=void 0!==l&&l;if(!n)return n;if(n.startsWith("#"))return n;if((0,i.b)(n))return n;if(s)return t+n;var p=n.startsWith(t)?n:t+n.replace(/^\//,"");return c?e+p:p}(o,n,e,t)}}}function r(e,t){return void 0===t&&(t={}),(0,o().withBaseUrl)(e,t)}},3602:function(e,t,n){n.r(t);var a=n(7294);t.default=function(e){var t=e.next,n=e.prev;return a.useEffect((function(){if(t){var e=document.querySelector("div.pagination-nav__item.pagination-nav__item--next>a");e&&e.style&&(e.style.display="none")}if(n){var a=document.querySelector("div.pagination-nav__item>a");a&&a.style&&(a.style.display="none")}})),a.createElement("div",null)}},8895:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return h}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=(n(3602),n(4996)),s=["components"],l={id:"java_app_layering",title:"Separation of Concerns",sidebar_label:"Separation of Concerns",description:"Separation of Concerns",keywords:["development","java","backend","server-side"]},c=void 0,p={unversionedId:"developer/java/patterns/java_app_layering",id:"developer/java/patterns/java_app_layering",isDocsHomePage:!1,title:"Separation of Concerns",description:"Separation of Concerns",source:"@site/docs/developer/java/patterns/java_app_layering.md",sourceDirName:"developer/java/patterns",slug:"/developer/java/patterns/java_app_layering",permalink:"/docs/developer/java/patterns/java_app_layering",tags:[],version:"current",frontMatter:{id:"java_app_layering",title:"Separation of Concerns",sidebar_label:"Separation of Concerns",description:"Separation of Concerns",keywords:["development","java","backend","server-side"]},sidebar:"docs",previous:{title:"Development Patterns",permalink:"/docs/developer/developer_patterns_readme"},next:{title:"Reducing Bean Mapping Boilerplate",permalink:"/docs/developer/java/patterns/java_mapstruct_mapping"}},d=[{value:"Context",id:"context",children:[],level:2},{value:"Solution",id:"solution",children:[{value:"3-Layer Applications",id:"3-layer-applications",children:[],level:3},{value:"Improved Testing",id:"improved-testing",children:[],level:3}],level:2},{value:"Implementation Examples",id:"implementation-examples",children:[{value:"Controller Layer",id:"controller-layer",children:[],level:3},{value:"Service Layer",id:"service-layer",children:[],level:3},{value:"Repository Layer",id:"repository-layer",children:[],level:3}],level:2}],u={toc:d};function h(e){var t=e.components,n=(0,i.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"context"},"Context"),(0,o.kt)("p",null,"As the size of an application codebase grows, unless the code is structured in a way that makes it straight-forward for it to be evolved then\nthe chances are that any modifications to be made will take longer and new bugs introduced."),(0,o.kt)("p",null,"This is for a number of reasons, not limited to: -"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"No clear view on which code areas need to be modified to effect a business change"),(0,o.kt)("li",{parentName:"ol"},"Difficult to replace components or code units as they are not ring-fenced having clear interfaces"),(0,o.kt)("li",{parentName:"ol"},"Uncertainty in how the code being modified is actually invoked and executed"),(0,o.kt)("li",{parentName:"ol"},"Code blocks that are repeated in numerous places (and may actually differ ever so slightly)"),(0,o.kt)("li",{parentName:"ol"},"Difficulty in testing all paths through the codebase for any given change")),(0,o.kt)("p",null,"All of this increases the cognitive load on the developer making it more likely that the quality of the codebase will probably reduce over time. "),(0,o.kt)("h2",{id:"solution"},"Solution"),(0,o.kt)("p",null,"The solution to the problems mentioned above are to ensure that there is clear ",(0,o.kt)("strong",{parentName:"p"},"separation of concerns"),". "),(0,o.kt)("p",null,"Separation of concerns is a design principle for separating a computer program into distinct sections, such that each\nsection addresses a separate concern. For example the business logic of the application is a concern and the user interface is\nanother concern. Changing the user interface should not require changes to business logic and vice versa."),(0,o.kt)("h3",{id:"3-layer-applications"},"3-Layer Applications"),(0,o.kt)("p",null,"One common way to manage this in a Spring Boot application is to follow the Controller-Service-Repository pattern. One of the\nbig reasons this pattern is so popular is that it does a great job ensuring separation of concerns. "),(0,o.kt)("img",{alt:"Application Layers",src:(0,r.Z)("img/java_separation_of_concerns.png")}),(0,o.kt)("p",null,"The Controller layer, the top layer in the diagram above, is solely responsible for exposing the functionality so that it can be consumed\nby external consumers (including, perhaps, a UI component). The Repository layer, at the bottom, is responsible for storing and retrieving\nsome set of data. The Service layer in the middle is where all the business logic should go. If the business logic requires fetching/saving\ndata, it use a Repository. If someone wants to access the business logic from the outside world, they go through a Controller to get there. It is\nof course perfectly acceptable for one service to call another service."),(0,o.kt)("p",null,"This sets up a pretty simple separation of concerns. If code is related to storage/retrieval, it should go in the Repository. If\nit's dealing with exposing functionality to external consumers, it goes in the Controller. Anything unique in the business logic would go in\nthe Service layer. The Repository doesn\u2019t care which component is invoking it; it simply does what it is asked. The\nService layer doesn\u2019t care how it gets accessed, it just does its work, using a Repository where required. And the\nController is just passing the work down to the Service layer, so it can stay nice and lean."),(0,o.kt)("h3",{id:"improved-testing"},"Improved Testing"),(0,o.kt)("p",null,"Where this really starts to pay dividends is in the unit testing philosophy. "),(0,o.kt)("p",null,"By having a clean separation of concerns, it is possible to mock adjacent layers and worry about only testing the concerns of\nthat particular layer. Our Controller tests are only worried about response codes and values, and it's easy to mock the service to\ntrigger those conditions. The Service layer can even be tested as a POJO, and by mocking Repository conditions it's possible to\ntest all the business logic therein without having to worry about going through the controller layer to test it."),(0,o.kt)("h2",{id:"implementation-examples"},"Implementation Examples"),(0,o.kt)("p",null,"Spring Boot is based heavily on the Spring dependency injection framework. Dependency injection (DI) means that when one component requires\nthe use of another then it is provided to it (auto-magically) by an overarching management container that contains references to all\navailable components (that are declared using Java annotations in the codebase and discovered at startup)."),(0,o.kt)("p",null,"This makes it very easy to create Spring components (essentially just Java classes) that provide this separation of concerns. Of course, it's\nstill possible for a rogue developer to break this pattern and put the code in the wrong places, but having this pattern should help to alleviate this."),(0,o.kt)("h3",{id:"controller-layer"},"Controller Layer"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@RestController")," annotated class is used to manage the transport-level concerns of the application. As can be seen below, it\nmanages the REST API path (in this example a HTTP ",(0,o.kt)("inlineCode",{parentName:"p"},"GET")," request available at URI ",(0,o.kt)("inlineCode",{parentName:"p"},"/thing/{id}"),") and the shuffling of data from the internal\nrepresentation (a ",(0,o.kt)("inlineCode",{parentName:"p"},"Thing")," domain object) and its external representation (a ",(0,o.kt)("inlineCode",{parentName:"p"},"ThingDTO")," data transfer object)."),(0,o.kt)("p",null,"It can be seen that a ",(0,o.kt)("inlineCode",{parentName:"p"},"ThingService"),' component is "wired" into the controller class, whose responsibility it is to provide\nany business logic (and/or to call peers (other services) or delegate to lower layers).'),(0,o.kt)("p",null,"The code in the controller layer should be as minimal as possible and simply delegate to a service."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/thing")\npublic class ThingController {\n\n  @Autowired\n  private ThingService thingService;\n\n  @GetMapping("/{id}")\n  public ResponseEntity<ThingDTO> getThing(@PathVariable("id") UUID id) {\n  \n    return ResponseEntity.ok(thingService.getThing(id));\n  \n  }  \n}\n')),(0,o.kt)("h3",{id:"service-layer"},"Service Layer"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@Service")," annotated class is the component where any business logic should be performed. This may include sense-checking\nvalues or performing custom logic. By doing these activities here it makes the unit re-usable across the application, and means\nthat should the business logic change then it only needs to be modified in one place, and that one place is very clearly related\nto the thing (no pun intended) in scope."),(0,o.kt)("p",null,"It can be seen that a ",(0,o.kt)("inlineCode",{parentName:"p"},"ThingRepository"),' component is "wired" into the service class, whose responsibility it is to manage any\npersistence activities such as reading from or writing to a database. Should the business require data to persisted using a different\nmechanism (such as to/from a filesystem) then only one repository can be switched out for an alternate (observe that it\'s an interface in the code).'),(0,o.kt)("p",null,"Note the use of ",(0,o.kt)("a",{parentName:"p",href:"/docs/developer/java/patterns/java_mapstruct_mapping"},"MapStruct")," in the example below to perform simple bean mapping between domain objects and DTO classes, and vice versa."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"@Service\npublic class ThingService {\n\n  @Autowired\n  private ThingRepository thingRepository;\n  \n  @Autowired\n  private ThingMapper thingMapper;\n\n  public ThingDTO getThing(UUID id) {\n  \n    Optional<Thing> optThing = thingRepository.findById(id);\n\n    if (optThing.isPresent()) {\n\n        // Map between Thing and ThingDTO, probably using MapStruct ...\n        return thingMapper.toDto(optThing.get());\n    \n    }\n\n    throw new ThingNotFoundException();    \n  \n  }\n}\n")),(0,o.kt)("h3",{id:"repository-layer"},"Repository Layer"),(0,o.kt)("p",null,"As discussed above, the ",(0,o.kt)("inlineCode",{parentName:"p"},"@Repository")," annotated class is the component that manages persistence. Spring Boot provides a number\nof standard interfaces out-of-the-box (such as the ",(0,o.kt)("inlineCode",{parentName:"p"},"CrudRepository")," shown below) which provide methods such as ",(0,o.kt)("inlineCode",{parentName:"p"},"findById()"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"findAll()"),",\n",(0,o.kt)("inlineCode",{parentName:"p"},"save()"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"deleteById()")," and so on."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"@Repository\npublic interface ThingRepository extends CrudRepository<Thing, UUID> {\n\n  // Add any bespoke CRUD methods here\n\n}\n")))}h.isMDXComponent=!0}}]);