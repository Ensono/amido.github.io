"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[3934],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return h}});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},m=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=d(t),p=o,h=c["".concat(s,".").concat(p)]||c[p]||u[p]||r;return t?a.createElement(h,l(l({ref:n},m),{},{components:t})):a.createElement(h,l({ref:n},m))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=p;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[c]="string"==typeof e?e:o,l[1]=i;for(var d=2;d<r;d++)l[d]=t[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},4365:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return c}});var a=t(7462),o=t(3366),r=(t(7294),t(3905)),l=["components"],i={id:"setting_up_dynamodb_locally_java",title:"DynamoDB Emulator",sidebar_label:"DynamoDB Emulator",hide_title:!1,hide_table_of_contents:!1,description:"How to set up the DynamoDB Emulator",keywords:["dynamodb","emulator","settings","template"]},s=void 0,d={unversionedId:"workloads/aws/backend/java/setting_up_dynamodb_locally_java",id:"workloads/aws/backend/java/setting_up_dynamodb_locally_java",title:"DynamoDB Emulator",description:"How to set up the DynamoDB Emulator",source:"@site/docs/workloads/aws/backend/java/setting_up_dynamodb_locally_java.md",sourceDirName:"workloads/aws/backend/java",slug:"/workloads/aws/backend/java/setting_up_dynamodb_locally_java",permalink:"/docs/workloads/aws/backend/java/setting_up_dynamodb_locally_java",draft:!1,tags:[],version:"current",frontMatter:{id:"setting_up_dynamodb_locally_java",title:"DynamoDB Emulator",sidebar_label:"DynamoDB Emulator",hide_title:!1,hide_table_of_contents:!1,description:"How to set up the DynamoDB Emulator",keywords:["dynamodb","emulator","settings","template"]},sidebar:"docs",previous:{title:"Introduction",permalink:"/docs/workloads/common/backend/java/intro_java"},next:{title:"Running the AWS XRay Daemon",permalink:"/docs/workloads/aws/backend/java/setting_up_xray_daemon_locally_java"}},m={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Starting the DynamoDB Emulator",id:"starting-the-dynamodb-emulator",level:2},{value:"DynamoDB Emulator endpoint",id:"dynamodb-emulator-endpoint",level:2},{value:"Interacting with the DynamoDB Emulator",id:"interacting-with-the-dynamodb-emulator",level:2},{value:"Creating the Ensono Stacks Menu table",id:"creating-the-ensono-stacks-menu-table",level:2},{value:"Executing Ensono Stacks Workload using DynamoDB rather than CosmosDB",id:"executing-ensono-stacks-workload-using-dynamodb-rather-than-cosmosdb",level:2}],u={toc:c},p="wrapper";function h(e){var n=e.components,t=(0,o.Z)(e,l);return(0,r.kt)(p,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"This page is ",(0,r.kt)("strong",{parentName:"p"},"work in progress")," and will be completed as the Ensono Stacks DynamoDB support is more fully developed."),(0,r.kt)("h2",{id:"starting-the-dynamodb-emulator"},"Starting the DynamoDB Emulator"),(0,r.kt)("p",null,"There are two options for running the DynamoDB emulator, these are as follows: -"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Running as a JAR (requires Java)"),(0,r.kt)("li",{parentName:"ol"},"Running as a Docker image (requires Docker Desktop or alternative container services)")),(0,r.kt)("p",null,"If you would like to run it as a JAR, follow the instructions here: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html"},"Deploying DynamoDB locally on your computer")),(0,r.kt)("p",null,"If you prefer to use Docker, there is a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file within the ",(0,r.kt)("inlineCode",{parentName:"p"},"stacks-java-aws-dynamodb")," GitHub project. This\nis replicated below for convenience: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3.7'\nservices:\n  dynamodb:\n    image:  amazon/dynamodb-local\n    container_name: dynamodb-local\n    hostname: dynamodb\n    volumes:\n      -  ~/docker-data/dynamodb-local-data:/home/dynamodblocal/data\n    ports:\n      - 8000:8000\n    command: \"-jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data/\"\n")),(0,r.kt)("p",null,"To start the DynamoDB in Docker use the command: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker compose -f docker-compose.yml up\n")),(0,r.kt)("p",null,"which should yield the following output: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Attaching to dynamodb-local\ndynamodb-local  | Initializing DynamoDB Local with the following configuration:\ndynamodb-local  | Port: 8000\ndynamodb-local  | InMemory: false\ndynamodb-local  | DbPath:   /home/dynamodblocal/data/\ndynamodb-local  | SharedDb: true\ndynamodb-local  | shouldDelayTransientStatuses: false\ndynamodb-local  | CorsParams:   *\ndynamodb-local  |\n")),(0,r.kt)("h2",{id:"dynamodb-emulator-endpoint"},"DynamoDB Emulator endpoint"),(0,r.kt)("p",null,"Irrespective of the way that the emulator was started there should now be an instance of DynamoDB listening on ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost"),"\nat port ",(0,r.kt)("inlineCode",{parentName:"p"},"8000"),"."),(0,r.kt)("h2",{id:"interacting-with-the-dynamodb-emulator"},"Interacting with the DynamoDB Emulator"),(0,r.kt)("p",null,"To interact with the database you will need to have thw AWS CLI application installed. If you do not already have this installed\nyou can find instructions for doing so here : ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html"},"Installing the AWS CLI")," "),(0,r.kt)("p",null,"Once you have the AWS CLI installed it should now be possible to interact with the database. For example, to list the tables\nthat have been created in the database use:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws dynamodb list-tables --endpoint-url http://localhost:8000\n")),(0,r.kt)("h2",{id:"creating-the-ensono-stacks-menu-table"},"Creating the Ensono Stacks Menu table"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE: This section needs updating to provide a more complete data model for Menu; it will at least support basic querying and\ncreation of a top level Menu item for the time being. For sub-objects, such as Categories and Items the schema below will\nneed to be further worked on.")),(0,r.kt)("p",null,"To create the Menu table (if it doesn't already exist) create a file with the following content in a temporary location and\nname it ",(0,r.kt)("strong",{parentName:"p"},"Menu.dynamodb.json"),": -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n        "AttributeDefinitions": [\n            {\n                "AttributeName": "id",\n                "AttributeType": "S"\n            }\n        ],\n        "TableName": "Menu",\n        "KeySchema": [\n            {\n                "AttributeName": "id",\n                "KeyType": "HASH"\n            }\n        ],\n        "ProvisionedThroughput": {\n            "ReadCapacityUnits": 1,\n            "WriteCapacityUnits": 1\n        }\n}\n')),(0,r.kt)("p",null,"Create the table in DynamoDB using the following command: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws dynamodb create-table --cli-input-json file://Menu.dynamodb.json --endpoint-url http://localhost:8000\n")),(0,r.kt)("p",null,"If you now list the tables it should return the name of the table just created (e.g. Menu): -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'aws dynamodb list-tables --endpoint-url http://localhost:8000 | cat\n\n{\n    "TableNames": [\n        "Menu"\n    ]\n}\n')),(0,r.kt)("p",null,"After data has been added to the Menu table using the workload APIs it is possible to scan the records using the following command: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'aws dynamodb scan --consistent-read --table-name Menu --endpoint-url http://localhost:8000 | cat\n\n{\n    "Items": [\n        {\n            "name": {\n                "S": "Test Menu 1"\n            },\n            "description": {\n                "S": "Test menu no. 1"\n            },\n            "id": {\n                "S": "7a994352-dc9e-4b11-8c0f-36792489f112"\n            },\n            "categories": {\n                "L": [\n            ...\n')),(0,r.kt)("p",null,"Additional ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html"},"DynamoDB API query examples")," can be found online. "),(0,r.kt)("h2",{id:"executing-ensono-stacks-workload-using-dynamodb-rather-than-cosmosdb"},"Executing Ensono Stacks Workload using DynamoDB rather than CosmosDB"),(0,r.kt)("p",null,"TODO: ",(0,r.kt)("strong",{parentName:"p"},"Move this to a better area once the DynamoDB work is completed")),(0,r.kt)("p",null,"There are a few steps required to use DynamoDB rather than CosmosDB: -"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Ensure that the module ",(0,r.kt)("inlineCode",{parentName:"li"},"stacks-aws-dynamodb")," is present (and version number correct( in the ",(0,r.kt)("strong",{parentName:"li"},"dynamodb")," ",(0,r.kt)("inlineCode",{parentName:"li"},"pom.xml")," (section profile","[id='dynamodb']"," > dependencies > dependency)",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"To get the current WIP version of the module run the following commands:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"git clone https://github.com/Ensono/stacks-java-aws-dynamodb.git")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"mvn clean install")))))),(0,r.kt)("li",{parentName:"ol"},"Check that the endpoint specified in ",(0,r.kt)("inlineCode",{parentName:"li"},"application-dynamodb.yml")," is correct (local or pointing at AWS per requirements)"),(0,r.kt)("li",{parentName:"ol"},"Switch off the CosmosDB profile and switch on the DynamoDB profile when starting the workload")),(0,r.kt)("p",null,"The current definition of the profile in (for example) the stacks-cqrs-with-events project ",(0,r.kt)("inlineCode",{parentName:"p"},"pom.xml")," needs to be as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<profile>\n  <id>dynamodb</id>\n  <properties>\n    <dynamodb.profile.name>dynamodb</dynamodb.profile.name>\n  </properties>\n  <dependencies>\n    <dependency>\n      <groupId>com.amido.stacks.modules</groupId>\n      <artifactId>stacks-aws-dynamodb</artifactId>\n      <version>${stacks.aws.dynamodb.version}</version>\n    </dependency>\n  </dependencies>\n</profile>\n")),(0,r.kt)("p",null,"To start the application either use ",(0,r.kt)("inlineCode",{parentName:"p"},"sh run_scenario.sh")," and pick the required features, or run the command: -"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mvn clean spring-boot:run -Pazure,aws,dynamodb,servicebus,-cosmosdb\n")),(0,r.kt)("p",null,"Remember that Cosmos DB and DynamoDB are mutually exclusive, so only use one or the other."))}h.isMDXComponent=!0}}]);