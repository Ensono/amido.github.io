"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[8370],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return k}});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(a),h=o,k=u["".concat(l,".").concat(h)]||u[h]||d[h]||n;return a?r.createElement(k,i(i({ref:t},p),{},{components:a})):r.createElement(k,i({ref:t},p))}));function k(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,i=new Array(n);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<n;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},4210:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return k},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=a(7462),o=a(3366),n=(a(7294),a(3905)),i=["components"],s={id:"fabric_deployment_guide",title:"Fabric Lakehouse Deployment",sidebar_label:"9. Fabric Lakehouse Deployment",hide_title:!1,hide_table_of_contents:!1,description:"Deployment of Microsoft Fabric Lakehouse through Azure Portal",keywords:["data","infrastructure","adf","cicd","fabric"]},l=void 0,c={unversionedId:"workloads/azure/data/getting_started/fabric_deployment_guide",id:"workloads/azure/data/getting_started/fabric_deployment_guide",title:"Fabric Lakehouse Deployment",description:"Deployment of Microsoft Fabric Lakehouse through Azure Portal",source:"@site/docs/workloads/azure/data/getting_started/fabric_deployment_guide.md",sourceDirName:"workloads/azure/data/getting_started",slug:"/workloads/azure/data/getting_started/fabric_deployment_guide",permalink:"/docs/workloads/azure/data/getting_started/fabric_deployment_guide",draft:!1,tags:[],version:"current",frontMatter:{id:"fabric_deployment_guide",title:"Fabric Lakehouse Deployment",sidebar_label:"9. Fabric Lakehouse Deployment",hide_title:!1,hide_table_of_contents:!1,description:"Deployment of Microsoft Fabric Lakehouse through Azure Portal",keywords:["data","infrastructure","adf","cicd","fabric"]},sidebar:"docs",previous:{title:"8. Data Processing Pipeline Deployment",permalink:"/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure"},next:{title:"Workloads on GCP",permalink:"/docs/workloads/gcp/workloads_gcp_readme"}},p={},u=[{value:"Step 1: Create Fabric capacity resource",id:"step-1-create-fabric-capacity-resource",level:2},{value:"Step 2: Create a Microsoft Fabric Workspace",id:"step-2-create-a-microsoft-fabric-workspace",level:2},{value:"Step 3: Create a Lakehouse",id:"step-3-create-a-lakehouse",level:2},{value:"Step 4: Create Lakehouse Files shortcut",id:"step-4-create-lakehouse-files-shortcut",level:2},{value:"Step 5: Create Lakehouse Tables shortcuts",id:"step-5-create-lakehouse-tables-shortcuts",level:2},{value:"Step 5: Interacting with data in the lakehouse",id:"step-5-interacting-with-data-in-the-lakehouse",level:2},{value:"SQL Endpoint",id:"sql-endpoint",level:3},{value:"Power BI",id:"power-bi",level:3},{value:"Notebooks",id:"notebooks",level:3}],d={toc:u},h="wrapper";function k(e){var t=e.components,s=(0,o.Z)(e,i);return(0,n.kt)(h,(0,r.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Microsoft Fabric can be used to implement a ",(0,n.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/data_engineering/data_engineering_intro_azure#lakehouse-approach"},"lakehouse")," layer over a Stacks data platform, giving full analytics capabilities over the data lake, and native integrations with tools such as Power BI."),(0,n.kt)("p",null,"This section provides step-by-step instructions on deploying a Fabric workspace, and setting up a lakehouse over your data lake. It assumes you have deployed a Stacks data platform, and have loaded data into the ",(0,n.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/getting_started/ingest_pipeline_deployment_azure"},"bronze layer")," and ",(0,n.kt)("a",{parentName:"p",href:"/docs/workloads/azure/data/getting_started/processing_pipeline_deployment_azure"},"silver / gold layers")," of the data lake."),(0,n.kt)("admonition",{title:"Fabric Preview",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"At the time of writing, Fabric is in ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/get-started/preview"},"public preview"),"."),(0,n.kt)("p",{parentName:"admonition"},"Some features are not currently supported, for example connecting to data lake storage behind a firewall or virtual network (which is the recommended approach in Ensono Stacks). Once additional key features such as this become available, this documentation will be updated and closer integrations with Ensono Stacks can be implemented."),(0,n.kt)("p",{parentName:"admonition"},"Please refer to ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/"},"Microsoft documentation")," for the latest updates on Fabric and full documentation.")),(0,n.kt)("h2",{id:"step-1-create-fabric-capacity-resource"},"Step 1: Create Fabric capacity resource"),(0,n.kt)("p",null,"The first step in setting up a Fabric Workspace is provisioning a capacity resource. Before proceeding, please refer to the official documentation for further details on ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/enterprise/licenses#capacity-license"},"capacity licences"),"."),(0,n.kt)("p",null,"To setup a capacity resource in the Azure portal:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Login to Azure portal, search for ",(0,n.kt)("strong",{parentName:"li"},"Microsft Fabric (preview)")," and select ",(0,n.kt)("strong",{parentName:"li"},"Create"),"."),(0,n.kt)("li",{parentName:"ol"},"Create a Fabric capacity:",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Select the subscription and resource group for the Fabric capacity."),(0,n.kt)("li",{parentName:"ol"},"Enter a name to identify the capacity resource (this is displayed in the Microsoft Fabric admin portal and Azure portal). The name must be unique in the selected location."),(0,n.kt)("li",{parentName:"ol"},"Select a resource size, based upon your requirements."),(0,n.kt)("li",{parentName:"ol"},"Enter a Fabric capacity administrator. The capacity administrator must be a member user or a service principal in your AAD tenant.")))),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Ensono Stacks Fabric create",src:a(4332).Z,width:"829",height:"942"})),(0,n.kt)("h2",{id:"step-2-create-a-microsoft-fabric-workspace"},"Step 2: Create a Microsoft Fabric Workspace"),(0,n.kt)("p",null,"Workspaces are places to collaborate with colleagues to create collections of items such as lakehouses, warehouses, and reports. please refer below Microsoft link for details on ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/get-started/workspaces"},"Fabric workspaces"),". You may create a workspace per environment, to align to your data platform. To setup a Fabric workspace:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Go to ",(0,n.kt)("a",{parentName:"li",href:"https://app.fabric.microsoft.com"},"https://app.fabric.microsoft.com")," and sign-in to your organization's portal. You will need a Power BI Pro license and workspace admin rights on your account to create workspaces."),(0,n.kt)("li",{parentName:"ol"},"Select the ",(0,n.kt)("strong",{parentName:"li"},"Data Engineering")," 'experience' from the left plane. Select ",(0,n.kt)("strong",{parentName:"li"},"Workspaces")," from the left pane, then the ",(0,n.kt)("strong",{parentName:"li"},"New Workspace")," button."),(0,n.kt)("li",{parentName:"ol"},"Enter the name of workspace as per your naming conventions (e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"ensono-stacks-dev-euw-fabric"),"). Under advanced options choose ",(0,n.kt)("strong",{parentName:"li"},"Fabric capacity")," for license mode."),(0,n.kt)("li",{parentName:"ol"},"Choose the Azure Fabric capacity resource created in Step 1 and select ",(0,n.kt)("strong",{parentName:"li"},"Apply"),".")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Ensono Stacks Fabric workspace",src:a(3098).Z,width:"578",height:"1249"})),(0,n.kt)("h2",{id:"step-3-create-a-lakehouse"},"Step 3: Create a Lakehouse"),(0,n.kt)("p",null,"We will be creating a ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/data-engineering/lakehouse-overview"},"Fabric Lakehouse")," to access the data in our data lake. To create the lakehouse:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Within the newly created workspace, select ",(0,n.kt)("strong",{parentName:"li"},"New Lakehouse (Preview)")," and enter a name for the lakehouse.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Ensono Stacks Fabric new lakehouse",src:a(6696).Z,width:"1234",height:"374"})),(0,n.kt)("h2",{id:"step-4-create-lakehouse-files-shortcut"},"Step 4: Create Lakehouse Files shortcut"),(0,n.kt)("p",null,"In our Fabric lakehouse we will be creating both ",(0,n.kt)("em",{parentName:"p"},"Files")," and ",(0,n.kt)("em",{parentName:"p"},"Tables")," shortcuts to our data lake storage containers:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"Files")," shortcuts will allow us to access all objects in the data lake (regardless of file type). This allows the data to be accessed through ",(0,n.kt)("a",{parentName:"li",href:"#notebooks"},"Fabric notebooks"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"Tables")," shortcuts can be created over Delta Lake format tables (as we have in the Silver and Gold layers of our data lake). Once added as Tables, we can run ",(0,n.kt)("a",{parentName:"li",href:"#sql-endpoint"},"SQL queries")," and use the data in ",(0,n.kt)("a",{parentName:"li",href:"#power-bi"},"Power BI"),".")),(0,n.kt)("p",null,"See the ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/onelake/onelake-shortcuts"},"overview of OneLake shortcuts")," for further information on the types of shortcut."),(0,n.kt)("p",null,"Firstly, we will create ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/onelake/create-adls-shortcut"},"Lakehouse Files shortcuts")," to our data lake storage containers."),(0,n.kt)("admonition",{title:"Secure data lake access",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"As mentioned above, it is currently not possible to connect to data lake storage behind a firewall or virtual network (which is the recommended approach in Ensono Stacks). Therefore, you can currently only connect to data lake storage which is accessible from public networks. Once this functionality is available in Fabric, these instructions will be updated.")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Within the lakehouse, right click on ",(0,n.kt)("strong",{parentName:"li"},"Files")," in the left side pane and choose ",(0,n.kt)("strong",{parentName:"li"},"New shortcut"),"."),(0,n.kt)("li",{parentName:"ol"},"Under ",(0,n.kt)("strong",{parentName:"li"},"External sources")," select ",(0,n.kt)("strong",{parentName:"li"},"Azure Data Lake Storage Gen2"),"."),(0,n.kt)("li",{parentName:"ol"},"Provide connection details for your ADLS storage account:",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Enter the URL for the ADLS Gen 2 endpoint to connect, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"https://amidostacksdeveuwdeadls.dfs.core.windows.net/raw"),"."),(0,n.kt)("li",{parentName:"ol"},"Under ",(0,n.kt)("strong",{parentName:"li"},"Connection")," select ",(0,n.kt)("em",{parentName:"li"},"Create new connection"),"."),(0,n.kt)("li",{parentName:"ol"},"Set a connection name, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"amidostacksdeveuwadls-raw")),(0,n.kt)("li",{parentName:"ol"},"For ",(0,n.kt)("strong",{parentName:"li"},"Authentication kind")," select the method you will use for authenticating with the storage account, for example SAS token (see documentation on ",(0,n.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/ai-services/translator/document-translation/how-to-guides/create-sas-tokens?tabs=Containers"},"generating SAS tokens for a storage container"),")."))),(0,n.kt)("li",{parentName:"ol"},"Set the and name for the new shortcut, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"amidostacksdeveuwadls-raw"),". If you included the container name in the URL, the ",(0,n.kt)("strong",{parentName:"li"},"Sub Path")," should already be set (e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"/raw"),")."),(0,n.kt)("li",{parentName:"ol"},"Select ",(0,n.kt)("inlineCode",{parentName:"li"},"Create"),". The shortcut should now be accessible under the Files directory in the lakehouse explorer panel."),(0,n.kt)("li",{parentName:"ol"},"Repeat the above steps to create a shortcut for each of the data lake containers, i.e. raw, staging, and curated.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Fabric files shortcut",src:a(5438).Z,width:"470",height:"646"})),(0,n.kt)("h2",{id:"step-5-create-lakehouse-tables-shortcuts"},"Step 5: Create Lakehouse Tables shortcuts"),(0,n.kt)("p",null,"Tables shortcuts will allow us to interact with query and interact with data stored in Delta Lake format. At present, external tables must be added as shortcuts individually to be fully accessible from the lakehouse."),(0,n.kt)("p",null,"Follow these steps for each of the tables in the data lake staging (silver) and curated (gold) layers:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Within the lakehouse, right click on ",(0,n.kt)("strong",{parentName:"li"},"Tables")," in the left side pane and choose ",(0,n.kt)("strong",{parentName:"li"},"New shortcut"),"."),(0,n.kt)("li",{parentName:"ol"},"Under ",(0,n.kt)("strong",{parentName:"li"},"External sources")," select ",(0,n.kt)("strong",{parentName:"li"},"Azure Data Lake Storage Gen2"),"."),(0,n.kt)("li",{parentName:"ol"},"Provide connection details for your ADLS storage account:",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Enter the URL for the ADLS Gen 2 endpoint to connect, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"https://amidostacksdeveuwdeadls.dfs.core.windows.net/staging"),"."),(0,n.kt)("li",{parentName:"ol"},"You may re-use the connection to this container created in the previous step."))),(0,n.kt)("li",{parentName:"ol"},"Set the and name for the new table shortcut, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"staging_movies_links"),". In the ",(0,n.kt)("strong",{parentName:"li"},"Sub Path")," provide the path to the Delta table directory in the container (e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"/staging/movies/links"),")."),(0,n.kt)("li",{parentName:"ol"},"Select ",(0,n.kt)("inlineCode",{parentName:"li"},"Create"),". The shortcut should now be accessible under the Tables directory in the lakehouse explorer panel."),(0,n.kt)("li",{parentName:"ol"},"Repeat the above steps to create a table shortcut for each of the tables required in the staging and curated containers.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Fabric tables shortcut",src:a(6581).Z,width:"381",height:"280"})),(0,n.kt)("h2",{id:"step-5-interacting-with-data-in-the-lakehouse"},"Step 5: Interacting with data in the lakehouse"),(0,n.kt)("p",null,"Once shortcuts have been added, data in the Lakehouse can be used within Fabric in a number of ways:"),(0,n.kt)("h3",{id:"sql-endpoint"},"SQL Endpoint"),(0,n.kt)("p",null,"Tables in the lakehouse can be directly queried via the ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/data-engineering/lakehouse-sql-endpoint"},"SQL endpoint"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Within the lakehouse, select the ",(0,n.kt)("strong",{parentName:"li"},"Lakehouse")," button from the top right corner, and select ",(0,n.kt)("strong",{parentName:"li"},"SQL Endpoint"),"."),(0,n.kt)("li",{parentName:"ol"},"From here, all tables added as shortcuts will be appear as tables in the SQL Endpoint, within the default schema. You can query the tables using SQL. See documentation on the ",(0,n.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/fabric/data-warehouse/sql-query-editor"},"SQL query editor")," for more details.")),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Tables in the Lakehouse are read-only via the SQL endpoint. Views can be created.")),(0,n.kt)("h3",{id:"power-bi"},"Power BI"),(0,n.kt)("p",null,"Tables and views in the lakehouse integrate seamlessly with Power BI. Direct lake mode provides a default Power BI dataset from Tables in the lakehouse. See further information on ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/data-warehouse/datasets"},"Power BI datasets in Fabric"),"."),(0,n.kt)("h3",{id:"notebooks"},"Notebooks"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/fabric/data-engineering/how-to-use-notebook"},"Fabric notebooks")," offer Apache Spark code development over the Lakehouse. Unlike the SQL endpoint which can only query lakehouse ",(0,n.kt)("em",{parentName:"p"},"Tables"),", using Fabric notebooks you can also interact with lakehouse ",(0,n.kt)("em",{parentName:"p"},"Files")," shortcuts. Within your Fabric notebooks, the path to items in the lakehouse is simply ",(0,n.kt)("inlineCode",{parentName:"p"},"Files/")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"Tables/"),", for example:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},'# Load data directly from Files\ndf = spark.read.format("delta").load("Files/amidostacksdeveuwdeadls-staging/movies/movies_metadata_dq")\n\n# Display data\ndisplay(df.limit(10))\n')))}k.isMDXComponent=!0},3098:function(e,t,a){t.Z=a.p+"assets/images/fabric_choose_fabric-40c91325ec026e7a28e16f0f33dc07ae.png"},4332:function(e,t,a){t.Z=a.p+"assets/images/fabric_create-f04dd47a84a5f675483fbbf5f60300f0.png"},5438:function(e,t,a){t.Z=a.p+"assets/images/fabric_files_shortcut-d3529e0e342144a32a618103ec8d2f14.png"},6696:function(e,t,a){t.Z=a.p+"assets/images/fabric_new_lakehouse-8b8d2d68760b941be91ed3d8bb4dea6f.png"},6581:function(e,t,a){t.Z=a.p+"assets/images/fabric_tables_shortcut-ae0d9ca865a4f778a20eb8bbb7e63368.png"}}]);