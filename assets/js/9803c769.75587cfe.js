"use strict";(self.webpackChunkstacks=self.webpackChunkstacks||[]).push([[2634],{8453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>o});var i=n(6540);const r={},s=i.createContext(r);function c(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:t},e.children)}},9557:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(6540),r=n(4848);const s=e=>{let{next:t,prev:n}=e;return i.useEffect((()=>{if(t){const e=document.querySelector("div.pagination-nav__item.pagination-nav__item--next>a");e&&e.style&&(e.style.display="none")}if(n){const e=document.querySelector("div.pagination-nav__item>a");e&&e.style&&(e.style.display="none")}})),(0,r.jsx)("div",{})}},9811:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"infrastructure/aws/pipelines/github_actions","title":"GitHub Actions Pipeline","description":"How do you set up a pipeline in GitHub Actions","source":"@site/docs/infrastructure/aws/pipelines/github_actions.md","sourceDirName":"infrastructure/aws/pipelines","slug":"/infrastructure/aws/pipelines/github_actions","permalink":"/docs/infrastructure/aws/pipelines/github_actions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"github_actions","title":"GitHub Actions Pipeline","sidebar_label":"GitHub Actions","description":"How do you set up a pipeline in GitHub Actions","keywords":["workload","pipeline","github actions","pipeline template"]},"sidebar":"docs","previous":{"title":"Core Infrastructure","permalink":"/docs/infrastructure/aws/core_infrastructure_aws"},"next":{"title":"Testing Overview","permalink":"/docs/testing/testing_overview"}}');var r=n(4848),s=n(8453),c=n(9557),o=n(6025);const a={id:"github_actions",title:"GitHub Actions Pipeline",sidebar_label:"GitHub Actions",description:"How do you set up a pipeline in GitHub Actions",keywords:["workload","pipeline","github actions","pipeline template"]},l=void 0,d={},h=[{value:"Pipeline Diagram",id:"pipeline-diagram",level:2},{value:"Feature branch -&gt; Non-Prod sequence",id:"feature-branch---non-prod-sequence",level:3},{value:"Main branch -&gt; Prod sequence",id:"main-branch---prod-sequence",level:3},{value:"Setting up GitHub Actions",id:"setting-up-github-actions",level:2},{value:"Environment Secrets",id:"environment-secrets",level:3},{value:"Update pipeline template placeholders",id:"update-pipeline-template-placeholders",level:3},{value:"Create the pipeline",id:"create-the-pipeline",level:3}];function u(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The pipeline will automate provisioning and updating the core infrastructure in AWS. This page assumes you have already completed the steps on the ",(0,r.jsx)(t.a,{href:"/docs/infrastructure/aws/core_infrastructure_aws",children:"core infrastructure page"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["The AWS infrastructure source code can be found ",(0,r.jsx)(t.a,{href:"https://github.com/Ensono/stacks-infrastructure-eks",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"pipeline-diagram",children:"Pipeline Diagram"}),"\n",(0,r.jsx)(t.h3,{id:"feature-branch---non-prod-sequence",children:"Feature branch -> Non-Prod sequence"}),"\n",(0,r.jsx)("img",{alt:"AWS Core - GitHub Actions Pipeline",src:(0,o.Ay)("img/core_pipeline_nonprod.png")}),"\n",(0,r.jsx)(t.h3,{id:"main-branch---prod-sequence",children:"Main branch -> Prod sequence"}),"\n",(0,r.jsx)("img",{alt:"AWS Core - GitHub Actions Pipeline",src:(0,o.Ay)("img/core_pipeline_prod.png")}),"\n",(0,r.jsx)(t.h2,{id:"setting-up-github-actions",children:"Setting up GitHub Actions"}),"\n",(0,r.jsx)(t.h3,{id:"environment-secrets",children:"Environment Secrets"}),"\n",(0,r.jsxs)(t.p,{children:["Environment secrets will need creating for storing some sensitive variables to be used by the pipeline. Instructions for creating a environment secrets can be found ",(0,r.jsx)(t.a,{href:"https://docs.github.com/en/actions/managing-workflow-runs-and-deployments/managing-deployments/managing-environments-for-deployment#environment-secrets",children:"here"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Add the following secrets:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Variable Name"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Required for"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_ACCESS_KEY_ID"}),(0,r.jsx)(t.td,{children:"AWS IAM User Access Key ID"}),(0,r.jsx)(t.td,{children:"AWS Authentication"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_ACCOUNT_ID"}),(0,r.jsx)(t.td,{children:"AWS Account ID"}),(0,r.jsx)(t.td,{children:"AWS Authentication"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_SECRET_ACCESS_KEY"}),(0,r.jsx)(t.td,{children:"AWS IAM User Secret Access Key"}),(0,r.jsx)(t.td,{children:"AWS Authentication"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_TF_STATE_BUCKET"}),(0,r.jsx)(t.td,{children:"S3 Bucket name for Terraform state"}),(0,r.jsx)(t.td,{children:"Terraform State Management"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_TF_STATE_DYNAMOTABLE"}),(0,r.jsx)(t.td,{children:"DynamoDB Table name for Terraform state"}),(0,r.jsx)(t.td,{children:"Terraform State Management"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_TF_STATE_ENCRYPTION"}),(0,r.jsxs)(t.td,{children:["Encrypt Terraform state. ",(0,r.jsx)(t.code,{children:"true"})," or ",(0,r.jsx)(t.code,{children:"false"})]}),(0,r.jsx)(t.td,{children:"Terraform State Management"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_TF_STATE_KEY"}),(0,r.jsx)(t.td,{children:"Unique name for this applications Terraform state"}),(0,r.jsx)(t.td,{children:"Terraform State Management"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AWS_TF_STATE_REGION"}),(0,r.jsx)(t.td,{children:"AWS region"}),(0,r.jsx)(t.td,{children:"Terraform State Management"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"update-pipeline-template-placeholders",children:"Update pipeline template placeholders"}),"\n",(0,r.jsxs)(t.p,{children:["Where possible, the Stacks CLI will have populated the correct values in the pipeline environment file ",(0,r.jsx)(t.code,{children:".github/workflows/infrastructure.env"}),". We very much recommend that you go through the whole ",(0,r.jsx)(t.code,{children:".github/workflows"})," directory to make sure that values are correct for your project. Once you are happy with the template, commit the changes to your repository."]}),"\n",(0,r.jsx)(t.h3,{id:"create-the-pipeline",children:"Create the pipeline"}),"\n",(0,r.jsxs)(t.p,{children:["Stacks generates the GitHub Actions workflow file in the directory expected by GitHub Actions, ",(0,r.jsx)(t.code,{children:".github/workflows"}),". Committing this file to the ",(0,r.jsx)(t.code,{children:"main"}),' branch of a GitHub repository will "create" the pipeline. Instructions for viewing the results can be found ',(0,r.jsx)(t.a,{href:"https://docs.github.com/en/actions/writing-workflows/quickstart#viewing-your-workflow-results",children:"here"})]}),"\n",(0,r.jsx)(c.A,{next:!0})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);